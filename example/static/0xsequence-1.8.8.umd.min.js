!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("ethers")):"function"==typeof define&&define.amd?define(["exports","ethers"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).sequence={},e.ethers)}(this,(function(e,t){"use strict";var s=Object.freeze({__proto__:null,abi:[{inputs:[{internalType:"bytes32",type:"bytes32"}],name:"getAlternativeSignature",outputs:[{internalType:"string",type:"string"}],stateMutability:"view",type:"function"}]});var n=Object.freeze({__proto__:null,abi:[{type:"function",name:"isValidSignature",constant:!0,inputs:[{type:"bytes32"},{type:"bytes"}],outputs:[{type:"bytes4"}],payable:!1,stateMutability:"view"}],returns:{isValidSignatureBytes32:"0x1626ba7e"}});const i={erc6492:Object.freeze({__proto__:null,abi:[{inputs:[{internalType:"bytes",name:"error",type:"bytes"}],name:"ERC1271Revert",type:"error"},{inputs:[{internalType:"bytes",name:"error",type:"bytes"}],name:"ERC6492DeployFailed",type:"error"},{inputs:[{internalType:"address",name:"_signer",type:"address"},{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"bytes",name:"_signature",type:"bytes"}],name:"isValidSig",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_signer",type:"address"},{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"bytes",name:"_signature",type:"bytes"},{internalType:"bool",name:"allowSideEffects",type:"bool"},{internalType:"bool",name:"deployAlreadyDeployed",type:"bool"}],name:"isValidSigImpl",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_signer",type:"address"},{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"bytes",name:"_signature",type:"bytes"}],name:"isValidSigNoThrow",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_signer",type:"address"},{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"bytes",name:"_signature",type:"bytes"}],name:"isValidSigWithSideEffects",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_signer",type:"address"},{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"bytes",name:"_signature",type:"bytes"}],name:"isValidSigWithSideEffectsNoThrow",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"}]}),erc5719:s,erc1271:n,factory:Object.freeze({__proto__:null,abi:[{type:"function",name:"deploy",constant:!1,inputs:[{type:"address"},{type:"bytes32"}],outputs:[],payable:!0,stateMutability:"payable"}]}),mainModule:Object.freeze({__proto__:null,abi:[{type:"function",name:"nonce",constant:!0,inputs:[],outputs:[{type:"uint256"}],payable:!1,stateMutability:"view"},{type:"function",name:"readNonce",constant:!0,inputs:[{type:"uint256"}],outputs:[{type:"uint256"}],payable:!1,stateMutability:"view"},{type:"function",name:"updateImplementation",constant:!1,inputs:[{type:"address"}],outputs:[],payable:!1,stateMutability:"nonpayable"},{type:"function",name:"selfExecute",constant:!1,inputs:[{components:[{type:"bool",name:"delegateCall"},{type:"bool",name:"revertOnError"},{type:"uint256",name:"gasLimit"},{type:"address",name:"target"},{type:"uint256",name:"value"},{type:"bytes",name:"data"}],type:"tuple[]"}],outputs:[],payable:!1,stateMutability:"nonpayable"},{type:"function",name:"execute",constant:!1,inputs:[{components:[{type:"bool",name:"delegateCall"},{type:"bool",name:"revertOnError"},{type:"uint256",name:"gasLimit"},{type:"address",name:"target"},{type:"uint256",name:"value"},{type:"bytes",name:"data"}],type:"tuple[]"},{type:"uint256"},{type:"bytes"}],outputs:[],payable:!1,stateMutability:"nonpayable"},{type:"function",name:"createContract",inputs:[{type:"bytes"}],payable:!0,stateMutability:"payable"},{type:"function",name:"setExtraImageHash",constant:!1,inputs:[{type:"bytes32",name:"imageHash"},{type:"uint256",name:"expiration"}],outputs:[],payable:!1,stateMutability:"nonpayable"}]}),mainModuleUpgradable:Object.freeze({__proto__:null,abi:[{type:"function",name:"updateImageHash",constant:!0,inputs:[{type:"bytes32"}],outputs:[],payable:!1,stateMutability:"view"},{type:"function",name:"imageHash",constant:!0,inputs:[],outputs:[{type:"bytes32"}],payable:!1,stateMutability:"view"}]}),sequenceUtils:Object.freeze({__proto__:null,abi:[{inputs:[{internalType:"address",name:"_factory",type:"address"},{internalType:"address",name:"_mainModule",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_wallet",type:"address"},{indexed:!0,internalType:"bytes32",name:"_imageHash",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"_threshold",type:"uint256"},{indexed:!1,internalType:"bytes",name:"_signers",type:"bytes"}],name:"RequiredConfig",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_wallet",type:"address"},{indexed:!0,internalType:"address",name:"_signer",type:"address"}],name:"RequiredSigner",type:"event"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callBalanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callBlockNumber",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_i",type:"uint256"}],name:"callBlockhash",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"callChainId",outputs:[{internalType:"uint256",name:"id",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callCode",outputs:[{internalType:"bytes",name:"code",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callCodeHash",outputs:[{internalType:"bytes32",name:"codeHash",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_addr",type:"address"}],name:"callCodeSize",outputs:[{internalType:"uint256",name:"size",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callCoinbase",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"callDifficulty",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callGasLeft",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callGasLimit",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callGasPrice",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"callOrigin",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"callTimestamp",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"knownImageHashes",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"lastImageHashUpdate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"lastSignerUpdate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"lastWalletUpdate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"bool",name:"delegateCall",type:"bool"},{internalType:"bool",name:"revertOnError",type:"bool"},{internalType:"uint256",name:"gasLimit",type:"uint256"},{internalType:"address",name:"target",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],internalType:"struct IModuleCalls.Transaction[]",name:"_txs",type:"tuple[]"}],name:"multiCall",outputs:[{internalType:"bool[]",name:"_successes",type:"bool[]"},{internalType:"bytes[]",name:"_results",type:"bytes[]"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"_wallet",type:"address"},{internalType:"uint256",name:"_threshold",type:"uint256"},{components:[{internalType:"uint256",name:"weight",type:"uint256"},{internalType:"address",name:"signer",type:"address"}],internalType:"struct RequireUtils.Member[]",name:"_members",type:"tuple[]"},{internalType:"bool",name:"_index",type:"bool"}],name:"publishConfig",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_wallet",type:"address"},{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"uint256",name:"_sizeMembers",type:"uint256"},{internalType:"bytes",name:"_signature",type:"bytes"},{internalType:"bool",name:"_index",type:"bool"}],name:"publishInitialSigners",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_wallet",type:"address"},{internalType:"uint256",name:"_nonce",type:"uint256"}],name:"requireMinNonce",outputs:[],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_expiration",type:"uint256"}],name:"requireNonExpired",outputs:[],stateMutability:"view",type:"function"}]}),requireFreshSigner:Object.freeze({__proto__:null,abi:[{inputs:[{internalType:"address",name:"",type:"address"}],name:"requireFreshSigner",outputs:[],stateMutability:"nonpayable",type:"function"}]})};var r=Object.freeze({__proto__:null,walletContracts:i});function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},a.apply(this,arguments)}let o=function(e){return e.UNKNOWN="UNKNOWN",e.RUNNING_CHECKS="RUNNING_CHECKS",e.PROCESSING="PROCESSING",e.FAILED="FAILED",e.COMPLETE="COMPLETE",e}({}),c=function(e){return e.UNKNOWN="UNKNOWN",e.SUCCESSFUL="SUCCESSFUL",e.FAILED="FAILED",e}({}),h=function(e){return e.DESC="DESC",e.ASC="ASC",e}({});class l{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/API/",this.ping=e=>this.fetch(this.url("Ping"),d({},e)).then((e=>u(e).then((e=>({status:e.status}))))),this.version=e=>this.fetch(this.url("Version"),d({},e)).then((e=>u(e).then((e=>({version:e.version}))))),this.runtimeStatus=e=>this.fetch(this.url("RuntimeStatus"),d({},e)).then((e=>u(e).then((e=>({status:e.status}))))),this.clock=e=>this.fetch(this.url("Clock"),d({},e)).then((e=>u(e).then((e=>({serverTime:e.serverTime}))))),this.getSequenceContext=e=>this.fetch(this.url("GetSequenceContext"),d({},e)).then((e=>u(e).then((e=>({data:e.data}))))),this.getAuthToken=(e,t)=>this.fetch(this.url("GetAuthToken"),d(e,t)).then((e=>u(e).then((e=>({status:e.status,jwtToken:e.jwtToken,address:e.address,user:e.user}))))),this.getAuthToken2=(e,t)=>this.fetch(this.url("GetAuthToken2"),d(e,t)).then((e=>u(e).then((e=>({status:e.status,jwtToken:e.jwtToken,address:e.address,user:e.user}))))),this.sendPasswordlessLink=(e,t)=>this.fetch(this.url("SendPasswordlessLink"),d(e,t)).then((e=>u(e).then((e=>({status:e.status}))))),this.friendList=(e,t)=>this.fetch(this.url("FriendList"),d(e,t)).then((e=>u(e).then((e=>({page:e.page,friends:e.friends}))))),this.getFriendByAddress=(e,t)=>this.fetch(this.url("GetFriendByAddress"),d(e,t)).then((e=>u(e).then((e=>({status:e.status,friend:e.friend}))))),this.searchFriends=(e,t)=>this.fetch(this.url("SearchFriends"),d(e,t)).then((e=>u(e).then((e=>({friends:e.friends}))))),this.addFriend=(e,t)=>this.fetch(this.url("AddFriend"),d(e,t)).then((e=>u(e).then((e=>({status:e.status,friend:e.friend}))))),this.updateFriendNickname=(e,t)=>this.fetch(this.url("UpdateFriendNickname"),d(e,t)).then((e=>u(e).then((e=>({status:e.status,friend:e.friend}))))),this.removeFriend=(e,t)=>this.fetch(this.url("RemoveFriend"),d(e,t)).then((e=>u(e).then((e=>({status:e.status}))))),this.contractCall=(e,t)=>this.fetch(this.url("ContractCall"),d(e,t)).then((e=>u(e).then((e=>({returns:e.returns}))))),this.decodeContractCall=(e,t)=>this.fetch(this.url("DecodeContractCall"),d(e,t)).then((e=>u(e).then((e=>({call:e.call}))))),this.lookupContractCallSelectors=(e,t)=>this.fetch(this.url("LookupContractCallSelectors"),d(e,t)).then((e=>u(e).then((e=>({signatures:e.signatures}))))),this.userStorageFetch=(e,t)=>this.fetch(this.url("UserStorageFetch"),d(e,t)).then((e=>u(e).then((e=>({object:e.object}))))),this.userStorageSave=(e,t)=>this.fetch(this.url("UserStorageSave"),d(e,t)).then((e=>u(e).then((e=>({ok:e.ok}))))),this.userStorageDelete=(e,t)=>this.fetch(this.url("UserStorageDelete"),d(e,t)).then((e=>u(e).then((e=>({ok:e.ok}))))),this.userStorageFetchAll=(e,t)=>this.fetch(this.url("UserStorageFetchAll"),d(e,t)).then((e=>u(e).then((e=>({objects:e.objects}))))),this.getMoonpayLink=(e,t)=>this.fetch(this.url("GetMoonpayLink"),d(e,t)).then((e=>u(e).then((e=>({signedUrl:e.signedUrl}))))),this.getSardineClientToken=e=>this.fetch(this.url("GetSardineClientToken"),d({},e)).then((e=>u(e).then((e=>({token:e.token}))))),this.isUsingGoogleMail=(e,t)=>this.fetch(this.url("IsUsingGoogleMail"),d(e,t)).then((e=>u(e).then((e=>({yes:e.yes}))))),this.resolveENSAddress=(e,t)=>this.fetch(this.url("ResolveENSAddress"),d(e,t)).then((e=>u(e).then((e=>({address:e.address,ok:e.ok}))))),this.isValidSignature=(e,t)=>this.fetch(this.url("IsValidSignature"),d(e,t)).then((e=>u(e).then((e=>({isValid:e.isValid}))))),this.isValidMessageSignature=(e,t)=>this.fetch(this.url("IsValidMessageSignature"),d(e,t)).then((e=>u(e).then((e=>({isValid:e.isValid}))))),this.isValidTypedDataSignature=(e,t)=>this.fetch(this.url("IsValidTypedDataSignature"),d(e,t)).then((e=>u(e).then((e=>({isValid:e.isValid}))))),this.isValidETHAuthProof=(e,t)=>this.fetch(this.url("IsValidETHAuthProof"),d(e,t)).then((e=>u(e).then((e=>({isValid:e.isValid}))))),this.getCoinPrices=(e,t)=>this.fetch(this.url("GetCoinPrices"),d(e,t)).then((e=>u(e).then((e=>({tokenPrices:e.tokenPrices}))))),this.getCollectiblePrices=(e,t)=>this.fetch(this.url("GetCollectiblePrices"),d(e,t)).then((e=>u(e).then((e=>({tokenPrices:e.tokenPrices}))))),this.getExchangeRate=(e,t)=>this.fetch(this.url("GetExchangeRate"),d(e,t)).then((e=>u(e).then((e=>({exchangeRate:e.exchangeRate}))))),this.memoryStore=(e,t)=>this.fetch(this.url("MemoryStore"),d(e,t)).then((e=>u(e).then((e=>({ok:e.ok}))))),this.memoryLoad=(e,t)=>this.fetch(this.url("MemoryLoad"),d(e,t)).then((e=>u(e).then((e=>({value:e.value}))))),this.listPayCardsOnFile=e=>this.fetch(this.url("ListPayCardsOnFile"),d({},e)).then((e=>u(e).then((e=>({payCards:e.payCards}))))),this.savePayCard=(e,t)=>this.fetch(this.url("SavePayCard"),d(e,t)).then((e=>u(e).then((e=>({ok:e.ok,payCard:e.payCard}))))),this.updatePayCardCVC=(e,t)=>this.fetch(this.url("UpdatePayCardCVC"),d(e,t)).then((e=>u(e).then((e=>({ok:e.ok}))))),this.deletePayCard=(e,t)=>this.fetch(this.url("DeletePayCard"),d(e,t)).then((e=>u(e).then((e=>({ok:e.ok}))))),this.smartRampQuote=(e,t)=>this.fetch(this.url("SmartRampQuote"),d(e,t)).then((e=>u(e).then((e=>({status:e.status,quoteDetails:e.quoteDetails}))))),this.smartRampPurchase=(e,t)=>this.fetch(this.url("SmartRampPurchase"),d(e,t)).then((e=>u(e).then((e=>({processing:e.processing,receipt:e.receipt}))))),this.smartRampWaitOrderConfirmation=(e,t)=>this.fetch(this.url("SmartRampWaitOrderConfirmation"),d(e,t)).then((e=>u(e).then((e=>({done:e.done,receipt:e.receipt}))))),this.smartRampGetOrder=(e,t)=>this.fetch(this.url("SmartRampGetOrder"),d(e,t)).then((e=>u(e).then((e=>({order:e.order}))))),this.smartRampCheckCardAuthorization=(e,t)=>this.fetch(this.url("SmartRampCheckCardAuthorization"),d(e,t)).then((e=>u(e).then((e=>({cardAuth:e.cardAuth}))))),this.smartRampOrdersList=(e,t)=>this.fetch(this.url("SmartRampOrdersList"),d(e,t)).then((e=>u(e).then((e=>({page:e.page,orders:e.orders}))))),this.smartRampGetOrderTxnHash=(e,t)=>this.fetch(this.url("SmartRampGetOrderTxnHash"),d(e,t)).then((e=>u(e).then((e=>({txnHash:e.txnHash,txnSuccessful:e.txnSuccessful}))))),this.smartRampSubmitCardAuthorization=(e,t)=>this.fetch(this.url("SmartRampSubmitCardAuthorization"),d(e,t)).then((e=>u(e).then((e=>({status:e.status}))))),this.adminSmartRampGetOrder=(e,t)=>this.fetch(this.url("AdminSmartRampGetOrder"),d(e,t)).then((e=>u(e).then((e=>({order:e.order}))))),this.adminSmartRampListCompletedOrders=(e,t)=>this.fetch(this.url("AdminSmartRampListCompletedOrders"),d(e,t)).then((e=>u(e).then((e=>({orders:e.orders}))))),this.adminSmartRampListPendingOrders=(e,t)=>this.fetch(this.url("AdminSmartRampListPendingOrders"),d(e,t)).then((e=>u(e).then((e=>({pendingOrders:e.pendingOrders}))))),this.getInviteInfo=e=>this.fetch(this.url("GetInviteInfo"),d({},e)).then((e=>u(e).then((e=>({inviteInfo:e.inviteInfo}))))),this.isValidAccessCode=(e,t)=>this.fetch(this.url("IsValidAccessCode"),d(e,t)).then((e=>u(e).then((e=>({status:e.status}))))),this.internalClaimAccessCode=(e,t)=>this.fetch(this.url("InternalClaimAccessCode"),d(e,t)).then((e=>u(e).then((e=>({status:e.status}))))),this.blockNumberAtTime=(e,t)=>this.fetch(this.url("BlockNumberAtTime"),d(e,t)).then((e=>u(e).then((e=>({blocks:e.blocks}))))),this.paperSessionSecret=(e,t)=>this.fetch(this.url("PaperSessionSecret"),d(e,t)).then((e=>u(e).then((e=>({secret:e.secret}))))),this.paperSessionSecret2=(e,t)=>this.fetch(this.url("PaperSessionSecret2"),d(e,t)).then((e=>u(e).then((e=>({secret:e.secret}))))),this.linkWallet=(e,t)=>this.fetch(this.url("LinkWallet"),d(e,t)).then((e=>u(e).then((e=>({status:e.status,linkedWalletAddress:e.linkedWalletAddress}))))),this.getLinkedWallets=(e,t)=>this.fetch(this.url("GetLinkedWallets"),d(e,t)).then((e=>u(e).then((e=>({linkedWallets:e.linkedWallets}))))),this.hostname=e,this.fetch=(e,s)=>t(e,s)}url(e){return this.hostname+this.path+e}}const d=(e={},t={})=>({method:"POST",headers:a({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}),u=e=>e.text().then((t=>{let s;try{s=JSON.parse(t)}catch(s){throw{code:"unknown",msg:`expecting JSON, got: ${t}`,status:e.status}}if(!e.ok)throw s;return s})),f="object"==typeof global?global.fetch:window.fetch;class g extends l{constructor(e,t,s){super(e.endsWith("/")?e.slice(0,-1):e,f),this.projectAccessKey=t,this.jwtAuth=s,this._fetch=(e,t)=>{const s={},n=this.jwtAuth,i=this.projectAccessKey;return n&&n.length>0&&(s.Authorization=`BEARER ${n}`),i&&i.length>0&&(s["X-Access-Key"]=i),t.headers=a({},t.headers,s),f(e,t)},this.fetch=this._fetch}}var p=Object.freeze({__proto__:null,WebRPCVersion:"v1",WebRPCSchemaVersion:"v0.4.0",WebRPCSchemaHash:"8c9ba9b9d3c5836bfb8eadcc78cdc2a929fcfb0d",SmartRampOrderStatus:o,SmartRampTxnStatus:c,SortOrder:h,API:l,SequenceAPIClient:g});const m="function"==typeof atob,y="function"==typeof btoa,w="function"==typeof Buffer,v="function"==typeof TextDecoder?new TextDecoder:void 0,b="function"==typeof TextEncoder?new TextEncoder:void 0,I=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),E=(e=>{let t={};return e.forEach(((e,s)=>t[e]=s)),t})(I),C=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,S=String.fromCharCode.bind(String),k="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),T=e=>e.replace(/=/g,"").replace(/[+\/]/g,(e=>"+"==e?"-":"_")),_=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),O=e=>{let t,s,n,i,r="";const a=e.length%3;for(let a=0;a<e.length;){if((s=e.charCodeAt(a++))>255||(n=e.charCodeAt(a++))>255||(i=e.charCodeAt(a++))>255)throw new TypeError("invalid character found");t=s<<16|n<<8|i,r+=I[t>>18&63]+I[t>>12&63]+I[t>>6&63]+I[63&t]}return a?r.slice(0,a-3)+"===".substring(a):r},N=y?e=>btoa(e):w?e=>Buffer.from(e,"binary").toString("base64"):O,A=w?e=>Buffer.from(e).toString("base64"):e=>{let t=[];for(let s=0,n=e.length;s<n;s+=4096)t.push(S.apply(null,e.subarray(s,s+4096)));return N(t.join(""))},x=e=>{if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?S(192|t>>>6)+S(128|63&t):S(224|t>>>12&15)+S(128|t>>>6&63)+S(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return S(240|t>>>18&7)+S(128|t>>>12&63)+S(128|t>>>6&63)+S(128|63&t)},P=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,M=e=>e.replace(P,x),R=w?e=>Buffer.from(e,"utf8").toString("base64"):b?e=>A(b.encode(e)):e=>N(M(e)),L=(e,t=!1)=>t?T(R(e)):R(e),D=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,B=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return S(55296+(t>>>10))+S(56320+(1023&t));case 3:return S((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return S((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},U=e=>e.replace(D,B),H=e=>{if(e=e.replace(/\s+/g,""),!C.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,s,n,i="";for(let r=0;r<e.length;)t=E[e.charAt(r++)]<<18|E[e.charAt(r++)]<<12|(s=E[e.charAt(r++)])<<6|(n=E[e.charAt(r++)]),i+=64===s?S(t>>16&255):64===n?S(t>>16&255,t>>8&255):S(t>>16&255,t>>8&255,255&t);return i},j=m?e=>atob(_(e)):w?e=>Buffer.from(e,"base64").toString("binary"):H,W=w?e=>k(Buffer.from(e,"base64")):e=>k(j(e).split("").map((e=>e.charCodeAt(0)))),q=w?e=>Buffer.from(e,"base64").toString("utf8"):v?e=>v.decode(W(e)):e=>U(j(e)),$=e=>_(e.replace(/[-_]/g,(e=>"-"==e?"+":"/"))),F=e=>q($(e)),G=L,V=F;var K=function(){return K=Object.assign||function(e){for(var t,s=1,n=arguments.length;s<n;s++)for(var i in t=arguments[s])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},K.apply(this,arguments)};function J(e,t,s,n){return new(s||(s=Promise))((function(i,r){function a(e){try{c(n.next(e))}catch(e){r(e)}}function o(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}c((n=n.apply(e,t||[])).next())}))}function z(e,t){var s,n,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(o){return function(c){return function(o){if(s)throw new TypeError("Generator is already executing.");for(;r&&(r=0,o[0]&&(a=0)),a;)try{if(s=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{s=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}var Y=function(){function e(e){this.prefix=se,this.address=(null==e?void 0:e.address)?e.address.toLowerCase():"",this.claims=(null==e?void 0:e.claims)?e.claims:{app:"",iat:0,exp:0,v:te},this.signature=(null==e?void 0:e.signature)?e.signature:"",this.extra=(null==e?void 0:e.extra)?e.extra:""}return e.prototype.setIssuedAtNow=function(){this.claims.iat=Math.round((new Date).getTime()/1e3)},e.prototype.setExpiryIn=function(e){this.claims.exp=Math.round((new Date).getTime()/1e3)+e},e.prototype.validateClaims=function(){return Z(this.claims)},e.prototype.messageDigest=function(){var e,s=this.validateClaims();if(s.err)throw s.err;return t.ethers.utils.arrayify((e=this.messageTypedData(),t.ethers.utils._TypedDataEncoder.hash(e.domain,e.types,e.message)))},e.prototype.messageTypedData=function(){var e={domain:K({},ne),types:{Claims:[]},message:{}};return this.claims.app&&this.claims.app.length>0&&(e.types.Claims.push({name:"app",type:"string"}),e.message.app=this.claims.app),this.claims.iat&&this.claims.iat>0&&(e.types.Claims.push({name:"iat",type:"int64"}),e.message.iat=this.claims.iat),this.claims.exp&&this.claims.exp>0&&(e.types.Claims.push({name:"exp",type:"int64"}),e.message.exp=this.claims.exp),this.claims.n&&this.claims.n>0&&(e.types.Claims.push({name:"n",type:"uint64"}),e.message.n=this.claims.n),this.claims.typ&&this.claims.typ.length>0&&(e.types.Claims.push({name:"typ",type:"string"}),e.message.typ=this.claims.typ),this.claims.ogn&&this.claims.ogn.length>0&&(e.types.Claims.push({name:"ogn",type:"string"}),e.message.ogn=this.claims.ogn),this.claims.v&&this.claims.v.length>0&&(e.types.Claims.push({name:"v",type:"string"}),e.message.v=this.claims.v),e},e}(),Z=function(e){if(""===e.app)return{ok:!1,err:new Error("claims: app is empty")};var t=Math.round((new Date).getTime()/1e3),s=31536300;return""===e.v?{ok:!1,err:new Error("claims: ethauth version is empty")}:e.iat&&0!==e.iat&&(e.iat>t+300||e.iat<t-s)?{ok:!1,err:new Error("claims: iat is invalid")}:e.exp<t-300||e.exp>t+s?{ok:!1,err:new Error("claims: token has expired")}:{ok:!0}},Q=function(e,s,n){return J(void 0,void 0,void 0,(function(){var e,s;return z(this,(function(i){return e=n.messageDigest(),"0x"===(s=t.ethers.utils.verifyMessage(e,n.signature)).slice(0,2)&&42===s.length&&s.toLowerCase()===n.address.toLowerCase()?[2,{isValid:!0,address:n.address}]:[2,{isValid:!1}]}))}))},X=function(e,s,n){return J(void 0,void 0,void 0,(function(){var s,i,r;return z(this,(function(a){switch(a.label){case 0:return e&&void 0!==e?(s=n.messageDigest(),[4,e.getCode(n.address)]):[2,{isValid:!1}];case 1:if("0x"===(i=a.sent())||i.length<=2)throw new Error("ValidateContractAccountProof failed. unable to fetch wallet contract code");return r=["function isValidSignature(bytes32, bytes) public view returns (bytes4)"],[4,new t.ethers.Contract(n.address,r,e).isValidSignature(s,t.ethers.utils.arrayify(n.signature))];case 2:return a.sent()===ee?[2,{isValid:!0,address:n.address}]:[2,{isValid:!1}]}}))}))},ee="0x1626ba7e",te="1",se="eth",ne={name:"ETHAuth",version:te},ie=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];var n=this;this.configJsonRpcProvider=function(e){return J(n,void 0,void 0,(function(){var s;return z(this,(function(n){switch(n.label){case 0:return this.provider=new t.ethers.providers.JsonRpcProvider(e),[4,this.provider.send("net_version",[])];case 1:if(s=n.sent(),this.chainId=parseInt(s),!this.chainId||0===this.chainId||NaN===this.chainId)throw new Error("ethauth: unable to get chainId");return this.ethereumJsonRpcURL=e,[2]}}))}))},this.configValidators=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0==e.length)throw new Error("validators list is empty");n.validators=e},this.encodeProof=function(e,t){return void 0===t&&(t=!1),J(n,void 0,void 0,(function(){var s,n;return z(this,(function(i){switch(i.label){case 0:if(42!==e.address.length||"0x"!==e.address.slice(0,2))throw new Error("ethauth: invalid address");if(""===e.signature||"0x"!==e.signature.slice(0,2))throw new Error("ethauth: invalid signature");if(e.extra&&"0x"!==e.extra.slice(0,2))throw new Error("ethauth: invalid extra encoding, expecting hex data");return[4,this.validateProof(e,t)];case 1:if(!i.sent())throw new Error("ethauth: proof is invalid");return s=JSON.stringify(e.claims),n=se+"."+e.address.toLowerCase()+"."+G(s,!0)+"."+e.signature,e.extra&&e.extra.length>0&&(n+="."+e.extra),[2,n]}}))}))},this.decodeProof=function(e,t){return void 0===t&&(t=!1),J(n,void 0,void 0,(function(){var s,n,i,r,a,o,c,h,l;return z(this,(function(d){switch(d.label){case 0:if((s=e.split(".")).length<4||s.length>5)throw new Error("ethauth: invalid proof string");if(n=s[0],i=s[1],r=s[2],a=s[3],o=s[4],n!==se)throw new Error("ethauth: not an ethauth proof");return c=V(r),h=JSON.parse(c),l=new Y({address:i,claims:h,signature:a,extra:o}),[4,this.validateProof(l,t)];case 1:if(!d.sent())throw new Error("ethauth: proof is invalid");return[2,l]}}))}))},this.validateProof=function(e,t){return void 0===t&&(t=!1),J(n,void 0,void 0,(function(){var s;return z(this,(function(n){switch(n.label){case 0:if((s=this.validateProofClaims(e)).err)throw new Error("ethauth: proof claims are invalid ".concat(s.err));return!0===t?[3,2]:[4,this.validateProofSignature(e)];case 1:if(!0!==n.sent())throw new Error("ethauth: proof signature is invalid");n.label=2;case 2:return[2,!0]}}))}))},this.validateProofSignature=function(e){return J(n,void 0,void 0,(function(){var t,s,n;return z(this,(function(i){switch(i.label){case 0:t=[],n=0,i.label=1;case 1:if(!(n<this.validators.length))return[3,6];i.label=2;case 2:return i.trys.push([2,4,,5]),[4,(0,this.validators[n])(this.provider,this.chainId,e)];case 3:return!0===(s=i.sent().isValid)?[2,!0]:(t.push(s),[3,5]);case 4:return i.sent(),t.push(!1),[3,5];case 5:return n++,[3,1];case 6:for(n=0;n<t.length;n++)if(t[n])return[2,!0];return[2,!1]}}))}))},this.validateProofClaims=function(e){return e.validateClaims()},0==e.length?this.validators=[Q,X]:this.validators=e};let re=function(e){return e[e.MAINNET=1]="MAINNET",e[e.ROPSTEN=3]="ROPSTEN",e[e.RINKEBY=4]="RINKEBY",e[e.GOERLI=5]="GOERLI",e[e.KOVAN=42]="KOVAN",e[e.SEPOLIA=11155111]="SEPOLIA",e[e.POLYGON=137]="POLYGON",e[e.POLYGON_MUMBAI=80001]="POLYGON_MUMBAI",e[e.POLYGON_ZKEVM=1101]="POLYGON_ZKEVM",e[e.BSC=56]="BSC",e[e.BSC_TESTNET=97]="BSC_TESTNET",e[e.OPTIMISM=10]="OPTIMISM",e[e.OPTIMISM_KOVAN=69]="OPTIMISM_KOVAN",e[e.OPTIMISM_GOERLI=420]="OPTIMISM_GOERLI",e[e.OPTIMISM_SEPOLIA=11155420]="OPTIMISM_SEPOLIA",e[e.ARBITRUM=42161]="ARBITRUM",e[e.ARBITRUM_GOERLI=421613]="ARBITRUM_GOERLI",e[e.ARBITRUM_SEPOLIA=421614]="ARBITRUM_SEPOLIA",e[e.ARBITRUM_NOVA=42170]="ARBITRUM_NOVA",e[e.AVALANCHE=43114]="AVALANCHE",e[e.AVALANCHE_TESTNET=43113]="AVALANCHE_TESTNET",e[e.GNOSIS=100]="GNOSIS",e[e.BASE=8453]="BASE",e[e.BASE_GOERLI=84531]="BASE_GOERLI",e[e.BASE_SEPOLIA=84532]="BASE_SEPOLIA",e[e.HOMEVERSE_TESTNET=40875]="HOMEVERSE_TESTNET",e[e.HOMEVERSE=19011]="HOMEVERSE",e[e.HARDHAT=31337]="HARDHAT",e[e.HARDHAT_2=31338]="HARDHAT_2",e}({}),ae=function(e){return e.MAINNET="mainnet",e.TESTNET="testnet",e}({});const oe={[re.MAINNET]:{chainId:re.MAINNET,type:ae.MAINNET,name:"mainnet",title:"Ethereum",logoURI:`https://assets.sequence.info/images/networks/medium/${re.MAINNET}.webp`,blockExplorer:{name:"Etherscan",rootUrl:"https://etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e"},[re.ROPSTEN]:{chainId:re.ROPSTEN,type:ae.TESTNET,name:"ropsten",title:"Ropsten",logoURI:`https://assets.sequence.info/images/networks/medium/${re.ROPSTEN}.webp`,testnet:!0,blockExplorer:{name:"Etherscan (Ropsten)",rootUrl:"https://ropsten.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",deprecated:!0},[re.RINKEBY]:{chainId:re.RINKEBY,type:ae.TESTNET,name:"rinkeby",title:"Rinkeby",logoURI:`https://assets.sequence.info/images/networks/medium/${re.RINKEBY}.webp`,testnet:!0,blockExplorer:{name:"Etherscan (Rinkeby)",rootUrl:"https://rinkeby.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",deprecated:!0},[re.GOERLI]:{chainId:re.GOERLI,type:ae.TESTNET,name:"goerli",title:"Goerli",logoURI:`https://assets.sequence.info/images/networks/medium/${re.GOERLI}.webp`,testnet:!0,blockExplorer:{name:"Etherscan (Goerli)",rootUrl:"https://goerli.etherscan.io/"},ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",deprecated:!0},[re.KOVAN]:{chainId:re.KOVAN,type:ae.TESTNET,name:"kovan",title:"Kovan",logoURI:`https://assets.sequence.info/images/networks/medium/${re.KOVAN}.webp`,testnet:!0,blockExplorer:{name:"Etherscan (Kovan)",rootUrl:"https://kovan.etherscan.io/"},deprecated:!0},[re.SEPOLIA]:{chainId:re.SEPOLIA,type:ae.TESTNET,name:"sepolia",title:"Sepolia",logoURI:`https://assets.sequence.info/images/networks/medium/${re.SEPOLIA}.webp`,testnet:!0,blockExplorer:{name:"Etherscan (Sepolia)",rootUrl:"https://sepolia.etherscan.io/"}},[re.POLYGON]:{chainId:re.POLYGON,type:ae.MAINNET,name:"polygon",title:"Polygon",logoURI:`https://assets.sequence.info/images/networks/medium/${re.POLYGON}.webp`,blockExplorer:{name:"Polygonscan",rootUrl:"https://polygonscan.com/"}},[re.POLYGON_MUMBAI]:{chainId:re.POLYGON_MUMBAI,type:ae.TESTNET,name:"mumbai",title:"Polygon Mumbai",logoURI:`https://assets.sequence.info/images/networks/medium/${re.POLYGON_MUMBAI}.webp`,testnet:!0,blockExplorer:{name:"Polygonscan (Mumbai)",rootUrl:"https://mumbai.polygonscan.com/"}},[re.POLYGON_ZKEVM]:{chainId:re.POLYGON_ZKEVM,type:ae.MAINNET,name:"polygon-zkevm",title:"Polygon zkEVM",logoURI:`https://assets.sequence.info/images/networks/medium/${re.POLYGON_ZKEVM}.webp`,blockExplorer:{name:"Polygonscan (zkEVM)",rootUrl:"https://zkevm.polygonscan.com/"}},[re.BSC]:{chainId:re.BSC,type:ae.MAINNET,name:"bsc",title:"BNB Smart Chain",logoURI:`https://assets.sequence.info/images/networks/medium/${re.BSC}.webp`,blockExplorer:{name:"BSCScan",rootUrl:"https://bscscan.com/"}},[re.BSC_TESTNET]:{chainId:re.BSC_TESTNET,type:ae.TESTNET,name:"bsc-testnet",title:"BNB Smart Chain Testnet",logoURI:`https://assets.sequence.info/images/networks/medium/${re.BSC_TESTNET}.webp`,testnet:!0,blockExplorer:{name:"BSCScan (Testnet)",rootUrl:"https://testnet.bscscan.com/"}},[re.OPTIMISM]:{chainId:re.OPTIMISM,type:ae.MAINNET,name:"optimism",title:"Optimism",logoURI:`https://assets.sequence.info/images/networks/medium/${re.OPTIMISM}.webp`,blockExplorer:{name:"Etherscan (Optimism)",rootUrl:"https://optimistic.etherscan.io/"}},[re.OPTIMISM_KOVAN]:{chainId:re.OPTIMISM_KOVAN,type:ae.TESTNET,name:"optimism-kovan",title:"Optimistic Kovan",logoURI:`https://assets.sequence.info/images/networks/medium/${re.OPTIMISM_KOVAN}.webp`,testnet:!0,blockExplorer:{name:"Etherscan (Optimism Kovan)",rootUrl:"https://kovan-optimistic.etherscan.io/"},deprecated:!0},[re.OPTIMISM_GOERLI]:{chainId:re.OPTIMISM_GOERLI,type:ae.TESTNET,name:"optimism-goerli",title:"Optimistic Goerli",logoURI:`https://assets.sequence.info/images/networks/medium/${re.OPTIMISM_GOERLI}.webp`,testnet:!0,blockExplorer:{name:"Etherscan (Optimism Goerli)",rootUrl:"https://goerli-optimistic.etherscan.io/"},deprecated:!0},[re.OPTIMISM_SEPOLIA]:{chainId:re.OPTIMISM_SEPOLIA,type:ae.TESTNET,name:"optimism-sepolia",title:"Optimistic Sepolia",logoURI:`https://assets.sequence.info/images/networks/medium/${re.OPTIMISM_SEPOLIA}.webp`,testnet:!0,blockExplorer:{name:"Etherscan (Optimism Sepolia)",rootUrl:"https://sepolia-optimistic.etherscan.io/"}},[re.ARBITRUM]:{chainId:re.ARBITRUM,type:ae.MAINNET,name:"arbitrum",title:"Arbitrum One",logoURI:`https://assets.sequence.info/images/networks/medium/${re.ARBITRUM}.webp`,blockExplorer:{name:"Arbiscan",rootUrl:"https://arbiscan.io/"}},[re.ARBITRUM_GOERLI]:{chainId:re.ARBITRUM_GOERLI,type:ae.TESTNET,name:"arbitrum-goerli",title:"Arbitrum Goerli",logoURI:`https://assets.sequence.info/images/networks/medium/${re.ARBITRUM_GOERLI}.webp`,testnet:!0,blockExplorer:{name:"Arbiscan (Goerli Testnet)",rootUrl:"https://testnet.arbiscan.io/"},deprecated:!0},[re.ARBITRUM_SEPOLIA]:{chainId:re.ARBITRUM_SEPOLIA,type:ae.TESTNET,name:"arbitrum-sepolia",title:"Arbitrum Sepolia",logoURI:`https://assets.sequence.info/images/networks/medium/${re.ARBITRUM_SEPOLIA}.webp`,testnet:!0,blockExplorer:{name:"Arbiscan (Sepolia Testnet)",rootUrl:"https://sepolia.arbiscan.io/"}},[re.ARBITRUM_NOVA]:{chainId:re.ARBITRUM_NOVA,type:ae.MAINNET,name:"arbitrum-nova",title:"Arbitrum Nova",logoURI:`https://assets.sequence.info/images/networks/medium/${re.ARBITRUM_NOVA}.webp`,blockExplorer:{name:"Arbiscan Nova",rootUrl:"https://nova.arbiscan.io/"}},[re.AVALANCHE]:{chainId:re.AVALANCHE,type:ae.MAINNET,name:"avalanche",title:"Avalanche",logoURI:`https://assets.sequence.info/images/networks/medium/${re.AVALANCHE}.webp`,blockExplorer:{name:"Snowtrace",rootUrl:"https://subnets.avax.network/c-chain/"}},[re.AVALANCHE_TESTNET]:{chainId:re.AVALANCHE_TESTNET,type:ae.TESTNET,name:"avalanche-testnet",title:"Avalanche Testnet",logoURI:`https://assets.sequence.info/images/networks/medium/${re.AVALANCHE_TESTNET}.webp`,testnet:!0,blockExplorer:{name:"Snowtrace (Testnet)",rootUrl:"https://subnets-test.avax.network/c-chain/"}},[re.GNOSIS]:{chainId:re.GNOSIS,type:ae.MAINNET,name:"gnosis",title:"Gnosis Chain",logoURI:`https://assets.sequence.info/images/networks/medium/${re.GNOSIS}.webp`,blockExplorer:{name:"Gnosis Chain Explorer",rootUrl:"https://blockscout.com/xdai/mainnet/"}},[re.BASE]:{chainId:re.BASE,type:ae.MAINNET,name:"base",title:"Base (Coinbase)",logoURI:`https://assets.sequence.info/images/networks/medium/${re.BASE}.webp`,blockExplorer:{name:"Base Explorer",rootUrl:"https://basescan.org/"}},[re.BASE_GOERLI]:{chainId:re.BASE_GOERLI,type:ae.TESTNET,name:"base-goerli",title:"Base Goerli",logoURI:`https://assets.sequence.info/images/networks/medium/${re.BASE_GOERLI}.webp`,testnet:!0,blockExplorer:{name:"Base Goerli Explorer",rootUrl:"https://goerli.basescan.org/"},deprecated:!0},[re.BASE_SEPOLIA]:{chainId:re.BASE_SEPOLIA,type:ae.TESTNET,name:"base-sepolia",title:"Base Sepolia",logoURI:`https://assets.sequence.info/images/networks/medium/${re.BASE_SEPOLIA}.webp`,testnet:!0,blockExplorer:{name:"Base Sepolia Explorer",rootUrl:"https://base-sepolia.blockscout.com/"}},[re.HOMEVERSE]:{chainId:re.HOMEVERSE,type:ae.MAINNET,name:"homeverse",title:"Oasys Homeverse",logoURI:`https://assets.sequence.info/images/networks/medium/${re.HOMEVERSE}.webp`,blockExplorer:{name:"Oasys Homeverse Explorer",rootUrl:"https://explorer.oasys.homeverse.games/"}},[re.HOMEVERSE_TESTNET]:{chainId:re.HOMEVERSE_TESTNET,type:ae.TESTNET,name:"homeverse-testnet",title:"Oasys Homeverse Testnet",logoURI:`https://assets.sequence.info/images/networks/medium/${re.HOMEVERSE_TESTNET}.webp`,testnet:!0,blockExplorer:{name:"Oasys Homeverse Explorer (Testnet)",rootUrl:"https://explorer.testnet.oasys.homeverse.games/"}},[re.HARDHAT]:{chainId:re.HARDHAT,name:"hardhat",title:"Hardhat (local testnet)"},[re.HARDHAT_2]:{chainId:re.HARDHAT_2,name:"hardhat2",title:"Hardhat (local testnet)"}};const ce=e=>"number"==typeof e?e:e.chainId?e.chainId:t.ethers.BigNumber.from(e).toNumber(),he=(e,t=!1,s=!1)=>{if(!e)throw new Error("invalid network config: empty config");const n=[];if(Array.isArray(e)?n.push(...e):n.push(e),0===n.length){if(t)throw new Error("invalid network config: empty config");return!1}const i=n.map((e=>e.chainId)).sort(),r=i.filter(((e,t)=>i.indexOf(e)!==t));if(r.length>0){if(t)throw new Error(`invalid network config: duplicate chainIds ${r}`);return!1}n.forEach((e=>e.name=e.name.toLowerCase()));const a=n.map((e=>e.name)).sort(),o=a.filter(((e,t)=>a.indexOf(e)!==t));if(o.length>0){if(t)throw new Error(`invalid network config: duplicate network names ${o}`);return!1}let c=!1;for(let e=0;e<n.length;e++){const i=n[e];if(!(i.rpcUrl&&""!==i.rpcUrl||i.provider)){if(t)throw new Error(`invalid network config for chainId ${i.chainId}: rpcUrl or provider must be provided`);return!1}if(!s&&!i.relayer){if(t)throw new Error(`invalid network config for chainId ${i.chainId}: relayer must be provided`);return!1}if(i.isDefaultChain){if(c){if(t)throw new Error(`invalid network config for chainId ${i.chainId}: DefaultChain is already set by another config`);return!1}c=!0}}if(!c){if(t)throw new Error("invalid network config: DefaultChain must be set");return!1}return!0},le=(e,t=!1)=>(he(e,!0,t),e),de=e=>le(fe(e)),ue=(e,s)=>{if("string"==typeof s){if(s.startsWith("0x")){const n=t.ethers.BigNumber.from(s).toNumber();return e.find((e=>e.chainId===n))}return e.find((e=>e.name===s||`${e.chainId}`===s))}if("number"==typeof s)return e.find((e=>e.chainId===s));if(s.chainId)return e.find((e=>e.chainId===s.chainId));if(t.ethers.BigNumber.isBigNumber(s)){const t=s.toNumber();return e.find((e=>e.chainId===t))}},fe=e=>{if(!e)return[];const t=e.sort(((e,t)=>e.chainId===t.chainId?0:e.chainId<t.chainId?-1:1)),s=t.findIndex((e=>e.isDefaultChain));return s>0&&t.splice(0,0,t.splice(s,1)[0]),t},ge=(e,t)=>"string"==typeof e?(t=t||{},e.replace(/\$\{\s*([$#@\-\d\w]+)\s*\}/gim,(function(e,s){let n=t[s];return n="function"==typeof n?n():null==n?"":"object"==typeof n||"symbol"==typeof n?n.toString():n.valueOf(),n}))):"",pe=e=>G(JSON.stringify(e),!0),me=e=>{if(null!=e)return JSON.parse(V(e))};function ye(e){return null!=e&&(t.BigNumber.isBigNumber(e)||"number"==typeof e&&e%1==0||"string"==typeof e&&!!e.match(/^-?[0-9]+$/)||t.utils.isHexString(e)||"bigint"==typeof e||t.utils.isBytes(e))}const we=e=>"string"==typeof e?t.ethers.utils.arrayify(t.ethers.utils.keccak256(t.ethers.utils.toUtf8Bytes(e))):t.ethers.utils.arrayify(t.ethers.utils.keccak256(e)),ve=(e,s,n)=>t.ethers.utils.solidityPack(["string","uint256","address","bytes32"],["",s,e,n]),be=(e,s,n)=>t.ethers.utils.keccak256(ve(e,s,n)),Ie=()=>!1,Ee=e=>{const t=e.split(".");if(3!==t.length)throw new Error("invalid jwt");return JSON.parse(V(t[1]))};var Ce=function(e){return e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.DISABLED=5]="DISABLED",e}(Ce||{});class Se{constructor(e){this.config=e,this.logLevel=void 0,this.configure(e)}configure(e){switch(this.config=a({},this.config,e),this.config.logLevel){case"DEBUG":this.logLevel=Ce.DEBUG;break;case"INFO":default:this.logLevel=Ce.INFO;break;case"WARN":this.logLevel=Ce.WARN;break;case"ERROR":this.logLevel=Ce.ERROR;break;case"DISABLED":this.logLevel=Ce.DISABLED}void 0===this.config.silence&&(this.config.silence=!1)}debug(e,...t){!0!==this.config.silence&&this.logLevel===Ce.DEBUG&&console.log(e,...t)}info(e,...t){!0!==this.config.silence&&this.logLevel<=Ce.INFO&&console.log(e,...t)}warn(e,...t){!0!==this.config.silence&&this.logLevel<=Ce.WARN&&(console.warn(e,...t),this.config.onwarn&&this.config.onwarn(e,t))}error(e,...t){!0!==this.config.silence&&this.logLevel<=Ce.ERROR&&(console.error(e,...t),this.config.onerror&&this.config.onerror(e,t))}}const ke=new Se({logLevel:"INFO",silence:!0}),Te=(e,t,s)=>{const n={};return s&&s.length>0&&(n.Authorization=`BEARER ${s}`),t&&t.length>0&&(n["X-Access-Key"]=t),{url:e,headers:n,skipFetchSetup:!0,fetchOptions:{mode:"cors",cache:"force-cache",credentials:"same-origin",redirect:"follow",referrer:"client"}}};function _e(e,t){return"object"!=typeof t||null===t||Array.isArray(t)?t:Object.fromEntries(Object.entries(t).sort())}function Oe(e,t){return function(...s){const n=Array.prototype.slice.call(s);return new Promise((async(s,i)=>{try{n.push(((e,t)=>e?i(e):s(t))),await e.apply(t,n)}catch(e){i(e)}}))}}const Ne=(e=0,t=Number.MAX_SAFE_INTEGER)=>(e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e),Ae=e=>{if(!e||"string"!=typeof e)return"";const t=e.match(/[\d.]+/);return t&&t.length>0?t[0].trim():""},xe=e=>{if(!e||"string"!=typeof e)return"";const t=e.match(/[\w\s\d]+/);return t&&t.length>0?t[0].trim():""},Pe=e=>{if(!e||"string"!=typeof e)return"";const t=e.match(/[\w\d.\-:\/]+/);return t&&t.length>0?t[0].trim():""},Me=e=>{const s=a({},e.types);return delete s.EIP712Domain,t.ethers.utils._TypedDataEncoder.hash(e.domain,s,e.message)},Re=e=>t.ethers.utils.arrayify(Me(e)),{defineReadOnly:Le,getStatic:De,resolveProperties:Be,checkProperties:Ue,shallowCopy:He,deepCopy:je}=t.utils,We=e=>ge("https://${network}-indexer.sequence.app",{network:e}),qe=e=>ge("https://${network}-relayer.sequence.app",{network:e}),$e=e=>ge("https://nodes.sequence.app/${network}",{network:e});function Fe(e){return ue(Ke,e)}function Ge(e){return t.ethers.BigNumber.isBigNumber(e)?e:ye(e)?t.ethers.BigNumber.from(e):t.ethers.BigNumber.from(e.chainId)}const Ve=e=>{const t=$e(e);return{rpcUrl:t,relayer:{url:qe(e),provider:{url:t}},indexerUrl:We(e)}},Ke=de([a({},oe[re.POLYGON],Ve("polygon"),{isDefaultChain:!0,isAuthChain:!0}),a({},oe[re.MAINNET],Ve("mainnet")),a({},oe[re.BSC],Ve("bsc")),a({},oe[re.AVALANCHE],Ve("avalanche")),a({},oe[re.ARBITRUM],Ve("arbitrum")),a({},oe[re.ARBITRUM_NOVA],Ve("arbitrum-nova")),a({},oe[re.OPTIMISM],Ve("optimism")),a({},oe[re.OPTIMISM_SEPOLIA],Ve("optimism-sepolia")),a({},oe[re.POLYGON_ZKEVM],Ve("polygon-zkevm")),a({},oe[re.GNOSIS],Ve("gnosis")),a({},oe[re.RINKEBY],Ve("rinkeby"),{disabled:!0}),a({},oe[re.GOERLI],Ve("goerli"),{disabled:!0}),a({},oe[re.SEPOLIA],Ve("sepolia")),a({},oe[re.POLYGON_MUMBAI],Ve("mumbai")),a({},oe[re.BSC_TESTNET],Ve("bsc-testnet")),a({},oe[re.ARBITRUM_SEPOLIA],Ve("arbitrum-sepolia")),a({},oe[re.BASE],Ve("base")),a({},oe[re.BASE_SEPOLIA],Ve("base-sepolia")),a({},oe[re.HOMEVERSE],Ve("homeverse")),a({},oe[re.HOMEVERSE_TESTNET],Ve("homeverse-testnet")),a({},oe[re.AVALANCHE_TESTNET],Ve("avalanche-testnet")),a({},oe[re.HARDHAT],{rpcUrl:"http://localhost:8545",relayer:{url:"http://localhost:3000",provider:{url:"http://localhost:8545"}}}),a({},oe[re.HARDHAT_2],{rpcUrl:"http://localhost:9545",relayer:{url:"http://localhost:3000",provider:{url:"http://localhost:9545"}}})]),Je="2.0";class ze{constructor(e,t){this.sender=void 0,this.handler=void 0,this.sender=t,e&&this.setMiddleware(e)}setMiddleware(e){this.handler=Ye(e,this.sender.sendAsync)}sendAsync(e,t,s){try{this.handler(e,t,s)}catch(e){t(e,void 0)}}}const Ye=(e,t)=>{if(0===e.length)return t;const s=e=>e.sendAsyncMiddleware?e.sendAsyncMiddleware:e;let n;n=s(e[e.length-1])(t);for(let t=e.length-2;t>=0;t--)n=s(e[t])(n);return n};function Ze(e){return void 0!==e&&void 0!==e.send&&void 0!==e.constructor.defaultUrl&&void 0!==e.detectNetwork&&void 0!==e.getSigner&&void 0!==e.perform}function Qe(e){return void 0!==e&&void 0!==e.sendAsync}let Xe=0;class et{constructor(e,t){this.send=void 0,this.request=void 0,this.defaultChainId=void 0,this.sendAsync=(e,t,s)=>{this.send(e.method,e.params,s||this.defaultChainId).then((s=>{t(void 0,{jsonrpc:"2.0",id:e.id,result:s})})).catch((e=>{t(e,void 0)}))},this.defaultChainId=t,Ze(e)?this.send=e.send.bind(e):Qe(e)?this.send=(t,s,n)=>new Promise(((i,r)=>{e.sendAsync({jsonrpc:Je,id:++Xe,method:t,params:s},((e,t)=>{e?r(e):i(t?t.result:void 0)}),n||this.defaultChainId)})):this.send=e,this.request=(e,t)=>this.send(e.method,e.params,t)}}const tt=e=>t=>(s,n,i)=>{if(!e(s))throw new Error("allowProvider middleware precondition is unmet.");t(s,n,i)};class st{constructor(e){this.cachableJsonRpcMethods=["net_version","eth_chainId","eth_accounts","sequence_getWalletContext","sequence_getNetworks"],this.cachableJsonRpcMethodsByBlock=["eth_call","eth_getCode"],this.cache=void 0,this.cacheByBlock=void 0,this.cacheByBlockResetLock=!1,this.onUpdateCallback=void 0,this.defaultChainId=void 0,this.sendAsyncMiddleware=e=>(t,s,n)=>{if(this.cachableJsonRpcMethods.includes(t.method)||this.cachableJsonRpcMethodsByBlock.includes(t.method)){const e=this.cacheKey(t.method,t.params,n||this.defaultChainId),i=this.getCacheValue(e);if(i&&""!==i)return void s(void 0,{jsonrpc:"2.0",id:t.id,result:i})}e(t,((e,n,i)=>{if((this.cachableJsonRpcMethods.includes(t.method)||this.cachableJsonRpcMethodsByBlock.includes(t.method))&&n&&n.result&&this.shouldCacheResponse(t,n)){const e=this.cacheKey(t.method,t.params,i||this.defaultChainId);this.cachableJsonRpcMethods.includes(t.method)?this.setCacheValue(e,n.result):this.setCacheByBlockValue(e,n.result)}s(e,n)}),n||this.defaultChainId)},this.cacheKey=(e,t,s)=>{let n="";return n=s?`${s}:${e}:`:`:${e}:`,t&&0!==t.length?n+JSON.stringify(t):n+"[]"},this.getCache=()=>this.cache,this.setCache=e=>{this.cache=e,this.onUpdateCallback&&this.onUpdateCallback()},this.getCacheValue=e=>this.cache[e]?this.cache[e]:this.cacheByBlock[e]?this.cacheByBlock[e]:void 0,this.setCacheValue=(e,t)=>{this.cache[e]=t,this.onUpdateCallback&&this.onUpdateCallback(e,t)},this.setCacheByBlockValue=(e,t)=>{this.cacheByBlock[e]=t,this.cacheByBlockResetLock||(this.cacheByBlockResetLock=!0,setTimeout((()=>{this.cacheByBlockResetLock=!1,this.cacheByBlock={}}),1500))},this.shouldCacheResponse=(e,t)=>!(!t||!t.result)&&!("eth_getCode"===e.method&&t.result.length<=2),this.clearCache=()=>{this.cache={},this.cacheByBlock={}},this.cache={},this.cacheByBlock={},this.defaultChainId=null==e?void 0:e.defaultChainId,null!=e&&e.blockCache?!0!==(null==e?void 0:e.blockCache)&&(this.cachableJsonRpcMethodsByBlock=null==e?void 0:e.blockCache):this.cachableJsonRpcMethodsByBlock=[]}onUpdate(e){this.onUpdateCallback=e}}class nt{constructor(e){this.options=void 0,this.sendAsyncMiddleware=e=>(s,n,i)=>{const{id:r,method:a}=s;switch(a){case"net_version":if(this.options.chainId)return void n(void 0,{jsonrpc:"2.0",id:r,result:`${this.options.chainId}`});break;case"eth_chainId":if(this.options.chainId)return void n(void 0,{jsonrpc:"2.0",id:r,result:t.ethers.utils.hexlify(this.options.chainId)});break;case"eth_accounts":if(this.options.accountAddress)return void n(void 0,{jsonrpc:"2.0",id:r,result:[t.ethers.utils.getAddress(this.options.accountAddress)]});break;case"sequence_getWalletContext":if(this.options.walletContext)return void n(void 0,{jsonrpc:"2.0",id:r,result:this.options.walletContext})}e(s,n,i)},this.options=e}}const it=e=>(t,s,n)=>{e(t,((e,t)=>{if(!e&&t&&t.error)throw"string"==typeof t.error?new Error(t.error):new Error(t.error.message);s(e,t)}),n)},rt=e=>(t,s,n)=>{const i=n?` chainId:${n}`:"";ke.info(`[provider request]${i} id:${t.id} method:${t.method} params:`,t.params),e(t,((e,n)=>{e?ke.warn(`[provider response]${i} id:${t.id} method:${t.method} params:`,t.params,"error:",e):ke.info(`[provider response]${i} id:${t.id} method:${t.method} params:`,t.params,"response:",n),s(e,n)}),n)},at=["personal_sign","eth_sign","eth_signTypedData","eth_signTypedData_v4","eth_sendTransaction","eth_sendRawTransaction","sequence_sign","sequence_signTypedData_v4","sequence_getWalletContext","sequence_getWalletConfig","sequence_getWalletState","sequence_getNetworks","sequence_updateConfig","sequence_publishConfig","sequence_gasRefundOptions","sequence_getNonce","sequence_relay","eth_decrypt","eth_getEncryptionPublicKey","wallet_addEthereumChain","wallet_switchEthereumChain","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"];class ot{constructor(){this.singleflightJsonRpcMethods=["eth_chainId","net_version","eth_call","eth_getCode","eth_blockNumber","eth_getBalance","eth_getStorageAt","eth_getTransactionCount","eth_getBlockTransactionCountByHash","eth_getBlockTransactionCountByNumber","eth_getUncleCountByBlockHash","eth_getUncleCountByBlockNumber","eth_getBlockByHash","eth_getBlockByNumber","eth_getTransactionByHash","eth_getTransactionByBlockHashAndIndex","eth_getTransactionByBlockNumberAndIndex","eth_getTransactionReceipt","eth_getUncleByBlockHashAndIndex","eth_getUncleByBlockNumberAndIndex","eth_getLogs"],this.inflight=void 0,this.sendAsyncMiddleware=e=>(t,s,n)=>{if(!this.singleflightJsonRpcMethods.includes(t.method))return void e(t,s,n);const i=this.requestKey(t.method,t.params||[],n);this.inflight[i]?this.inflight[i].push({id:t.id,callback:s}):(this.inflight[i]=[],e(t,((e,t,n)=>{s(e,t);for(let s=0;s<this.inflight[i].length;s++){const n=this.inflight[i][s];e?n.callback(e,t):t&&n.callback(void 0,{jsonrpc:"2.0",id:n.id,result:t.result})}delete this.inflight[i]}),n))},this.requestKey=(e,t,s)=>{let n="";return n=s?`${s}:${e}:`:`:${e}:`,t&&0!==t.length?n+JSON.stringify(t):n+"[]"},this.inflight={}}}class ct extends t.ethers.providers.JsonRpcProvider{constructor(e,s){super(e,null==s?void 0:s.chainId),this._chainId=void 0,this._sender=void 0,this.send=(e,t)=>this._sender.send(e,t),this.fetch=(e,s)=>{const n={method:e,params:s,id:this._nextId++,jsonrpc:"2.0"};return t.ethers.utils.fetchJson(this.connection,JSON.stringify(n),ht).then((e=>e),(e=>{throw e}))};const n=null==s?void 0:s.chainId,i=null==s?void 0:s.middlewares,r=null==s?void 0:s.blockCache;this._chainId=n;const a=new ze(null!=i?i:[new nt({chainId:n}),new ot,new st({defaultChainId:n,blockCache:r})],new et(this.fetch,n));this._sender=new et(a,n)}async getNetwork(){const e=this._chainId;if(e){const t=oe[e];return{name:(null==t?void 0:t.name)||"",chainId:e,ensAddress:null==t?void 0:t.ensAddress}}{const e=await this.send("eth_chainId",[]);return this._chainId=t.ethers.BigNumber.from(e).toNumber(),this.getNetwork()}}}function ht(e){if(e.error){const t=new Error(e.error.message);throw t.code=e.error.code,t.data=e.error.data,t}return e.result}var lt=Object.freeze({__proto__:null});function dt(e){return t.ethers.utils.solidityKeccak256(["bytes","uint256","address","bytes32"],["0x1901",e.chainId,e.address,e.digest])}function ut(e){return void 0!==e.digest&&void 0!==e.chainId&&void 0!==e.address}var ft=Object.freeze({__proto__:null,subdigestOf:dt,isSignedPayload:ut});const gt="0x1626ba7e",pt=[{inputs:[{internalType:"bytes32",type:"bytes32"},{internalType:"bytes",type:"bytes"}],name:"isValidSignature",outputs:[{internalType:"bytes4",type:"bytes4"}],stateMutability:"view",type:"function"}];async function mt(e,s,n,i){const r=new t.ethers.Contract(e,pt,i);return await r.isValidSignature(s,n)===gt}var yt=Object.freeze({__proto__:null,isValidEIP1271Signature:mt});let wt=function(e){return e[e.EIP712=1]="EIP712",e[e.ETH_SIGN=2]="ETH_SIGN",e[e.WALLET_BYTES32=3]="WALLET_BYTES32",e}({});function vt(e){const s=t.ethers.utils.arrayify(e),n=s[s.length-1];return n===wt.EIP712||n===wt.ETH_SIGN}function bt(e,s){const n=t.ethers.utils.arrayify(s),i=t.ethers.utils.arrayify(e),r=n[n.length-1],a={r:t.ethers.utils.hexlify(n.slice(0,32)),s:t.ethers.utils.hexlify(n.slice(32,64)),v:t.ethers.BigNumber.from(n.slice(64,65)).toNumber()};if(r===wt.EIP712)return t.ethers.utils.recoverAddress(i,a);if(r===wt.ETH_SIGN)return t.ethers.utils.recoverAddress(t.ethers.utils.hashMessage(i),a);throw new Error(`Unsupported signature type: ${r}`)}function It(e,s,n,i){const r=t.ethers.utils.arrayify(n),a=r[r.length-1];if(a===wt.EIP712||a===wt.ETH_SIGN)return e===bt(s,n);if(a===wt.WALLET_BYTES32)return mt(e,t.ethers.utils.hexlify(s),r.slice(0,-1),i);throw new Error(`Unsupported signature type: ${a}`)}function Et(e,s){const n=t.ethers.utils.arrayify(s);if(66===n.length)try{return bt(e,n)}catch(e){}}var Ct=Object.freeze({__proto__:null,SigType:wt,canRecover:vt,recoverSigner:bt,isValidSignature:It,tryRecoverSigner:Et});let St=function(e){return e[e.EOASignature=0]="EOASignature",e[e.Address=1]="Address",e[e.DynamicSignature=2]="DynamicSignature",e}({});function kt(e){return void 0!==e.address&&!Tt(e)}function Tt(e){return void 0!==e.signature&&void 0!==e.weight&&void 0!==e.isDynamic}function _t(e){return void 0!==e.threshold&&void 0!==e.signers}function Ot(e){const s=t.ethers.utils.arrayify(e),n=s[0]<<8|s[1],i=[];for(let e=2;e<s.length;){const n=s[e++],r=s[e++];switch(n){case St.EOASignature:i.push({unrecovered:!0,weight:r,signature:t.ethers.utils.hexlify(s.slice(e,e+66)),isDynamic:!1}),e+=66;break;case St.Address:i.push({weight:r,address:t.ethers.utils.getAddress(t.ethers.utils.hexlify(s.slice(e,e+20)))}),e+=20;break;case St.DynamicSignature:const a=t.ethers.utils.getAddress(t.ethers.utils.hexlify(s.slice(e,e+20)));e+=20;const o=s[e]<<8|s[e+1];e+=2,i.push({unrecovered:!0,weight:r,signature:t.ethers.utils.hexlify(s.slice(e,e+o)),address:a,isDynamic:!0}),e+=o;break;default:throw new Error(`Unknown signature part type: ${n}`)}}return{version:1,threshold:n,signers:i}}function Nt(e){if(t.ethers.utils.isBytesLike(e))return t.ethers.utils.hexlify(e);const{signers:s,threshold:n}=_t(e)?e:e.config,i=s.map((e=>{if(kt(e))return t.ethers.utils.solidityPack(["uint8","uint8","address"],[St.Address,e.weight,e.address]);if(e.isDynamic){const s=t.ethers.utils.arrayify(e.signature);return t.ethers.utils.solidityPack(["uint8","uint8","address","uint16","bytes"],[St.DynamicSignature,e.weight,e.address,s.length,s])}return t.ethers.utils.solidityPack(["uint8","uint8","bytes"],[St.EOASignature,e.weight,e.signature])}));return t.ethers.utils.solidityPack(["uint16",...new Array(i.length).fill("bytes")],[n,...i])}async function At(e,t,s){const n=dt(t),i=await Promise.all(e.signers.map((async e=>{if(kt(e))return e;if(e.isDynamic){if(!e.address)throw new Error("Dynamic signature part must have address");if(!It(e.address,n,e.signature,s))throw new Error(`Invalid dynamic signature part ${e.address}`);return{address:e.address,weight:e.weight,signature:e.signature}}return{address:bt(n,e.signature),weight:e.weight,signature:e.signature}})));return{version:1,payload:t,subdigest:n,config:{version:1,threshold:e.threshold,signers:i}}}function xt(e,s,n,i){if(0!==n.length)throw new Error("Explicit subdigests not supported on v1");let r=t.ethers.BigNumber.from(0);const o=e.signers.map((e=>{if(!s.has(e.address))return e;const n=s.get(e.address),i=t.ethers.utils.arrayify(n.signature);return r=r.add(e.weight),n.isDynamic||66!==i.length?a({},e,{isDynamic:!0,signature:n.signature,address:e.address}):a({},e,{isDynamic:!1,signature:n.signature})}));return{encoded:Nt({version:1,threshold:e.threshold,signers:o}),weight:r}}const Pt={decode:e=>Ot(e),encode:e=>Nt(e),trim:async e=>e,supportsNoChainId:!0,recover:(e,t,s)=>At(e,t,s),encodeSigners:(e,t,s,n)=>xt(e,t,s),hasEnoughSigningPower:(e,t)=>{const{weight:s}=Pt.encodeSigners(e,t,[],0);return s.gte(e.threshold)},chainSignatures:(e,t)=>{throw new Error("Signature chaining not supported on v1")},hashSetImageHash:function(e){throw new Error("Image hash not supported on v1")},signaturesOf:e=>e.signers.filter((e=>void 0!==e.signature)).map((e=>({address:e.address,signature:e.signature}))),signaturesOfDecoded:function(e){return e.signers.map((e=>e.signature)).filter((e=>void 0!==e))}};var Mt=Object.freeze({__proto__:null,SignaturePartType:St,isAddressMember:kt,isUnrecoveredSignatureMember:Tt,isUnrecoveredSignature:_t,decodeSignature:Ot,encodeSignature:Nt,recoverSignature:At,encodeSigners:xt,SignatureCoder:Pt});const Rt={isWalletConfig:e=>1===e.version&&void 0!==e.threshold&&void 0!==e.signers,imageHashOf:e=>e.signers.reduce(((e,s)=>t.ethers.utils.keccak256(t.ethers.utils.defaultAbiCoder.encode(["bytes32","uint8","address"],[e,s.weight,s.address]))),t.ethers.utils.solidityPack(["uint256"],[e.threshold])),hasSubdigest:(e,t)=>!1,isComplete:e=>!0,checkpointOf:e=>t.ethers.BigNumber.from(0),signersOf:e=>e.signers.map((e=>({address:e.address,weight:t.ethers.BigNumber.from(e.weight).toNumber()}))),fromSimple:e=>{if(!t.ethers.constants.Zero.eq(e.checkpoint))throw new Error("v1 wallet config does not support checkpoint");if(e.subdigests&&e.subdigests.length>0)throw new Error("v1 wallet config does not support subdigests");return{version:1,threshold:e.threshold,signers:e.signers}},update:{isKindUsed:!0,buildTransaction:(e,s,n,r)=>{const a=new t.ethers.utils.Interface([...i.mainModule.abi,...i.mainModuleUpgradable.abi]),o=[];return r&&"first"!==r||o.push({to:e,data:a.encodeFunctionData(a.getFunction("updateImplementation"),[n.mainModuleUpgradable]),gasLimit:0,delegateCall:!1,revertOnError:!0,value:0}),o.push({to:e,data:a.encodeFunctionData(a.getFunction("updateImageHash"),[Rt.imageHashOf(s)]),gasLimit:0,delegateCall:!1,revertOnError:!0,value:0}),{entrypoint:e,transactions:o}},decodeTransaction:function(e){throw new Error("Function not implemented.")}},toJSON:function(e){const s=e.signers.map((e=>({weight:t.ethers.BigNumber.from(e.weight).toString(),address:e.address})));return JSON.stringify({version:e.version,threshold:t.ethers.BigNumber.from(e.threshold).toString(),signers:s})},fromJSON:function(e){const s=JSON.parse(e),n=s.signers.map((e=>({weight:t.ethers.BigNumber.from(e.weight),address:e.address})));return{version:s.version,threshold:t.ethers.BigNumber.from(s.threshold),signers:n}},editConfig:function(e,s){var n;const i=e.signers.slice();if(s.checkpoint&&!t.ethers.constants.Zero.eq(s.checkpoint))throw new Error("v1 wallet config does not support checkpoint");if(s.add)for(const e of s.add)i.find((t=>t.address===e.address))||i.push({weight:e.weight,address:e.address});if(s.remove)for(const e of s.remove){const t=i.findIndex((t=>t.address===e));t>=0&&i.splice(t,1)}return{version:e.version,threshold:null!=(n=s.threshold)?n:e.threshold,signers:i}},buildStubSignature:function(e,s){const n=new Map;for(const[t,i]of s.entries()){n.set(t,{signature:i,isDynamic:!0});const{encoded:s,weight:r}=xt(e,n,[]);if(r.gte(e.threshold))return s}const i=e.signers;for(const{address:s}of i.sort((({weight:e},{weight:s})=>t.ethers.BigNumber.from(e).sub(s).toNumber()))){const t="0x4e82f02f388a12b5f9d29eaf2452dd040c0ee5804b4e504b4dd64e396c6c781f2c7624195acba242dd825bfd25a290912e3c230841fd55c9a734c4de8d9899451b02";n.set(s,{signature:t,isDynamic:!1});const{encoded:i,weight:r}=xt(e,n,[]);if(r.gte(e.threshold))return i}return xt(e,n,[]).encoded}};var Lt=Object.freeze({__proto__:null,ConfigCoder:Rt});const Dt={version:1,factory:"0xf9D09D634Fb818b05149329C1dcCFAeA53639d96",guestModule:"0x02390F3E6E5FD1C6786CB78FD3027C117a9955A7",mainModule:"0xd01F11855bCcb95f88D7A48492F66410d4637313",mainModuleUpgradable:"0x7EFE6cE415956c5f80C6530cC6cc81b4808F6118",walletCreationCode:"0x603a600e3d39601a805130553df3363d3d373d3d3d363d30545af43d82803e903d91601857fd5bf3"};var Bt=Object.freeze({__proto__:null,config:Lt,signature:Mt,version:1,DeployedWalletContext:Dt});const Ut="0x8713a7c4465f6fbee2b6e9d6646d1d9f83fec929edfc4baf661f3c865bdd04d1";function Ht(e){return t.ethers.utils.keccak256(jt(e))}function jt(e){return t.ethers.utils.solidityPack(["bytes32","bytes32"],[Ut,e])}function Wt(e){const s=t.ethers.utils.arrayify(e);if(64===s.length&&t.ethers.utils.hexlify(s.slice(0,32))===Ut)return t.ethers.utils.hexlify(s.slice(32,64))}var qt=Object.freeze({__proto__:null,SetImageHashPrefix:Ut,hashSetImageHash:Ht,messageSetImageHash:jt,decodeMessageSetImageHash:Wt,isMessageSetImageHash:function(e){return void 0!==Wt(e)}});let $t=function(e){return e[e.Legacy=0]="Legacy",e[e.Dynamic=1]="Dynamic",e[e.NoChainIdDynamic=2]="NoChainIdDynamic",e[e.Chained=3]="Chained",e}({}),Ft=function(e){return e[e.Signature=0]="Signature",e[e.Address=1]="Address",e[e.DynamicSignature=2]="DynamicSignature",e[e.Node=3]="Node",e[e.Branch=4]="Branch",e[e.Subdigest=5]="Subdigest",e[e.Nested=6]="Nested",e}({});const Gt=66;function Vt(e){return void 0!==e.left&&void 0!==e.right}function Kt(e){return void 0!==e.tree}function Jt(e){return e.unrecovered&&void 0!==e.signature&&void 0!==e.isDynamic}function zt(e){let s,n=t.ethers.utils.arrayify(e);const i=(e,t)=>e?e.right?{left:e,right:t}:{left:e.left,right:t}:{left:t};for(;n.length>0;){const e=n[0];switch(n=n.slice(1),e){case Ft.Signature:{const e=n[0];s=i(s,{signature:t.ethers.utils.hexlify(n.slice(1,Gt+1)),weight:e,unrecovered:!0,isDynamic:!1}),n=n.slice(Gt+1)}break;case Ft.Address:{const e=n[0];s=i(s,{address:t.ethers.utils.getAddress(t.ethers.utils.hexlify(n.slice(1,21))),weight:e}),n=n.slice(21)}break;case Ft.DynamicSignature:{const e=n[0],r=t.ethers.utils.getAddress(t.ethers.utils.hexlify(n.slice(1,21))),a=n[21]<<16|n[22]<<8|n[23];s=i(s,{address:r,signature:t.ethers.utils.hexlify(n.slice(24,24+a)),weight:e,unrecovered:!0,isDynamic:!0}),n=n.slice(24+a)}break;case Ft.Node:s=i(s,{nodeHash:t.ethers.utils.hexlify(n.slice(0,32))}),n=n.slice(32);break;case Ft.Branch:{const e=n[0]<<16|n[1]<<8|n[2];s=i(s,zt(n.slice(3,3+e))),n=n.slice(3+e)}break;case Ft.Subdigest:s=i(s,{subdigest:t.ethers.utils.hexlify(n.slice(0,32))}),n=n.slice(32);break;case Ft.Nested:{const e=n[0],t=n[1]<<8|n[2],r=n[3]<<16|n[4]<<8|n[5];s=i(s,{weight:e,threshold:t,tree:zt(n.slice(6,6+r))}),n=n.slice(6+r)}break;default:throw new Error(`Unknown signature part type: ${e}: ${t.ethers.utils.hexlify(n)}`)}}if(!s)throw new Error("Empty signature tree");return s.right?s:s.left}class Yt extends Error{constructor(e){super(`Invalid signature leaf: ${JSON.stringify(e)}`),this.leaf=e}}async function Zt(e,t,s){if(Vt(e)){const[n,i]=await Promise.all([Zt(e.left,t,s),Zt(e.right,t,s)]);return{left:n,right:i}}if(Kt(e))return{weight:e.weight,threshold:e.threshold,tree:await Zt(e.tree,t,s)};if(Jt(e)){if(e.isDynamic){if(!e.address)throw new Error("Dynamic signature leaf without address");if(!await It(e.address,t,e.signature,s))throw new Yt(e);return{weight:e.weight,address:e.address,signature:e.signature,subdigest:t}}return{weight:e.weight,address:bt(t,e.signature),signature:e.signature,subdigest:t}}return e}const Qt={concat:(e,s)=>t.ethers.utils.solidityPack(["bytes","bytes"],[e,s]),node:e=>t.ethers.utils.solidityPack(["uint8","bytes32"],[Ft.Node,e]),branch:e=>{const s=t.ethers.utils.arrayify(e);return t.ethers.utils.solidityPack(["uint8","uint24","bytes"],[Ft.Branch,s.length,s])},nested:(e,s,n)=>{const i=t.ethers.utils.arrayify(n);return t.ethers.utils.solidityPack(["uint8","uint8","uint16","uint24","bytes"],[Ft.Nested,e,s,i.length,i])},subdigest:e=>t.ethers.utils.solidityPack(["uint8","bytes32"],[Ft.Subdigest,e]),signature:(e,s)=>t.ethers.utils.solidityPack(["uint8","uint8","bytes"],[Ft.Signature,e,s]),dynamicSignature:(e,s,n)=>{const i=t.ethers.utils.arrayify(n);return t.ethers.utils.solidityPack(["uint8","uint8","address","uint24","bytes"],[Ft.DynamicSignature,e,s,i.length,i])},address:(e,s)=>t.ethers.utils.solidityPack(["uint8","uint8","address"],[Ft.Address,e,s])};function Xt(e,s,n,i,r={}){const a=es(e.tree,s,n,r);return t.ethers.BigNumber.from(i).isZero()?{encoded:t.ethers.utils.solidityPack(["uint8","uint16","uint32","bytes"],[$t.NoChainIdDynamic,e.threshold,e.checkpoint,a.encoded]),weight:a.weight}:t.ethers.BigNumber.from(e.threshold).gt(255)?{encoded:t.ethers.utils.solidityPack(["uint8","uint16","uint32","bytes"],[$t.Dynamic,e.threshold,e.checkpoint,a.encoded]),weight:a.weight}:{encoded:t.ethers.utils.solidityPack(["uint8","uint8","uint32","bytes"],[$t.Legacy,e.threshold,e.checkpoint,a.encoded]),weight:a.weight}}function es(e,s,n,i={}){const r=!i.disableTrim;if(Os(e)){const i=es(e.left,s,n),a=es(e.right,s,n),o=Is(e.left),c=Is(e.right);return r&&i.weight.eq(0)&&a.weight.eq(0)&&!o&&!c?{encoded:Qt.node(Ps(e)),weight:t.ethers.constants.Zero}:r&&a.weight.eq(0)&&!c?{encoded:Qt.concat(i.encoded,Qt.node(Ps(e.right))),weight:i.weight}:r&&i.weight.eq(0)&&!o?{encoded:Qt.concat(Qt.node(Ps(e.left)),Qt.branch(a.encoded)),weight:a.weight}:{encoded:Qt.concat(i.encoded,Qt.branch(a.encoded)),weight:i.weight.add(a.weight)}}if(ks(e)){const i=es(e.tree,s,n);return r&&i.weight.eq(0)?{encoded:Qt.node(Ps(e)),weight:t.ethers.constants.Zero}:{encoded:Qt.nested(e.weight,e.threshold,i.encoded),weight:i.weight}}if(Ts(e))return{encoded:Qt.node(Ps(e)),weight:t.ethers.constants.Zero};if(Es(e)){const s=n.includes(e.subdigest);return{encoded:Qt.subdigest(e.subdigest),weight:s?t.ethers.constants.MaxUint256:t.ethers.constants.Zero}}if(Is(e)){if(s.has(e.address)){const n=s.get(e.address),r=n.signature;return i.forceDynamicEncoding||n.isDynamic?{encoded:Qt.dynamicSignature(e.weight,e.address,r),weight:t.ethers.BigNumber.from(e.weight)}:{encoded:Qt.signature(e.weight,r),weight:t.ethers.BigNumber.from(e.weight)}}return{encoded:Qt.address(e.weight,e.address),weight:t.ethers.constants.Zero}}throw new Error(`Invalid topology - unknown error: ${JSON.stringify(e)}`)}function ts(e){return rs(e)?ts(e.suffix[e.suffix.length-1]):e.config}function ss(e){return void 0!==e.type&&void 0!==e.decoded&&void 0!==e.version&&2===e.version}function ns(e){return void 0!==e.suffix&&Array.isArray(e.suffix)&&e.suffix.every(ss)}function is(e){return void 0!==e.type&&void 0!==e.config&&void 0!==e.digest&&void 0!==e.version&&2===e.version}function rs(e){return void 0!==e.chain&&Array.isArray(e.chain)&&e.chain.every(is)}function as(e){const s=t.ethers.utils.arrayify(e),n=s[0];switch(n){case $t.Legacy:return{version:2,type:$t.Legacy,decoded:os(s)};case $t.Dynamic:return{version:2,type:$t.Dynamic,decoded:os(s.slice(1))};case $t.NoChainIdDynamic:return{version:2,type:$t.NoChainIdDynamic,decoded:os(s.slice(1))};case $t.Chained:return cs(s);default:throw new Error(`Invalid signature type: ${n}`)}}function os(e){const s=t.ethers.utils.arrayify(e);return{threshold:s[0]<<8|s[1],checkpoint:s[2]<<24|s[3]<<16|s[4]<<8|s[5],tree:zt(s.slice(6))}}function cs(e){const s=t.ethers.utils.arrayify(e),n=s[0];if(n!==$t.Chained)throw new Error(`Expected chained signature type: ${n}`);const i=[];let r=1;for(;r<s.length;){const e=s[r]<<16|s[r+1]<<8|s[r+2];r+=3;const t=as(s.slice(r,r+e));i.push(t),r+=e}const o=i[0];if(ns(o))throw new Error("Expected first link of chained signature to be a simple signature (not chained)");return a({},o,{suffix:i.slice(1)})}function hs(e){return t.ethers.utils.solidityPack(["bytes32","bytes32"],[t.ethers.utils.solidityKeccak256(["string"],["SetImageHash(bytes32 imageHash)"]),e])}async function ls(e,s,n){const i=void 0===s.subdigest?s:void 0;e.type===$t.NoChainIdDynamic&&i&&(i.chainId=0);const r=i?dt(i):s.subdigest;if(!ns(e)){const t=await Zt(e.decoded.tree,r,n);return{version:2,type:e.type,subdigest:r,config:a({version:2},e.decoded,{tree:t})}}if(!ut(i))throw new Error("Chained signature recovery requires detailed signed payload, subdigest is not enough");const o=[];let c=i;for(const s of[a({},e,{suffix:void 0}),...e.suffix]){const e=await ls(s,c,n);o.unshift(e);const i=hs(Rs(ts(e)));c=a({},c,{message:i,digest:t.ethers.utils.keccak256(i)})}return a({},o[0],{suffix:o.slice(1)})}function ds(e,s){const n=[e,...s||[]].map((e=>t.ethers.utils.arrayify(us(e)))),i=t.ethers.utils.solidityPack(n.map((()=>["uint24","bytes"])).flat(),n.map((e=>[e.length,e])).flat());return t.ethers.utils.solidityPack(["uint8","bytes"],[$t.Chained,i])}function us(e){if(t.ethers.utils.isBytesLike(e))return t.ethers.utils.hexlify(e);if(ns(e)||rs(e))return ds(us(e),(e.suffix||[]).map(us));const s=ss(e)?e.decoded:e.config;switch(e.type){case $t.Legacy:if(t.ethers.BigNumber.from(s.threshold).gt(255))throw new Error(`Legacy signature threshold is too large: ${s.threshold} (max 255)`);return fs(s);case $t.NoChainIdDynamic:case $t.Dynamic:return t.ethers.utils.solidityPack(["uint8","bytes"],[e.type,fs(s)]);case $t.Chained:throw new Error("Unreachable code: Chained signature should be handled above");default:throw new Error(`Invalid signature type: ${e.type}`)}}function fs(e){return t.ethers.utils.solidityPack(["uint16","uint32","bytes"],[e.threshold,e.checkpoint,gs(e.tree)])}function gs(e){if(Os(e)||Vt(e)){const s=t.ethers.utils.arrayify(gs(e.right)),n=t.ethers.utils.arrayify(gs(e.left));return Os(e.right)||Vt(e.right)?t.ethers.utils.solidityPack(["bytes","uint8","uint24","bytes"],[n,Ft.Branch,s.length,s]):t.ethers.utils.solidityPack(["bytes","bytes"],[n,s])}if(ks(e)||Kt(e)){const s=t.ethers.utils.arrayify(gs(e.tree));return t.ethers.utils.solidityPack(["uint8","uint8","uint16","uint24","bytes"],[Ft.Nested,e.weight,e.threshold,s.length,s])}if(Jt(e)||Is(e)&&void 0!==e.signature){const s=t.ethers.utils.arrayify(e.signature);if(e.isDynamic||s.length!==Gt){if(!e.address)throw new Error("Dynamic signature leaf must have address");return t.ethers.utils.solidityPack(["uint8","uint8","address","uint24","bytes"],[Ft.DynamicSignature,e.weight,e.address,s.length,s])}return t.ethers.utils.solidityPack(["uint8","uint8","bytes"],[Ft.Signature,e.weight,s])}if(Is(e))return t.ethers.utils.solidityPack(["uint8","uint8","address"],[Ft.Address,e.weight,e.address]);if(Ts(e))return t.ethers.utils.solidityPack(["uint8","bytes32"],[Ft.Node,e.nodeHash]);if(Es(e))return t.ethers.utils.solidityPack(["uint8","bytes32"],[Ft.Subdigest,e.subdigest]);throw new Error(`Unknown signature tree type: ${e}`)}function ps(e){return Os(e)?[...ps(e.left),...ps(e.right)]:ks(e)?ps(e.tree):Is(e)&&e.signature?[{address:e.address,signature:e.signature}]:[]}function ms(e){return Vt(e)?[...ms(e.left),...ms(e.right)]:Kt(e)?ms(e.tree):Jt(e)?[e.signature]:[]}async function ys(e){const t="string"==typeof e?as(e):e;if(ns(t)){const e=await Promise.all([ys(a({},t,{suffix:void 0})),...t.suffix.map((e=>ys(e)))]);return ds(e[0],e.slice(1))}const{trimmed:s}=await ws(t.decoded.tree);return us(a({},t,{decoded:a({},t.decoded,{tree:s})}))}async function ws(e,s=!0){if(Vt(e)){const[s,n]=await Promise.all([ws(e.left),ws(e.right)]);if(0!==s.weight||0!==n.weight)return{weight:s.weight+n.weight,trimmed:{left:s.trimmed,right:n.trimmed}};try{return{weight:0,trimmed:{nodeHash:Ps(await Zt(e,t.ethers.constants.HashZero,void 0))}}}catch(e){}}if(Kt(e)){const s=await ws(e.tree);if(0===s.weight)try{return{weight:0,trimmed:{nodeHash:Ps(await Zt(e,t.ethers.constants.HashZero,void 0))}}}catch(e){}return{weight:s.weight,trimmed:{weight:e.weight,threshold:e.threshold,tree:s.trimmed}}}return Ts(e)&&xs(e.nodeHash)?{weight:0,trimmed:a({},As(e.nodeHash))}:Jt(e)||Is(e)&&void 0!==e.signature?{weight:t.ethers.BigNumber.from(e.weight).toNumber(),trimmed:e}:!s&&Es(e)?{weight:1/0,trimmed:e}:{weight:0,trimmed:e}}const vs={decode:e=>as(e),encode:e=>us(e),trim:e=>ys(e),supportsNoChainId:!0,recover:(e,t,s)=>ls(e,t,s),encodeSigners:(e,t,s,n)=>Xt(e,t,s,n),hasEnoughSigningPower:(e,t)=>{const{weight:s}=vs.encodeSigners(e,t,[],0);return s.gte(e.threshold)},chainSignatures:(e,s)=>{const n=s.reverse();return ds(t.ethers.utils.isBytesLike(e)?e:us(e),n.map((e=>t.ethers.utils.isBytesLike(e)?e:us(e))))},hashSetImageHash:function(e){return Ht(e)},signaturesOf:e=>ps(e.tree),signaturesOfDecoded:function(e){return ms(e.decoded.tree)}};var bs=Object.freeze({__proto__:null,SignatureType:$t,SignaturePartType:Ft,SignaturePartTypeLength:Gt,isUnrecoveredNode:Vt,isUnrecoveredNestedLeaf:Kt,isUnrecoveredSignatureLeaf:Jt,decodeSignatureTree:zt,InvalidSignatureLeafError:Yt,recoverTopology:Zt,partEncoder:Qt,encodeSigners:Xt,encodeTree:es,deepestConfigOfSignature:ts,isUnrecoveredSignature:ss,isUnrecoveredChainedSignature:ns,isSignature:is,isChainedSignature:rs,decodeSignature:as,decodeSignatureBody:os,decodeChainedSignature:cs,setImageHashStruct:hs,recoverSignature:ls,encodeChain:ds,encodeSignature:us,encodeSignatureBody:fs,encodeSignatureTree:gs,signaturesOf:ps,signaturesOfDecoded:ms,subdigestsOfDecoded:function e(t){return Vt(t)?[...e(t.left),...e(t.right)]:Kt(t)?e(t.tree):Es(t)?[t.subdigest]:[]},trimSignature:ys,trimUnrecoveredTree:ws,SignatureCoder:vs});function Is(e){return void 0!==e.address&&void 0!==e.weight}function Es(e){return void 0!==e.subdigest&&void 0===e.address}function Cs(e){return Os(e)?JSON.stringify({left:Cs(e.left),right:Cs(e.right)}):ks(e)?JSON.stringify({weight:t.ethers.BigNumber.from(e.weight).toString(),threshold:t.ethers.BigNumber.from(e.threshold).toString(),tree:Cs(e.tree)}):Is(e)?JSON.stringify({address:e.address,weight:t.ethers.BigNumber.from(e.weight).toString()}):JSON.stringify(e)}function Ss(e){const s="string"==typeof e?JSON.parse(e):e;return void 0!==s.left&&void 0!==s.right?{left:Ss(s.left),right:Ss(s.right)}:void 0!==s.weight&&void 0!==s.threshold&&void 0!==s.tree?{weight:t.ethers.BigNumber.from(s.weight),threshold:t.ethers.BigNumber.from(s.threshold),tree:Ss(s.tree)}:void 0!==s.address&&void 0!==s.weight?{address:s.address,weight:t.ethers.BigNumber.from(s.weight)}:s}function ks(e){return void 0!==e.tree&&void 0!==e.weight&&void 0!==e.threshold}function Ts(e){return void 0!==e.nodeHash}function _s(e){return Is(e)||Es(e)||ks(e)||Ts(e)}function Os(e){return void 0!==e.left&&void 0!==e.right}function Ns(e){return t.ethers.utils.solidityPack(["uint96","address"],[e.weight,e.address])}function As(e){const s=t.ethers.utils.arrayify(e);if(32!==s.length)throw new Error("Invalid encoded string length");return{weight:t.ethers.BigNumber.from(s.slice(0,12)),address:t.ethers.utils.getAddress(t.ethers.utils.hexlify(s.slice(12)))}}function xs(e){const s=t.ethers.utils.arrayify(e);if(32!==s.length)return!1;return s.slice(0,11).every((e=>0===e))}function Ps(e){if(Is(e))return Ns(e);if(Es(e))return t.ethers.utils.solidityKeccak256(["string","bytes32"],["Sequence static digest:\n",e.subdigest]);if(ks(e)){const s=Ps(e.tree);return t.ethers.utils.solidityKeccak256(["string","bytes32","uint256","uint256"],["Sequence nested config:\n",s,e.threshold,e.weight])}return Ts(e)?e.nodeHash:t.ethers.utils.solidityKeccak256(["bytes32","bytes32"],[Ps(e.left),Ps(e.right)])}function Ms(e){return void 0!==e.threshold&&void 0!==e.checkpoint&&void 0!==e.tree&&void 0!==e.version&&2===e.version}function Rs(e){return t.ethers.utils.solidityKeccak256(["bytes32","uint256"],[t.ethers.utils.solidityKeccak256(["bytes32","uint256"],[Ps(e.tree),e.threshold]),e.checkpoint])}function Ls(e){return void 0!==e.threshold&&void 0!==e.weight&&void 0!==e.members}function Ds(e){return Is(e)||Es(e)?[e]:ks(e)?[{threshold:e.threshold,weight:e.weight,members:Ds(e.tree)}]:Ts(e)?[]:[...Ds(e.left),...Ds(e.right)]}const Bs=(e,t)=>e.map((e=>Ls(e)?{tree:t(e.members),threshold:e.threshold,weight:e.weight}:e));function Us(e){if(0===e.length)throw new Error("Empty members array");return Bs(e,Us).reduce(((e,t)=>({left:e,right:t})))}function Hs(e){if(0===e.length)throw new Error("Empty members array");const t=Bs(e,Hs);for(let e=t.length;e>1;e/=2)for(let s=0;s<e/2;s++){const n=2*s,i=n+1;t[s]=i>=e?t[n]:{left:t[n],right:t[i]}}return t[0]}function js(e){return e.length>8?Hs(e):Us(e)}function Ws(e,t=js){return{version:2,threshold:e.threshold,checkpoint:e.checkpoint,tree:t(e.members)}}function qs(e,t){return Es(e)?e.subdigest===t:!!Os(e)&&(qs(e.left,t)||qs(e.right,t))}function $s(e){const s=[e],n=new Set;for(;s.length>0;){const e=s.pop();ks(e)?s.push(e.tree):Os(e)?(s.push(e.left),s.push(e.right)):Is(e)&&n.add({address:e.address,weight:t.ethers.BigNumber.from(e.weight).toNumber()})}return Array.from(n)}function Fs(e){return Os(e)?Fs(e.left)&&Fs(e.right):!Ts(e)}const Gs={isWalletConfig:e=>2===e.version&&void 0!==e.threshold&&void 0!==e.tree,imageHashOf:e=>Rs(e),hasSubdigest:(e,t)=>qs(e.tree,t),checkpointOf:e=>t.ethers.BigNumber.from(e.checkpoint),signersOf:e=>$s(e.tree),fromSimple:e=>{var t;return Ws(a({},e,{members:[...e.signers,...(null!=(t=e.subdigests)?t:[]).map((e=>({subdigest:e})))]}))},isComplete:e=>Fs(e.tree),update:{isKindUsed:!0,buildTransaction:(e,s,n,r)=>{const a=new t.ethers.utils.Interface(i.mainModuleUpgradable.abi);return{entrypoint:e,transactions:[{to:e,data:a.encodeFunctionData(a.getFunction("updateImageHash"),[Gs.imageHashOf(s)]),gasLimit:0,delegateCall:!1,revertOnError:!0,value:0}]}},decodeTransaction:function(e){var s,n,r,a;const o=new t.ethers.utils.Interface(i.mainModuleUpgradable.abi);if(1!==e.transactions.length)throw new Error("Invalid transaction bundle, expected 1 transaction");const c=e.transactions[0].data;if(!c)throw new Error("Invalid transaction bundle, expected data");const h=o.decodeFunctionData(o.getFunction("updateImageHash"),c);if(!h)throw new Error("Invalid transaction bundle, expected valid data");if(e.transactions[0].to!==e.entrypoint)throw new Error("Invalid transaction bundle, expected to be sent to entrypoint");if(e.transactions[0].delegateCall)throw new Error("Invalid transaction bundle, expected not to be a delegateCall");if(!e.transactions[0].revertOnError)throw new Error("Invalid transaction bundle, expected revertOnError");if(!t.ethers.constants.Zero.eq(null!=(s=null==(n=e.transactions[0])?void 0:n.value)?s:0))throw new Error("Invalid transaction bundle, expected value to be 0");if(!t.ethers.constants.Zero.eq(null!=(r=null==(a=e.transactions[0])?void 0:a.gasLimit)?r:0))throw new Error("Invalid transaction bundle, expected value to be 0");return{address:e.entrypoint,newImageHash:h[0],kind:void 0}}},toJSON:function(e){return JSON.stringify({version:e.version,threshold:t.ethers.BigNumber.from(e.threshold).toString(),checkpoint:t.ethers.BigNumber.from(e.checkpoint).toString(),tree:Cs(e.tree)})},fromJSON:function(e){const s=JSON.parse(e);return{version:s.version,threshold:t.ethers.BigNumber.from(s.threshold),checkpoint:t.ethers.BigNumber.from(s.checkpoint),tree:Ss(s.tree)}},editConfig:function(e,t){var s,n;const i=Ds(e.tree);if(t.add)for(const e of t.add)i.find((t=>Is(t)&&t.address===e.address))||i.push({address:e.address,weight:e.weight});if(t.remove)for(const e of t.remove){const t=i.findIndex((t=>Is(t)&&t.address===e));t>=0&&i.splice(t,1)}return{version:e.version,threshold:null!=(s=t.threshold)?s:e.threshold,checkpoint:null!=(n=t.checkpoint)?n:e.checkpoint,tree:js(i)}},buildStubSignature:function(e,t){const s=new Map;for(const[n,i]of t.entries()){s.set(n,{signature:i,isDynamic:!0});const{encoded:t,weight:r}=Xt(e,s,[],0);if(r.gte(e.threshold))return t}const n=$s(e.tree);for(const{address:t}of n.sort((({weight:e},{weight:t})=>e-t))){const n="0x4e82f02f388a12b5f9d29eaf2452dd040c0ee5804b4e504b4dd64e396c6c781f2c7624195acba242dd825bfd25a290912e3c230841fd55c9a734c4de8d9899451b02";s.set(t,{signature:n,isDynamic:!1});const{encoded:i,weight:r}=Xt(e,s,[],0);if(r.gte(e.threshold))return i}return Xt(e,s,[],0).encoded}};var Vs=Object.freeze({__proto__:null,isSignerLeaf:Is,isSubdigestLeaf:Es,topologyToJSON:Cs,topologyFromJSON:Ss,isNestedLeaf:ks,isNodeLeaf:Ts,isLeaf:_s,isNode:Os,isTopology:function(e){return Os(e)||_s(e)},encodeSignerLeaf:Ns,decodeSignerLeaf:As,isEncodedSignerLeaf:xs,hashNode:Ps,leftFace:function(e){const t=[];let s=e;for(;!_s(s);)t.unshift(s.right),s=s.left;return t.unshift(s),t},isWalletConfig:Ms,imageHash:Rs,isSimpleNestedMember:Ls,topologyToMembers:Ds,hasUnknownNodes:function e(t){return!!Ts(t)||!!Os(t)&&(e(t.left)||e(t.right))},toSimpleWalletConfig:function(e){return{threshold:e.threshold,checkpoint:e.checkpoint,members:Ds(e.tree)}},legacyTopologyBuilder:Us,merkleTopologyBuilder:Hs,optimized2SignersTopologyBuilder:js,toWalletConfig:Ws,hasSubdigest:qs,signersOf:$s,isComplete:Fs,ConfigCoder:Gs}),Ks=Object.freeze({__proto__:null});const Js={config:Gs,signature:vs},zs={version:2,factory:"0xFaA5c0b14d1bED5C888Ca655B9a8A5911F78eF4A",guestModule:"0xfea230Ee243f88BC698dD8f1aE93F8301B6cdfaE",mainModule:"0xfBf8f1A5E00034762D928f46d438B947f5d4065d",mainModuleUpgradable:"0x4222dcA3974E39A8b41c411FeDDE9b09Ae14b911",walletCreationCode:"0x603a600e3d39601a805130553df3363d3d373d3d3d363d30545af43d82803e903d91601857fd5bf3"};var Ys=Object.freeze({__proto__:null,config:Vs,signature:bs,context:Ks,chained:qt,coders:Js,version:2,DeployedWalletContext:zs});function Zs(e,s){const n=t.ethers.utils.keccak256(t.ethers.utils.solidityPack(["bytes","bytes32"],[e.walletCreationCode,t.ethers.utils.hexZeroPad(e.mainModule,32)])),i=t.ethers.utils.keccak256(t.ethers.utils.solidityPack(["bytes1","address","bytes32","bytes32"],["0xff",e.factory,s,n]));return t.ethers.utils.getAddress(t.ethers.utils.hexDataSlice(i,12))}const Qs={1:Dt,2:zs};var Xs=Object.freeze({__proto__:null,addressOf:Zs,isValidCounterfactual:async function(e,s,n,i,r,a){const o=await Promise.all(Dn.map((async o=>{try{const c=o.signature.SignatureCoder.decode(t.ethers.utils.hexlify(n)),h=await o.signature.SignatureCoder.recover(c,{address:e,digest:t.ethers.utils.hexlify(s),chainId:i},r),l=o.config.ConfigCoder.imageHashOf(h.config);if(Zs(a[o.version],l).toLowerCase()===e.toLowerCase())return!0;const d=await o.signature.SignatureCoder.recover(c,{address:e,digest:t.ethers.utils.hexlify(s),chainId:i},r),u=o.config.ConfigCoder.imageHashOf(d.config);return Zs(a[o.version],u).toLowerCase()===e.toLowerCase()}catch(e){}return!1})));return o.some((e=>e))},isValidVersionedContext:function(e){const t=Object.keys(e).length;for(let s=1;s<=t;s++){const t=e[s];if(!t||t.version!==s)return!1}return!0},latestContext:function(e){return e[Object.keys(e).length]},defaultContexts:Qs});const en="tuple(\n  bool delegateCall,\n  bool revertOnError,\n  uint256 gasLimit,\n  address target,\n  uint256 value,\n  bytes data\n)[]";function tn(e){return t.ethers.utils.keccak256(t.ethers.utils.defaultAbiCoder.encode(["address","uint256","bytes32"],[e.intent.wallet,e.chainId,e.intent.id]))}function sn(e){const s=t.ethers.utils.defaultAbiCoder.decode(["uint256",en],e);if(2!==s.length||!s[0]||!s[1])throw new Error("Invalid meta transaction data");return[s[0],s[1]]}function nn(e,s){return t.ethers.utils.defaultAbiCoder.encode(["uint256",en],[e,un(s)])}function rn(e,s){return t.ethers.utils.keccak256(nn(e,s))}function an(e,t,s,n){return dt({address:e,chainId:t,digest:rn(s,n)})}function on(e,s,n){return dt({address:e,chainId:s,digest:t.ethers.utils.keccak256(t.ethers.utils.defaultAbiCoder.encode(["string",en],["guest:",un(n)]))})}function cn(e,t){return t.map((t=>hn(e,t)))}function hn(e,s){if(s.to&&s.to!==t.ethers.constants.AddressZero)return{nonce:s.nonce,transaction:{delegateCall:!1,revertOnError:!1,gasLimit:s.gasLimit||0,to:s.to,value:s.value||0,data:s.data||"0x"}};{const n=new t.ethers.utils.Interface(i.mainModule.abi),r=n.encodeFunctionData(n.getFunction("createContract"),[s.data]);return{nonce:s.nonce,transaction:{delegateCall:!1,revertOnError:!1,gasLimit:s.gasLimit,to:e,value:s.value||0,data:r}}}}function ln(e){return void 0!==e.delegateCall||void 0!==e.revertOnError}function dn(e){return e.every(ln)}function un(e){return e.map((e=>{var s;return{delegateCall:!0===e.delegateCall,revertOnError:!0===e.revertOnError,gasLimit:void 0!==e.gasLimit?e.gasLimit:t.ethers.constants.Zero,target:null!=(s=e.to)?s:t.ethers.constants.AddressZero,value:void 0!==e.value?e.value:t.ethers.constants.Zero,data:void 0!==e.data?e.data:[]}}))}function fn(e){return e.map((e=>({delegateCall:e.delegateCall,revertOnError:e.revertOnError,gasLimit:e.gasLimit,to:e.target,value:e.value,data:e.data})))}function gn(e,s){const n=t.ethers.BigNumber.from(e),i=t.ethers.BigNumber.from(s),r=t.ethers.constants.Two.pow(t.ethers.BigNumber.from(96));if(!i.div(r).eq(t.ethers.constants.Zero))throw new Error("Space already encoded");return i.add(n.mul(r))}function pn(e){const s=t.ethers.BigNumber.from(e),n=t.ethers.constants.Two.pow(t.ethers.BigNumber.from(96));return[s.div(n),s.mod(n)]}function mn(e,t){if(Array.isArray(t)){if(dn(t))return t;return cn(e,t).map((e=>e.transaction))}return ln(t)?[t]:[hn(e,t).transaction]}function yn(e){return void 0!==e&&void 0!==e.entrypoint&&void 0!==e.chainId&&void 0!==e.transactions&&void 0!==e.nonce&&void 0!==e.intent&&void 0!==e.intent.id&&void 0!==e.intent.wallet&&Array.isArray(e.transactions)&&e.transactions.reduce(((e,t)=>e&&ln(t)),!0)}function wn(e){return void 0!==e&&void 0!==e.signature&&""!==e.signature&&yn(e)}function vn(e){const s=new t.ethers.utils.Interface(i.mainModule.abi);return s.encodeFunctionData(s.getFunction("execute"),wn(e)?[un(e.transactions),e.nonce,e.signature]:[un(e.transactions),0,[]])}const bn="0x61c2926c",In="tuple(\n  bool delegateCall,\n  bool revertOnError,\n  uint256 gasLimit,\n  address target,\n  uint256 value,\n  bytes data\n)[]",En=(e,s)=>{const n=[],r=new t.ethers.utils.Interface(i.mainModule.abi);for(const i of s){const s=t.ethers.utils.arrayify(i.data||"0x");if(i.to===e&&t.ethers.utils.hexlify(s.slice(0,4))===bn){const e=s.slice(4),r=t.ethers.utils.defaultAbiCoder.decode([In],e)[0];n.push(...En(i.to,r.map((e=>a({},e,{to:e.target})))))}else try{const t=r.decodeFunctionData("execute",s)[0],i=En(e,t.map((e=>a({},e,{to:e.target}))));n.push(...i)}catch(e){n.push(i)}}return n};var Cn=Object.freeze({__proto__:null,MetaTransactionsType:en,intendTransactionBundle:function(e,t,s,n){return a({},e,{chainId:s,intent:{id:n,wallet:t}})},intendedTransactionID:tn,unpackMetaTransactionsData:sn,packMetaTransactionsData:nn,digestOfTransactions:rn,subdigestOfTransactions:an,subdigestOfGuestModuleTransactions:on,toSequenceTransactions:cn,toSequenceTransaction:hn,isSequenceTransaction:ln,hasSequenceTransactions:dn,sequenceTxAbiEncode:un,fromTxAbiEncode:fn,encodeNonce:gn,decodeNonce:pn,fromTransactionish:mn,isTransactionBundle:yn,isSignedTransactionBundle:wn,encodeBundleExecData:vn,selfExecuteSelector:bn,selfExecuteAbi:In,unwind:En});const Sn="0x608060405234801561001057600080fd5b5060405161124a38038061124a83398101604081905261002f91610124565b600060405161003d906100dd565b604051809103906000f080158015610059573d6000803e3d6000fd5b5090506000816001600160a01b0316638f0684308686866040518463ffffffff1660e01b815260040161008e939291906101fb565b6020604051808303816000875af11580156100ad573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906100d19190610244565b9050806000526001601ff35b610fdc8061026e83390190565b634e487b7160e01b600052604160045260246000fd5b60005b8381101561011b578181015183820152602001610103565b50506000910152565b60008060006060848603121561013957600080fd5b83516001600160a01b038116811461015057600080fd5b6020850151604086015191945092506001600160401b038082111561017457600080fd5b818601915086601f83011261018857600080fd5b81518181111561019a5761019a6100ea565b604051601f8201601f19908116603f011681019083821181831017156101c2576101c26100ea565b816040528281528960208487010111156101db57600080fd5b6101ec836020830160208801610100565b80955050505050509250925092565b60018060a01b0384168152826020820152606060408201526000825180606084015261022e816080850160208701610100565b601f01601f191691909101608001949350505050565b60006020828403121561025657600080fd5b8151801515811461026657600080fd5b939250505056fe608060405234801561001057600080fd5b50610fbc806100206000396000f3fe608060405234801561001057600080fd5b50600436106100675760003560e01c806376be4cea1161005057806376be4cea146100a65780638f068430146100b957806398ef1ed8146100cc57600080fd5b80631c6453271461006c5780633d787b6314610093575b600080fd5b61007f61007a366004610ad4565b6100df565b604051901515815260200160405180910390f35b61007f6100a1366004610ad4565b61023d565b61007f6100b4366004610b3e565b61031e565b61007f6100c7366004610ad4565b6108e1565b61007f6100da366004610ad4565b61096e565b6040517f76be4cea00000000000000000000000000000000000000000000000000000000815260009030906376be4cea9061012890889088908890889088908190600401610bc3565b6020604051808303816000875af1925050508015610181575060408051601f3d9081017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe016820190925261017e91810190610c45565b60015b610232573d8080156101af576040519150601f19603f3d011682016040523d82523d6000602084013e6101b4565b606091505b508051600181900361022757816000815181106101d3576101d3610c69565b6020910101517fff00000000000000000000000000000000000000000000000000000000000000167f0100000000000000000000000000000000000000000000000000000000000000149250610235915050565b600092505050610235565b90505b949350505050565b6040517f76be4cea00000000000000000000000000000000000000000000000000000000815260009030906376be4cea906102879088908890889088906001908990600401610bc3565b6020604051808303816000875af19250505080156102e0575060408051601f3d9081017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe01682019092526102dd91810190610c45565b60015b610232573d80801561030e576040519150601f19603f3d011682016040523d82523d6000602084013e610313565b606091505b506000915050610235565b600073ffffffffffffffffffffffffffffffffffffffff87163b6060827f64926492649264926492649264926492649264926492649264926492649264928888610369602082610c98565b610375928b9290610cd8565b61037e91610d02565b1490508015610484576000606089828a610399602082610c98565b926103a693929190610cd8565b8101906103b39190610e18565b955090925090508415806103c45750865b1561047d576000808373ffffffffffffffffffffffffffffffffffffffff16836040516103f19190610eb2565b6000604051808303816000865af19150503d806000811461042e576040519150601f19603f3d011682016040523d82523d6000602084013e610433565b606091505b50915091508161047a57806040517f9d0d6e2d0000000000000000000000000000000000000000000000000000000081526004016104719190610f18565b60405180910390fd5b50505b50506104be565b87878080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920191909152509294505050505b80806104ca5750600083115b156106bb576040517f1626ba7e00000000000000000000000000000000000000000000000000000000815273ffffffffffffffffffffffffffffffffffffffff8b1690631626ba7e90610523908c908690600401610f2b565b602060405180830381865afa92505050801561057a575060408051601f3d9081017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe016820190925261057791810190610f44565b60015b61060f573d8080156105a8576040519150601f19603f3d011682016040523d82523d6000602084013e6105ad565b606091505b50851580156105bc5750600084115b156105db576105d08b8b8b8b8b600161031e565b9450505050506108d7565b806040517f6f2a95990000000000000000000000000000000000000000000000000000000081526004016104719190610f18565b7fffffffff0000000000000000000000000000000000000000000000000000000081167f1626ba7e000000000000000000000000000000000000000000000000000000001480158161065f575086155b801561066b5750600085115b1561068b5761067f8c8c8c8c8c600161031e565b955050505050506108d7565b841580156106965750825b80156106a0575087155b156106af57806000526001601ffd5b94506108d79350505050565b6041871461074b576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152603a60248201527f5369676e617475726556616c696461746f72237265636f7665725369676e657260448201527f3a20696e76616c6964207369676e6174757265206c656e6774680000000000006064820152608401610471565b600061075a6020828a8c610cd8565b61076391610d02565b90506000610775604060208b8d610cd8565b61077e91610d02565b905060008a8a604081811061079557610795610c69565b919091013560f81c915050601b81148015906107b557508060ff16601c14155b15610842576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152602d60248201527f5369676e617475726556616c696461746f723a20696e76616c6964207369676e60448201527f617475726520762076616c7565000000000000000000000000000000000000006064820152608401610471565b6040805160008152602081018083528e905260ff831691810191909152606081018490526080810183905273ffffffffffffffffffffffffffffffffffffffff8e169060019060a0016020604051602081039080840390855afa1580156108ad573d6000803e3d6000fd5b5050506020604051035173ffffffffffffffffffffffffffffffffffffffff161496505050505050505b9695505050505050565b6040517f76be4cea00000000000000000000000000000000000000000000000000000000815260009030906376be4cea9061092b9088908890889088906001908990600401610bc3565b6020604051808303816000875af115801561094a573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906102329190610c45565b6040517f76be4cea00000000000000000000000000000000000000000000000000000000815260009030906376be4cea906109b790889088908890889088908190600401610bc3565b6020604051808303816000875af1925050508015610a10575060408051601f3d9081017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0168201909252610a0d91810190610c45565b60015b610232573d808015610a3e576040519150601f19603f3d011682016040523d82523d6000602084013e610a43565b606091505b5080516001819003610a6257816000815181106101d3576101d3610c69565b8082fd5b73ffffffffffffffffffffffffffffffffffffffff81168114610a8857600080fd5b50565b60008083601f840112610a9d57600080fd5b50813567ffffffffffffffff811115610ab557600080fd5b602083019150836020828501011115610acd57600080fd5b9250929050565b60008060008060608587031215610aea57600080fd5b8435610af581610a66565b935060208501359250604085013567ffffffffffffffff811115610b1857600080fd5b610b2487828801610a8b565b95989497509550505050565b8015158114610a8857600080fd5b60008060008060008060a08789031215610b5757600080fd5b8635610b6281610a66565b955060208701359450604087013567ffffffffffffffff811115610b8557600080fd5b610b9189828a01610a8b565b9095509350506060870135610ba581610b30565b91506080870135610bb581610b30565b809150509295509295509295565b73ffffffffffffffffffffffffffffffffffffffff8716815285602082015260a060408201528360a0820152838560c0830137600060c085830181019190915292151560608201529015156080820152601f9092017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe016909101019392505050565b600060208284031215610c5757600080fd5b8151610c6281610b30565b9392505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b81810381811115610cd2577f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b92915050565b60008085851115610ce857600080fd5b83861115610cf557600080fd5b5050820193919092039150565b80356020831015610cd2577fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff602084900360031b1b1692915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b600082601f830112610d7e57600080fd5b813567ffffffffffffffff80821115610d9957610d99610d3e565b604051601f83017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0908116603f01168101908282118183101715610ddf57610ddf610d3e565b81604052838152866020858801011115610df857600080fd5b836020870160208301376000602085830101528094505050505092915050565b600080600060608486031215610e2d57600080fd5b8335610e3881610a66565b9250602084013567ffffffffffffffff80821115610e5557600080fd5b610e6187838801610d6d565b93506040860135915080821115610e7757600080fd5b50610e8486828701610d6d565b9150509250925092565b60005b83811015610ea9578181015183820152602001610e91565b50506000910152565b60008251610ec4818460208701610e8e565b9190910192915050565b60008151808452610ee6816020860160208601610e8e565b601f017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0169290920160200192915050565b602081526000610c626020830184610ece565b8281526040602082015260006102356040830184610ece565b600060208284031215610f5657600080fd5b81517fffffffff0000000000000000000000000000000000000000000000000000000081168114610c6257600080fdfea26469706673582212201a72aed4b15ffb05b6502997a9bb655992e06590bd26b336dfbb153d7ff6f34b64736f6c63430008120033",kn="0x6492649264926492649264926492649264926492649264926492649264926492";async function Tn(e,s,n,i){return"0x01"===await e.call({data:t.ethers.utils.concat([Sn,(new t.ethers.utils.AbiCoder).encode(["address","bytes32","bytes"],[s,n,i])])})}var _n=Object.freeze({__proto__:null,EIP_6492_OFFCHAIN_DEPLOY_CODE:Sn,EIP_6492_SUFFIX:kn,validateEIP6492Offchain:Tn});class On{constructor(e){this.provider=e,this.isDeployedCache=new Set}module(e){return new t.ethers.Contract(e,[...i.mainModuleUpgradable.abi,...i.mainModule.abi,...i.erc1271.abi],this.provider)}async isDeployed(e){if(this.isDeployedCache.has(e))return!0;const s=0!==(await this.provider.getCode(e).then((e=>t.ethers.utils.arrayify(e)))).length;return s&&this.isDeployedCache.add(e),s}async implementation(e){const s=t.ethers.utils.defaultAbiCoder.encode(["address"],[e]),n=await this.provider.getStorageAt(e,s).then((e=>t.ethers.utils.arrayify(e)));return 20===n.length?t.ethers.utils.getAddress(t.ethers.utils.hexlify(n)):32===n.length?t.ethers.utils.defaultAbiCoder.decode(["address"],n)[0]:void 0}async imageHash(e){try{return await this.module(e).imageHash()}catch(e){}}async nonce(e,t=0){try{return await this.module(e).readNonce(t)}catch(t){if(!await this.isDeployed(e))return 0;throw t}}async isValidSignature(e,t,s){return Tn(this.provider,e,t,s)}}var Nn=Object.freeze({__proto__:null,OnChainReader:On});function An(e){return e&&e.address&&e.digest&&void 0!==e.chainId&&e.config}var xn=Object.freeze({__proto__:null,config:lt,signature:ft,context:Xs,signer:Ct,EIP1271:yt,transaction:Cn,reader:Nn,EIP6492:_n,isWalletSignRequestMetadata:An});const Pn=[{config:Rt,signature:Pt},{config:Gs,signature:vs}];function Mn(e){const t=e-1;if(t<0||t>=Pn.length)throw new Error(`No coder for version: ${e}`);return Pn[t]}function Rn(e){return Mn(e)}var Ln=Object.freeze({__proto__:null,ALL_CODERS:Pn,coderFor:Mn,genericCoderFor:Rn});const Dn=[Bt,Ys];function Bn(e,t,s){for(let n=0;n<s.length;n++)if(Zs(s[n],t)===e)return s[n].version;throw new Error("Could not find version for counterfactual address")}var Un=Object.freeze({__proto__:null,counterfactualVersion:Bn});const Hn="0xa04263acf755e8bd19c0d7e20eea39a9ff3729eb",jn=new class{constructor(){this.version=2,this.configCoder=Gs,this.signatureCoder=vs}buildTransaction(e,s,n){if(!Gs.isWalletConfig(n)){const t=Ws({threshold:n.threshold,members:n.signers,checkpoint:0});return this.buildTransaction(e,s,t)}const r=s[2],a=new t.ethers.utils.Interface(i.mainModule.abi),o=Gs.update.buildTransaction(e,n,r,"first");return{tx:{entrypoint:e,nonce:gn(Hn,0),transactions:[{to:e,value:0,gasLimit:0,revertOnError:!0,delegateCall:!1,data:a.encodeFunctionData(a.getFunction("updateImplementation"),[r.mainModuleUpgradable])},...o.transactions]},fromVersion:this.version-1,toVersion:this.version,toConfig:n}}decodeTransaction(e,s){const n=e.entrypoint;if(e.transactions.length<2)throw new Error("Invalid transaction bundle size");if(!e.nonce||!gn(Hn,0).eq(e.nonce))throw new Error("Invalid transaction bundle nonce");if(e.transactions[0].to!==n||e.transactions[1].to!==n||e.transactions[0].delegateCall||e.transactions[1].delegateCall||!e.transactions[0].revertOnError||!e.transactions[1].revertOnError||e.transactions[0].value&&!t.ethers.constants.Zero.eq(e.transactions[0].value)||e.transactions[1].value&&!t.ethers.constants.Zero.eq(e.transactions[1].value)||e.transactions[0].gasLimit&&!t.ethers.constants.Zero.eq(e.transactions[0].gasLimit)||e.transactions[1].gasLimit&&!t.ethers.constants.Zero.eq(e.transactions[1].gasLimit))throw new Error("Invalid transaction bundle format");const r=s[2],a=new t.ethers.utils.Interface(i.mainModule.abi);if(t.ethers.utils.hexlify(e.transactions[0].data||[])!==t.ethers.utils.hexlify(a.encodeFunctionData(a.getFunction("updateImplementation"),[r.mainModuleUpgradable])))throw new Error("Invalid new implementation on transaction");const o=Gs.update.decodeTransaction({entrypoint:n,transactions:[e.transactions[1]]});if(o.address!==n)throw new Error("Invalid transaction bundle address");return o}};var Wn=Object.freeze({__proto__:null,MIGRATION_NONCE_SPACE:Hn,v1v2:jn});class qn{constructor(e,t,s){this.tracker=e,this.migrations=t,this.contexts=s,function(e){for(const[t,s]of Object.entries(e))if(t!==String(s.version-1))throw new Error(`Migration with key ${t} has version ${s.version}, expected version to be key + 1`)}(t)}lastMigration(){let e;for(const t of Object.values(this.migrations))(void 0===e||t.version>e.version)&&(e=t);if(void 0===e)throw new Error("No migrations");return e}async getAllMigratePresignedTransaction(e){const{address:t,fromImageHash:s,fromVersion:n,chainId:i}=e;let r=s,a=n;const o=Object.values(this.contexts),c=[];for(let e=1;e<o.length;e++){const e=await this.tracker.getMigration(t,r,a,i);if(!e)return{signedMigrations:c,missing:!0,lastImageHash:r,lastVersion:a};c.push(e);const s=this.migrations[a];if(!s)throw new Error(`No migration found for version ${a}`);const n=s.decodeTransaction(e.tx,this.contexts);if(n.address!==t)throw new Error("Migration transaction address does not match expected address");r=n.newImageHash,a+=1}return{signedMigrations:c,missing:!1,lastImageHash:r,lastVersion:a}}async signNextMigration(e,t,s,n){const i=this.migrations[t];if(!i)return;const r=i.buildTransaction(e,this.contexts,n);return a({},r,{tx:await s.signTransactionBundle(r.tx)})}}var $n=Object.freeze({__proto__:null,Migrator:qn});const Fn={1:jn};var Gn=Object.freeze({__proto__:null,DefaultMigrations:Fn});const Vn=t.ethers.BigNumber.from(8e5),Kn={waitPollRate:1e3,deltaBlocksLog:12,fromBlockLog:-1024};class Jn{constructor(e){this.provider=void 0,this.waitPollRate=void 0,this.deltaBlocksLog=void 0,this.fromBlockLog=void 0;const t=a({},Kn,e);this.provider=t.provider}async simulate(e,...s){var n=this;return(await Promise.all(s.map((async function(s){if(s.gasLimit&&!t.ethers.BigNumber.from(s.gasLimit||0).eq(t.ethers.constants.Zero))return s.gasLimit;if(s.delegateCall)return Vn;if(s.to===e&&await n.provider.getCode(e).then((e=>0===t.ethers.utils.arrayify(e).length)))return Vn;if(!n.provider)throw new Error("signer.provider is not set, but is required");return n.provider.estimateGas({from:e,to:s.to,data:s.data,value:s.value})})))).map((e=>({executed:!0,succeeded:!0,gasUsed:t.ethers.BigNumber.from(e).toNumber(),gasLimit:t.ethers.BigNumber.from(e).toNumber()})))}async getNonce(e,s,n){if(!this.provider)throw new Error("provider is not set");if("0x"===await this.provider.getCode(e))return 0;void 0===s&&(s=0);const r=new t.ethers.Contract(e,i.mainModule.abi,this.provider);return gn(s,await r.readNonce(s,{blockTag:n}))}async wait(e,t,s=this.waitPollRate,n=5){var i=this;"string"!=typeof e&&(e=tn(e));let r=!1;const o=async function(e,t){let i=0;for(;!r;){try{return await e()}catch(e){if(i++,void 0!==n&&i>=n)throw ke.error(`giving up after ${i} failed attempts${t?`: ${t}`:""}`,e),e;ke.warn(`attempt #${i} failed${t?`: ${t}`:""}`,e)}s>0&&await new Promise((e=>setTimeout(e,s)))}throw new Error(`timed out after ${i} failed attempts${t?`: ${t}`:""}`)},c=async function(){let t=i.fromBlockLog;if(t<0){const e=await o((()=>i.provider.getBlockNumber()),"unable to get latest block number");t=e+t}if("string"!=typeof e)throw new Error("impossible");const n=e.replace("0x","");for(;!r;){const e=await o((()=>i.provider.getBlockNumber()),"unable to get latest block number"),c=await o((()=>i.provider.getLogs({fromBlock:Math.max(0,t-i.deltaBlocksLog),toBlock:e,topics:["0x1f180c27086c7a39ea2a7b25239d1ab92348f07ca7bb59d1438fcf527568f881"]})),`unable to get NonceChange logs for blocks ${Math.max(0,t-i.deltaBlocksLog)} to ${e}`);t=e;const h=(await Promise.all(c.map((e=>o((()=>i.provider.getTransactionReceipt(e.transactionHash)),`unable to get receipt for transaction ${e.transactionHash}`))))).find((e=>e.logs.find((e=>0===e.topics.length&&e.data.replace("0x","")===n||1===e.topics.length&&"0x3dbd1590ea96dd3253a91f24e64e3a502e1225d602a5731357bc12643070ccd7"===e.topics[0]&&e.data.length>=64&&e.data.replace("0x","").startsWith(n)))));if(h)return a({receipt:h},await o((()=>i.provider.getTransaction(h.transactionHash)),`unable to get transaction ${h.transactionHash}`));r||await new Promise((e=>setTimeout(e,s)))}throw new Error(`Timeout waiting for transaction receipt ${e}`)};return void 0!==t?Promise.race([c(),new Promise(((s,n)=>setTimeout((()=>{r=!0,n(`Timeout waiting for transaction receipt ${e}`)}),t)))]):c()}}let zn=function(e){return e.UNKNOWN="UNKNOWN",e.DROPPED="DROPPED",e.QUEUED="QUEUED",e.SENT="SENT",e.SUCCEEDED="SUCCEEDED",e.PARTIALLY_FAILED="PARTIALLY_FAILED",e.FAILED="FAILED",e}({}),Yn=function(e){return e.SEND="SEND",e.RECEIVE="RECEIVE",e.BRIDGE_DEPOSIT="BRIDGE_DEPOSIT",e.BRIDGE_WITHDRAW="BRIDGE_WITHDRAW",e.BURN="BURN",e.UNKNOWN="UNKNOWN",e}({}),Zn=function(e){return e.UNKNOWN="UNKNOWN",e.ERC20_TOKEN="ERC20_TOKEN",e.ERC1155_TOKEN="ERC1155_TOKEN",e}({}),Qn=function(e){return e.DESC="DESC",e.ASC="ASC",e}({});class Xn{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Relayer/",this.ping=e=>this.fetch(this.url("Ping"),ei({},e)).then((e=>ti(e).then((e=>({status:e.status}))))),this.version=e=>this.fetch(this.url("Version"),ei({},e)).then((e=>ti(e).then((e=>({version:e.version}))))),this.runtimeStatus=e=>this.fetch(this.url("RuntimeStatus"),ei({},e)).then((e=>ti(e).then((e=>({status:e.status}))))),this.getSequenceContext=e=>this.fetch(this.url("GetSequenceContext"),ei({},e)).then((e=>ti(e).then((e=>({data:e.data}))))),this.getChainID=e=>this.fetch(this.url("GetChainID"),ei({},e)).then((e=>ti(e).then((e=>({chainID:e.chainID}))))),this.sendMetaTxn=(e,t)=>this.fetch(this.url("SendMetaTxn"),ei(e,t)).then((e=>ti(e).then((e=>({status:e.status,txnHash:e.txnHash}))))),this.getMetaTxnNonce=(e,t)=>this.fetch(this.url("GetMetaTxnNonce"),ei(e,t)).then((e=>ti(e).then((e=>({nonce:e.nonce}))))),this.getMetaTxnReceipt=(e,t)=>this.fetch(this.url("GetMetaTxnReceipt"),ei(e,t)).then((e=>ti(e).then((e=>({receipt:e.receipt}))))),this.simulate=(e,t)=>this.fetch(this.url("Simulate"),ei(e,t)).then((e=>ti(e).then((e=>({results:e.results}))))),this.updateMetaTxnGasLimits=(e,t)=>this.fetch(this.url("UpdateMetaTxnGasLimits"),ei(e,t)).then((e=>ti(e).then((e=>({payload:e.payload}))))),this.feeTokens=e=>this.fetch(this.url("FeeTokens"),ei({},e)).then((e=>ti(e).then((e=>({isFeeRequired:e.isFeeRequired,tokens:e.tokens}))))),this.feeOptions=(e,t)=>this.fetch(this.url("FeeOptions"),ei(e,t)).then((e=>ti(e).then((e=>({options:e.options,quote:e.quote}))))),this.getMetaTxnNetworkFeeOptions=(e,t)=>this.fetch(this.url("GetMetaTxnNetworkFeeOptions"),ei(e,t)).then((e=>ti(e).then((e=>({options:e.options}))))),this.sentTransactions=(e,t)=>this.fetch(this.url("SentTransactions"),ei(e,t)).then((e=>ti(e).then((e=>({page:e.page,transactions:e.transactions}))))),this.pendingTransactions=(e,t)=>this.fetch(this.url("PendingTransactions"),ei(e,t)).then((e=>ti(e).then((e=>({page:e.page,transactions:e.transactions}))))),this.getGasTank=(e,t)=>this.fetch(this.url("GetGasTank"),ei(e,t)).then((e=>ti(e).then((e=>({gasTank:e.gasTank}))))),this.addGasTank=(e,t)=>this.fetch(this.url("AddGasTank"),ei(e,t)).then((e=>ti(e).then((e=>({status:e.status,gasTank:e.gasTank}))))),this.updateGasTank=(e,t)=>this.fetch(this.url("UpdateGasTank"),ei(e,t)).then((e=>ti(e).then((e=>({status:e.status,gasTank:e.gasTank}))))),this.getGasSponsor=(e,t)=>this.fetch(this.url("GetGasSponsor"),ei(e,t)).then((e=>ti(e).then((e=>({gasSponsor:e.gasSponsor}))))),this.listGasSponsors=(e,t)=>this.fetch(this.url("ListGasSponsors"),ei(e,t)).then((e=>ti(e).then((e=>({page:e.page,gasSponsors:e.gasSponsors}))))),this.addGasSponsor=(e,t)=>this.fetch(this.url("AddGasSponsor"),ei(e,t)).then((e=>ti(e).then((e=>({status:e.status,gasSponsor:e.gasSponsor}))))),this.updateGasSponsor=(e,t)=>this.fetch(this.url("UpdateGasSponsor"),ei(e,t)).then((e=>ti(e).then((e=>({status:e.status,gasSponsor:e.gasSponsor}))))),this.removeGasSponsor=(e,t)=>this.fetch(this.url("RemoveGasSponsor"),ei(e,t)).then((e=>ti(e).then((e=>({status:e.status}))))),this.reportGasSponsorUsage=(e,t)=>this.fetch(this.url("ReportGasSponsorUsage"),ei(e,t)).then((e=>ti(e).then((e=>({gasSponsorUsage:e.gasSponsorUsage}))))),this.nextGasTankBalanceAdjustmentNonce=(e,t)=>this.fetch(this.url("NextGasTankBalanceAdjustmentNonce"),ei(e,t)).then((e=>ti(e).then((e=>({nonce:e.nonce}))))),this.adjustGasTankBalance=(e,t)=>this.fetch(this.url("AdjustGasTankBalance"),ei(e,t)).then((e=>ti(e).then((e=>({status:e.status,adjustment:e.adjustment}))))),this.getGasTankBalanceAdjustment=(e,t)=>this.fetch(this.url("GetGasTankBalanceAdjustment"),ei(e,t)).then((e=>ti(e).then((e=>({adjustment:e.adjustment}))))),this.listGasTankBalanceAdjustments=(e,t)=>this.fetch(this.url("ListGasTankBalanceAdjustments"),ei(e,t)).then((e=>ti(e).then((e=>({page:e.page,adjustments:e.adjustments}))))),this.hostname=e,this.fetch=(e,s)=>t(e,s)}url(e){return this.hostname+this.path+e}}const ei=(e={},t={})=>({method:"POST",headers:a({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}),ti=e=>e.text().then((t=>{let s;try{s=JSON.parse(t)}catch(s){throw{code:"unknown",msg:`expecting JSON, got: ${t}`,status:e.status}}if(!e.ok)throw s;return s}));var si=Object.freeze({__proto__:null,WebRPCVersion:"v1",WebRPCSchemaVersion:"v0.4.0",WebRPCSchemaHash:"950b00c821b56110c64d947312b9dea3e197e207",ETHTxnStatus:zn,TransferType:Yn,FeeTokenType:Zn,SortOrder:Qn,Relayer:Xn});const ni=[zn.DROPPED,zn.SUCCEEDED,zn.PARTIALLY_FAILED,zn.FAILED],ii=[zn.DROPPED,zn.PARTIALLY_FAILED,zn.FAILED];const ri="object"==typeof global?global.fetch:window.fetch;class ai{constructor(e){if(this.options=e,this.service=void 0,this.provider=void 0,this._fetch=(e,t)=>{const s={},{jwtAuth:n,projectAccessKey:i}=this.options;return n&&n.length>0&&(s.Authorization=`BEARER ${n}`),i&&i.length>0&&(s["X-Access-Key"]=i),t.headers=a({},t.headers,s),ri(e,t)},this.service=new Xn(e.url,this._fetch),t.ethers.providers.Provider.isProvider(e.provider))this.provider=e.provider;else{const{jwtAuth:s,projectAccessKey:n}=this.options,i=Te(e.provider.url,n,s);this.provider=new t.ethers.providers.StaticJsonRpcProvider(i)}}async waitReceipt(e,t=1e3,s=5,n){"string"!=typeof e&&(e=tn(e)),ke.info(`[rpc-relayer/waitReceipt] waiting for ${e}`);let i=0;for(;void 0===n||!n();){try{const{receipt:t}=await this.service.getMetaTxnReceipt({metaTxID:e});if(t&&t.txnReceipt&&"null"!==t.txnReceipt&&ni.includes(t.status))return{receipt:t}}catch(e){if(i++,i===s)throw e}void 0!==n&&n()||await new Promise((e=>setTimeout(e,t)))}throw new Error(`Cancelled waiting for transaction receipt ${e}`)}async simulate(e,...s){const n=t.ethers.utils.defaultAbiCoder.encode([en],[un(s)]);return(await this.service.simulate({wallet:e,transactions:n})).results}async getFeeOptions(e,...t){const s=await this.service.feeTokens();if(s.isFeeRequired){const n=s.tokens.map((e=>e.symbol)).join(", ");ke.info(`[rpc-relayer/getFeeOptions] relayer fees are required, accepted tokens are ${n}`);const i=await this.getNonce(e);if(!this.provider)throw ke.warn("[rpc-relayer/getFeeOptions] provider not set, needed for stub signature"),new Error("provider is not set");const{options:r,quote:a}=await this.service.feeOptions({wallet:e,to:e,data:vn({entrypoint:e,transactions:t,nonce:i})});return ke.info(`[rpc-relayer/getFeeOptions] got refund options ${JSON.stringify(r)}`),{options:r,quote:{_tag:"FeeQuote",_quote:a}}}return ke.info("[rpc-relayer/getFeeOptions] relayer fees are not required"),{options:[]}}async getFeeOptionsRaw(e,s,n){const{options:i,quote:r}=await this.service.feeOptions({wallet:e,to:e,data:t.ethers.utils.hexlify(s),simulate:null==n?void 0:n.simulate});return{options:i,quote:{_tag:"FeeQuote",_quote:r}}}async gasRefundOptions(e,...t){const{options:s}=await this.getFeeOptions(e,...t);return s}async getNonce(e,s){ke.info(`[rpc-relayer/getNonce] get nonce for wallet ${e} space: ${s}`);const n=void 0!==s?t.ethers.BigNumber.from(s).toHexString():void 0,i=await this.service.getMetaTxnNonce({walletContractAddress:e,space:n}),r=t.ethers.BigNumber.from(i.nonce),[a,o]=pn(r);return ke.info(`[rpc-relayer/getNonce] got next nonce for wallet ${e} ${o} space: ${a}`),r}async relay(e,t,s=!0){var n=this;let i;if(ke.info(`[rpc-relayer/relay] relaying signed meta-transactions ${JSON.stringify(e)} with quote ${JSON.stringify(t)}`),void 0!==t&&("string"==typeof t._quote?i=t._quote:ke.warn("[rpc-relayer/relay] ignoring invalid fee quote")),!this.provider)throw ke.warn("[rpc-relayer/relay] provider not set, failed relay"),new Error("provider is not set");const r=vn(e),a=await this.service.sendMetaTxn({call:{walletAddress:e.intent.wallet,contract:e.entrypoint,input:r},quote:i});if(ke.info(`[rpc-relayer/relay] got relay result ${JSON.stringify(a)}`),s)return this.wait(e.intent.id);{const t={hash:e.intent.id,confirmations:0,from:e.intent.wallet,wait:e=>Promise.reject(new Error("impossible"))},s=async function(s){var i;if(!n.provider)throw new Error("cannot wait for receipt, relayer has no provider set");const r=await n.wait(e.intent.id),a=null==(i=r.receipt)?void 0:i.transactionHash;if(!a)throw new Error("cannot wait for receipt, unknown native transaction hash");return Object.assign(t,r),n.provider.waitForTransaction(a,s)};return t.wait=s,t}}async wait(e,s,n=1e3,i=5){var r=this;let a=!1;const{receipt:o}=await(void 0!==s?Promise.race([this.waitReceipt(e,n,i,(()=>a)),new Promise(((t,n)=>setTimeout((()=>{a=!0,n(`Timeout waiting for transaction receipt ${e}`)}),s)))]):this.waitReceipt(e,n,i));if(!o.txnReceipt||ii.includes(o.status))throw new oi(o);const c=JSON.parse(o.txnReceipt);return{blockHash:c.blockHash,blockNumber:t.ethers.BigNumber.from(c.blockNumber).toNumber(),confirmations:1,from:"string"==typeof e?void 0:e.intent.wallet,hash:c.transactionHash,raw:o.txnReceipt,receipt:c,wait:async function(e){return r.provider.waitForTransaction(c.transactionHash,e)}}}}class oi{constructor(e){this.receipt=e}}function ci(e){return"object"==typeof e&&"function"==typeof e.simulate&&"function"==typeof e.getFeeOptions&&"function"==typeof e.gasRefundOptions&&"function"==typeof e.getNonce&&"function"==typeof e.relay&&"function"==typeof e.wait}async function hi(e){return Array.isArray(e)?Promise.all(e.map((e=>t.utils.resolveProperties(e)))):t.utils.resolveProperties(e)}function li(e){return void 0!==e.getAddress&&void 0!==e.buildDeployTransaction&&void 0!==e.predecorateSignedTransactions&&void 0!==e.decorateTransactions&&void 0!==e.sign&&void 0!==e.notifyStatusChange}class di{constructor(e,t=!0){this.signer=e,this.eoa=t}getAddress(){return this.signer.getAddress()}async buildDeployTransaction(e){}async predecorateSignedTransactions(e){return[]}async decorateTransactions(e,t){return e}sign(e,t){return this.signer.signMessage(e)}notifyStatusChange(e,t,s){}suffix(){return[2]}}var ui=Object.freeze({__proto__:null,isSapientSigner:li,SignerWrapper:di});let fi=function(e){return e[e.INITIAL=0]="INITIAL",e[e.SIGNING=1]="SIGNING",e[e.SIGNED=2]="SIGNED",e[e.ERROR=3]="ERROR",e}({});function gi(e){return void 0===e||e.state===fi.INITIAL||e.state===fi.SIGNING}class pi{constructor(e,t=pi.randomTag()){this.tag=t,this.observers=[],this.signers=[],this.count=0,this.setSigners(e)}static randomTag(){return`default-${t.ethers.utils.hexlify(t.ethers.utils.randomBytes(8)).slice(2)}`}pullId(){return`${this.tag}-${this.count++}`}setSigners(e){this.signers=e.map((e=>li(e)?e:new di(e)))}async getSigners(){return Promise.all(this.signers.map((async function(e){return e.getAddress()})))}subscribe(e){return this.observers.push(e),()=>{this.observers=this.observers.filter((t=>t!==e))}}async notifyObservers(e,t,s){await Promise.all([...this.signers.map((async function(n){return n.notifyStatusChange(e,t,s)})),...this.observers.map((async function(e){return e(t,s)}))])}async buildDeployTransaction(e){let t;for(const s of this.signers){const n=await s.buildDeployTransaction(e);void 0===t?t=n:null!=n&&n.transactions&&(t.transactions=n.transactions.concat(t.transactions))}return t}async predecorateSignedTransactions(e){const t=[];for(const s of this.signers)t.push(...await s.predecorateSignedTransactions(null!=e?e:{}));return t}async decorateTransactions(e,t){for(const s of this.signers)e=await s.decorateTransactions(e,null!=t?t:{});return e}signMessage(e){var t=this;const s=this.pullId();return new Promise((async function(n){const{message:i,metadata:r,callback:a,candidates:o}=e,c={ended:!1,message:i,signers:{}};let h=null!=r?r:{};const l=e=>{h=e,t.notifyObservers(s,c,h)},d=()=>{try{t.notifyObservers(s,c,h);const e=Object.entries(c.signers).filter((([e,t])=>gi(t)));if(a&&a(c,l)||0===e.length)return c.ended=!0,n(c),void t.notifyObservers(s,c,h)}catch(e){console.error("Error while notifying observers",e)}};let u=t.signers;if(o){const e=await Promise.all(t.signers.map((async function(e){return e.getAddress()})));u=t.signers.filter(((t,s)=>o.includes(e[s])))}const f=await Promise.allSettled(u.map((async function(e){const t=await e.getAddress();c.signers[t]={state:fi.SIGNING,request:e.sign(i,null!=r?r:{}).then((s=>{const n=e.suffix();return c.signers[t]={state:fi.SIGNED,signature:s,suffix:n},d(),s})).catch((e=>{throw c.signers[t]={state:fi.ERROR,error:e},d(),e}))}})));for(let e=0;e<f.length;e++){const s=t.signers[e],n=f[e];if("rejected"===n.status){const e=await s.getAddress();console.warn(`signer ${e} rejected the request: ${n.reason}`),c.signers[e]={state:fi.ERROR,error:new Error(`signer ${e} rejected the request: ${n.reason}`)}}}d()}))}}const mi=e=>{const s=new Map;for(const n of Object.keys(e.signers)){const i=e.signers[n];if(i.state===fi.SIGNED){const e=t.ethers.utils.arrayify(i.suffix),r=t.ethers.utils.solidityPack(["bytes","bytes"],[i.signature,e]);s.set(n,{signature:r,isDynamic:1!==e.length||2!==e[0]})}}return s};class yi extends t.ethers.Signer{constructor(e){if(t.ethers.constants.Zero.eq(e.chainId)&&!e.coders.signature.supportsNoChainId)throw new Error(`Sequence version ${e.config.version} doesn't support chainId 0`);super(),this.context=void 0,this.config=void 0,this.address=void 0,this.chainId=void 0,this.provider=void 0,this.relayer=void 0,this.coders=void 0,this.orchestrator=void 0,this._reader=void 0,this.context=e.context,this.config=e.config,this.orchestrator=e.orchestrator,this.coders=e.coders,this.address=e.address,this.chainId=e.chainId,this.provider=e.provider,this.relayer=e.relayer,this._reader=e.reader}static newWallet(e){const t=Zs(e.context,e.coders.config.imageHashOf(e.config));return new yi(a({},e,{address:t}))}reader(){if(this._reader)return this._reader;if(!this.provider)throw new Error("Wallet status provider requires a provider");return new On(this.provider)}setConfig(e){this.config=e}setOrchestrator(e){this.orchestrator=e}setAddress(e){this.address=e}getSigners(){return this.orchestrator.getSigners()}async getAddress(){return this.address}async decorateTransactions(e){const t=await this.orchestrator.decorateTransactions(e);if(await this.reader().isDeployed(this.address))return t;const s=[{to:t.entrypoint,data:vn(t),revertOnError:!0}],n=await this.buildDeployTransaction();return n&&s.unshift(...n.transactions),{entrypoint:this.context.guestModule,chainId:this.chainId,intent:t.intent,transactions:s}}async buildDeployTransaction(e){if(null!=e&&e.ignoreDeployed&&await this.reader().isDeployed(this.address))return;const t=this.coders.config.imageHashOf(this.config);if(Zs(this.context,t)!==this.address)throw new Error(`First address of config ${t} doesn't match wallet address ${this.address}`);const s=yi.buildDeployTransaction(this.context,t);if(null!=e&&e.includeChildren){const t=await this.orchestrator.buildDeployTransaction(e);t&&(s.transactions=t.transactions.concat(s.transactions))}return s}async deploy(e){const s=await this.buildDeployTransaction(e);if(void 0!==s){if(!this.relayer)throw new Error("Wallet deploy requires a relayer");return this.relayer.relay(a({},s,{chainId:this.chainId,intent:{id:t.ethers.utils.hexlify(t.ethers.utils.randomBytes(32)),wallet:this.address}}))}}static buildDeployTransaction(e,s){const n=new t.ethers.utils.Interface(i.factory.abi);return{entrypoint:e.guestModule,transactions:[{to:e.factory,data:n.encodeFunctionData(n.getFunction("deploy"),[e.mainModule,s]),gasLimit:1e5,delegateCall:!1,revertOnError:!0,value:0}]}}async buildUpdateConfigurationTransaction(e){if(this.coders.config.update.isKindUsed){const t=await this.reader().implementation(this.address),s=t&&t===this.context.mainModuleUpgradable;return this.coders.config.update.buildTransaction(this.address,e,this.context,s?"later":"first")}return this.coders.config.update.buildTransaction(this.address,e,this.context)}async getNonce(e=0){const t=await this.reader().nonce(this.address,e);if(void 0===t)throw new Error("Unable to determine nonce");return t}async signDigest(e,s){const n=be(this.address,this.chainId,e);if(this.coders.config.hasSubdigest(this.config,n))return this.coders.signature.encodeSigners(this.config,new Map,[n],this.chainId).encoded;const i=a({},s,{digest:e,chainId:this.chainId,address:this.address,config:this.config}),r=t.ethers.utils.arrayify(n),o=await this.orchestrator.signMessage({candidates:this.coders.config.signersOf(this.config).map((e=>e.address)),message:r,metadata:i,callback:(e,t)=>{const s=mi(e);return t(a({},i,{parts:s})),this.coders.signature.hasEnoughSigningPower(this.config,s)}}),c=mi(o);return this.coders.signature.encodeSigners(this.config,c,[],this.chainId).encoded}signMessage(e){return this.signDigest(t.ethers.utils.keccak256(e),{message:e})}signTransactionBundle(e){if(e.entrypoint!==this.address)throw new Error(`Invalid entrypoint: ${e.entrypoint} !== ${this.address}`);return this.signTransactions(e.transactions,e.nonce)}async fetchNonceOrSpace(e){let s;if(e&&void 0!==e.space)s=t.ethers.BigNumber.from(e.space);else{if(void 0===e)return this.randomNonce();if(!e||!0!==e.serial)return e;s=0}const n=await this.reader().nonce(this.address,s);if(void 0===n)throw new Error("Unable to determine nonce");return gn(s,n)}randomNonce(){return gn(t.ethers.BigNumber.from(t.ethers.utils.hexlify(t.ethers.utils.randomBytes(12))),0)}async signTransactions(e,t,s){const n=await hi(e),i=mn(this.address,n);0===i.length&&i.push({to:this.address,data:"0x",value:0,gasLimit:0,delegateCall:!1,revertOnError:!0});const r=await this.fetchNonceOrSpace(t),o=rn(r,i),c=a({digest:o,transactions:i},s),h=await this.signDigest(o,c);return{intent:{id:be(this.address,this.chainId,o),wallet:this.address},chainId:this.chainId,transactions:i,entrypoint:this.address,nonce:r,signature:h}}async sendSignedTransaction(e,t){if(!this.relayer)throw new Error("Wallet sendTransaction requires a relayer");return this.relayer.relay(e,t)}async sendTransaction(e,t){let s;s=void 0!==(null==t?void 0:t.nonce)?t.nonce:null!=t&&t.serial?{serial:!0}:this.randomNonce();const n=await this.signTransactions(e,s),i=await this.decorateTransactions(n);return this.sendSignedTransaction(i,null==t?void 0:t.quote)}async fillGasLimits(e){const s=await hi(e),n=mn(this.address,s),i=this.relayer;if(!i)throw new Error("Wallet fillGasLimits requires a relayer");const r=await i.simulate(this.address,...n);return n.map(((e,s)=>{const n=e.gasLimit?t.ethers.BigNumber.from(e.gasLimit).toNumber():r[s].gasLimit;return a({},e,r[s],{gasLimit:n})}))}connect(e,t){return this.provider=e,this.relayer=t,this}signTransaction(e){throw new Error("Method not implemented.")}}function wi(e){if(!e)return[];const s=t.ethers.BigNumber.from(e.value);switch(e.token.type){case Zn.UNKNOWN:return[{delegateCall:!1,revertOnError:!0,gasLimit:e.gasLimit,to:e.to,value:s.toHexString(),data:[]}];case Zn.ERC20_TOKEN:if(!e.token.contractAddress)throw new Error("No contract address for ERC-20 fee option");return[{delegateCall:!1,revertOnError:!0,gasLimit:e.gasLimit,to:e.token.contractAddress,value:0,data:new t.ethers.utils.Interface([{constant:!1,inputs:[{type:"address"},{type:"uint256"}],name:"transfer",outputs:[],type:"function"}]).encodeFunctionData("transfer",[e.to,s.toHexString()])}];default:throw new Error(`Unhandled fee token type ${e.token.type}`)}}class vi{constructor(e,t,s){this.account=e,this.chainId=t,this.options=s,this._isSigner=!0}get provider(){return this.account.providerFor(this.chainId)}async getAddress(){return this.account.address}signMessage(e){var t,s;return this.account.signMessage(e,this.chainId,null!=(t=null==(s=this.options)?void 0:s.cantValidateBehavior)?t:"throw")}async defaultSelectFee(e,s){if(0===s.length)return;const n=[{constant:!0,inputs:[{type:"address"}],name:"balanceOf",outputs:[{type:"uint256"}],type:"function"}];for(const e of s)if(e.token.type===Zn.UNKNOWN){if((await this.getBalance()).gte(t.ethers.BigNumber.from(e.value)))return e}else if(e.token.contractAddress&&e.token.type===Zn.ERC20_TOKEN){const s=new t.ethers.Contract(e.token.contractAddress,n,this.provider);if((await s.balanceOf(this.account.address)).gte(t.ethers.BigNumber.from(e.value)))return e}throw new Error("No fee option available - not enough balance")}async sendTransaction(e,s){var n,i,r,a,o;const c="object"==typeof(h=e)&&Object.keys(h).some((e=>function(e){return!!e&&"function"==typeof e.then}(h[e])))?await t.ethers.utils.resolveProperties(e):e;var h;const l=await this.account.prepareTransactions({txs:c,chainId:this.chainId,stubSignatureOverrides:null!=(n=null==(i=this.options)?void 0:i.stubSignatureOverrides)?n:new Map,simulateForFeeOptions:null==s?void 0:s.simulateForFeeOptions}),d=null!=(r=null==(a=this.options)?void 0:a.selectFee)?r:this.defaultSelectFee.bind(this),u=await d(c,l.feeOptions),f=[...l.transactions,...wi(u)];return this.account.sendTransaction(f,this.chainId,l.feeQuote,void 0,void 0,void 0!==(null==(o=this.options)?void 0:o.nonceSpace)?{nonceSpace:this.options.nonceSpace}:void 0)}getBalance(e){return this.provider.getBalance(this.account.address,e)}call(e,t){return this.provider.call(e,t)}async resolveName(e){const t=await this.provider.resolveName(e);if(!t)throw new Error(`Could not resolve name ${e}`);return t}connect(e){throw new Error("Method not implemented.")}signTransaction(e){throw new Error("Method not implemented.")}getTransactionCount(e){throw new Error("Method not implemented.")}estimateGas(e){throw new Error("Method not implemented.")}getChainId(){return Promise.resolve(t.ethers.BigNumber.from(this.chainId).toNumber())}getGasPrice(){throw new Error("Method not implemented.")}getFeeData(){throw new Error("Method not implemented.")}checkTransaction(e){throw new Error("Method not implemented.")}populateTransaction(e){throw new Error("Method not implemented.")}_checkProvider(e){throw new Error("Method not implemented.")}}class bi{async isDeployed(e){return!1}async implementation(e){}async imageHash(e){}async nonce(e,s){return t.ethers.constants.Zero}async isValidSignature(e,t,s){throw new Error("Method not supported.")}}class Ii{constructor(e){this.address=void 0,this.networks=void 0,this.tracker=void 0,this.contexts=void 0,this.migrator=void 0,this.migrations=void 0,this.orchestrator=void 0,this.jwt=void 0,this.projectAccessKey=void 0,this.address=t.ethers.utils.getAddress(e.address),this.contexts=e.contexts,this.tracker=e.tracker,this.networks=e.networks,this.orchestrator=e.orchestrator,this.jwt=e.jwt,this.projectAccessKey=e.projectAccessKey,this.migrations=e.migrations||Fn,this.migrator=new qn(e.tracker,this.migrations,this.contexts)}getSigner(e,t){return new vi(this,e,t)}static async new(e){var t;const s=new qn(e.tracker,null!=(t=e.migrations)?t:Fn,e.contexts).lastMigration(),n=s.configCoder,i=n.fromSimple(e.config),r=n.imageHashOf(i),a=Zs(e.contexts[s.version],r);return await e.tracker.saveCounterfactualWallet({config:i,context:Object.values(e.contexts)}),new Ii({address:a,tracker:e.tracker,contexts:e.contexts,networks:e.networks,orchestrator:e.orchestrator,migrations:e.migrations,projectAccessKey:e.projectAccessKey})}getAddress(){return Promise.resolve(this.address)}get version(){return this.migrator.lastMigration().version}get coders(){const e=this.migrator.lastMigration();return{signature:e.signatureCoder,config:e.configCoder}}network(e){const s=t.ethers.BigNumber.from(e),n=this.networks.find((e=>s.eq(e.chainId)));if(!n)throw new Error(`Network not found for chainId ${e}`);return n}providerFor(e){const s=this.network(e);if(!s.provider&&!s.rpcUrl)throw new Error(`Provider not found for chainId ${e}`);return s.provider||new t.ethers.providers.StaticJsonRpcProvider(Te(s.rpcUrl,this.projectAccessKey,this.jwt),{name:"",chainId:t.ethers.BigNumber.from(e).toNumber()})}reader(e){return t.ethers.constants.Zero.eq(e)?new bi:new On(this.providerFor(e))}relayer(e){const t=this.network(e);if(!t.relayer)throw new Error(`Relayer not found for chainId ${e}`);return ci(t.relayer)?t.relayer:new ai(a({},t.relayer,{projectAccessKey:this.projectAccessKey,jwtAuth:this.jwt}))}setOrchestrator(e){this.orchestrator=e}setJwt(e){this.jwt=e}contextFor(e){const t=this.contexts[e];if(!t)throw new Error(`Context not found for version ${e}`);return t}walletForStatus(e,t){const s=Mn(t.version);return this.walletFor(e,this.contextFor(t.version),t.config,s)}walletFor(e,s,n,i){const r=t.ethers.constants.Zero.eq(e);return new yi({config:n,context:s,chainId:e,coders:i,relayer:r?void 0:this.relayer(e),address:this.address,orchestrator:this.orchestrator,reader:this.reader(e)})}async status(e,t=!1){var s=this;const n=this.reader(e).isDeployed(this.address),i=this.tracker.imageHashOfCounterfactualWallet({wallet:this.address}).then((e=>{if(!e)throw new Error(`Counterfactual imageHash not found for wallet ${this.address}`);return e})),r=i.then((e=>Bn(this.address,e.imageHash,Object.values(this.contexts)))),o=async function(){if(!await n)return r;const t=await s.reader(e).implementation(s.address);if(!t)throw new Error(`Implementation not found for wallet ${s.address}`);const i=Object.values(s.contexts);for(let e=0;e<i.length;e++)if(i[e].mainModule===t||i[e].mainModuleUpgradable===t)return i[e].version;throw new Error(`Version not found for implementation ${t}`)}(),c=async function(){const t=await s.reader(e).imageHash(s.address);if(t)return t;const n=await i;if(n)return n.imageHash;throw new Error(`On-chain imageHash not found for wallet ${s.address}`)}(),h=async function(){const e=await c,t=await s.tracker.configOfImageHash({imageHash:e});if(t)return t;throw new Error(`On-chain config not found for imageHash ${e}`)}(),l=await o,d=await c;let u=d,f=l,g=[];if(l!==this.version){const t=await this.migrator.getAllMigratePresignedTransaction({address:this.address,fromImageHash:d,fromVersion:l,chainId:e});u=t.lastImageHash,f=t.lastVersion,g=t.signedMigrations}const p=await this.tracker.loadPresignedConfiguration({wallet:this.address,fromImageHash:u,longestPath:t}),m=p&&p.length>0?p[p.length-1].nextImageHash:u,y=await this.tracker.configOfImageHash({imageHash:m});if(!y)throw new Error(`Config not found for imageHash ${m}`);const w=await n,v=await i,b=Mn(f).config.checkpointOf(y);return{original:a({},v,{version:await r}),onChain:{imageHash:d,config:await h,version:l,deployed:w},fullyMigrated:f===this.version,signedMigrations:g,version:f,presignedConfigurations:p,imageHash:m,config:y,checkpoint:b,canOnchainValidate:l===this.version&&w}}mustBeFullyMigrated(e){if(!e.fullyMigrated)throw new Error(`Wallet ${this.address} is not fully migrated`)}async predecorateSignedTransactions(e,t){const s=await this.orchestrator.predecorateSignedTransactions({chainId:t}),n=await this.predecorateTransactions([],e,t);return mn(this.address,n).length>0&&s.push(await this.signTransactions(n,t)),s}async predecorateTransactions(e,t,s){if(t.onChain.imageHash!==t.imageHash){const n=this.walletForStatus(s,t),i=await n.buildUpdateConfigurationTransaction(t.config);return[Array.isArray(e)?e:[e],i.transactions].flat()}return e}async decorateTransactions(e,t,s){var n,i;if(!Array.isArray(e))return this.decorateTransactions([e],t,s);s=null!=(n=s)?n:e[0].chainId;const r=await this.buildBootstrapTransactions(t,s),a=r.transactions.length>0;if(!a&&1===e.length)return e[0];const{entrypoint:o}=a?r:e[0],c={entrypoint:o,chainId:s,intent:null==(i=e[0])?void 0:i.intent,transactions:[...r.transactions,...e.map((e=>({to:e.entrypoint,data:vn(e),gasLimit:0,delegateCall:!1,revertOnError:!0,value:0})))]};if(!t.onChain.deployed){const e=on(this.contexts[this.version].guestModule,s,c.transactions);void 0===c.intent?c.intent={id:e,wallet:this.address}:c.intent.id=e}return c}async decorateSignature(e,t){if(!t.presignedConfigurations||0===t.presignedConfigurations.length)return e;const s=this.coders.signature,n=t.presignedConfigurations.map((e=>e.signature)),i=s.chainSignatures(e,n);return s.trim(i)}async publishWitness(){const e=t.ethers.utils.keccak256(t.ethers.utils.toUtf8Bytes(`This is a Sequence account woo! ${Date.now()}`)),s=await this.signDigest(e,0,!1),n=this.coders.signature.decode(s),i=this.coders.signature.signaturesOfDecoded(n);return this.tracker.saveWitnesses({wallet:this.address,digest:e,chainId:0,signatures:i})}async signDigest(e,s,n=!0,i="ignore",r){const a=t.ethers.constants.Zero.eq(s)?this.networks[0].chainId:s,o=await this.status(a);if(this.mustBeFullyMigrated(o),!o.canOnchainValidate&&"throw"===i)throw new Error("Wallet cannot validate onchain");const c=this.walletForStatus(s,o),h=await c.signDigest(e,r),l=n?this.decorateSignature(h,o):h;if(!o.canOnchainValidate)switch(i){case"ignore":return l;case"eip6492":return this.buildEIP6492Signature(await l,o,s)}return l}buildOnChainSignature(e){const s=dt({digest:t.ethers.utils.hexlify(e),chainId:0,address:this.address}),n=t.ethers.utils.hexlify(s),r=this.coders.config.fromSimple({threshold:32768,checkpoint:0,signers:[],subdigests:[n]}),a=new t.ethers.utils.Interface(i.mainModule.abi),o={entrypoint:this.address,transactions:[{to:this.address,data:a.encodeFunctionData("setExtraImageHash",[this.coders.config.imageHashOf(r),"57896044618658097711785492504343953926634992332820282019728792003956564819968"]),gasLimit:25e4}]};this.tracker.saveWalletConfig({config:r});return{bundle:o,signature:this.coders.signature.encodeSigners(r,new Map,[n],0).encoded}}async buildEIP6492Signature(e,s,n){const i=await this.buildBootstrapTransactions(s,n);if(0===i.transactions.length)throw new Error("Cannot build EIP-6492 signature without bootstrap transactions");const r=t.ethers.utils.defaultAbiCoder.encode(["address","bytes","bytes"],[i.entrypoint,vn(i),e]);return t.ethers.utils.solidityPack(["bytes","bytes32"],[r,kn])}async editConfig(e){const t=await this.status(0).then((e=>e.config)),s=this.coders.config.editConfig(t,a({},e,{checkpoint:this.coders.config.checkpointOf(t).add(1)}));return this.updateConfig(s)}async updateConfig(e){if(!this.coders.config.isWalletConfig(e))throw new Error(`Invalid config for wallet ${this.address}`);const t=this.coders.config.imageHashOf(e),s=this.coders.signature.hashSetImageHash(t),n=await this.signDigest(s,0,!1);await this.tracker.savePresignedConfiguration({wallet:this.address,nextConfig:e,signature:n});const i=await this.tracker.configOfImageHash({imageHash:t,noCache:!0});if(!i||this.coders.config.imageHashOf(i)!==t)throw Error(`Reverse lookup failed for imageHash ${t}`)}async buildBootstrapTransactions(e,t){var s;const n=await this.orchestrator.buildDeployTransaction({chainId:t}),i=null!=(s=null==n?void 0:n.transactions)?s:[];if(!e.onChain.deployed){const t=yi.buildDeployTransaction(e.original.context,e.original.imageHash);i.push(...t.transactions)}i.length,i.push(...e.signedMigrations.map((e=>({to:e.tx.entrypoint,data:vn(e.tx),value:0,gasLimit:0,revertOnError:!0,delegateCall:!1}))));const r=e.signedMigrations.length>0?e.signedMigrations[0].tx.intent.id:on(this.contexts[this.version].guestModule,t,i),{guestModule:a}=this.contextFor(e.version);return{entrypoint:a,transactions:i,chainId:t,intent:{id:r,wallet:this.address}}}async bootstrapTransactions(e,t){const s=t||await this.status(e);return this.buildBootstrapTransactions(s,e)}async doBootstrap(e,t,s){const n=await this.bootstrapTransactions(e,s);return this.relayer(e).relay(a({},n,{chainId:e}),t)}signMessage(e,s,n="ignore"){return this.signDigest(t.ethers.utils.keccak256(e),s,!0,n)}async signTransactions(e,t,s,n){const i=s||await this.status(t);this.mustBeFullyMigrated(i);const r=this.walletForStatus(t,i),o={address:this.address,digest:"",chainId:t,config:{version:this.version},decorate:!0,cantValidateBehavior:"ignore"},c=null!=n&&n.serial?{serial:!0}:void 0!==(null==n?void 0:n.nonceSpace)?{space:n.nonceSpace}:void 0,h=await r.signTransactions(e,c,o);return a({},h,{signature:await this.decorateSignature(h.signature,i)})}async signMigrations(e,t){const s=await this.status(e);if(s.fullyMigrated)return!1;const n=this.walletForStatus(e,s),i=t(n.config),r=await this.migrator.signNextMigration(this.address,s.version,n,i);if(!r)return!1;await this.tracker.saveWalletConfig({config:i});const a=Mn(i.version).config,o=a.imageHashOf(i),c=await this.tracker.configOfImageHash({imageHash:o,noCache:!0});if(!c||a.imageHashOf(c)!==o)throw Error(`Reverse lookup failed for imageHash ${o}`);return await this.tracker.saveMigration(this.address,r,this.contexts),!0}async signAllMigrations(e){var t=this;const s=[],n=(await Promise.all(this.networks.map((async function(n){try{return await t.signMigrations(n.chainId,e)}catch(e){return console.warn(`Failed to sign migrations for chain ${n.chainId}`,e),s.push(n.chainId),null}})))).filter((e=>null!==e));return{signedMigrations:n,failedChains:s}}async isMigratedAllChains(){var e=this;const t=[];return{migratedAllChains:(await Promise.all(this.networks.map((async function(s){try{return await e.status(s.chainId)}catch(e){return t.push(s.chainId),console.warn(`Failed to get status for chain ${s.chainId}`,e),{fullyMigrated:!0}}})))).every((e=>e.fullyMigrated)),failedChains:t}}async sendSignedTransactions(e,t,s,n,i){if(!Array.isArray(e))return this.sendSignedTransactions([e],t,s,n,i);const r=n||await this.status(t);this.mustBeFullyMigrated(r);const a=await this.decorateTransactions(e,r,t);return null==i||i(a),this.relayer(t).relay(a,s)}async fillGasLimits(e,t,s){return this.walletForStatus(t,s||await this.status(t)).fillGasLimits(e)}async gasRefundQuotes(e,s,n,i,r){const o=i||await this.status(s),c=this.walletForStatus(s,o),h=await this.predecorateTransactions(e,o,s),l=mn(this.address,h),d=c.coders.config.buildStubSignature(c.config,n),u={chainId:s,intent:{id:t.ethers.utils.hexlify(t.ethers.utils.randomBytes(32)),wallet:this.address},signature:d,transactions:l,entrypoint:this.address,nonce:0},f=await this.decorateTransactions(u,o),g=vn(f);return a({},await this.relayer(s).getFeeOptionsRaw(f.entrypoint,g,r),{decorated:f})}async prepareTransactions(e){const t=await this.status(e.chainId),s=await this.fillGasLimits(e.txs,e.chainId,t),n=await this.gasRefundQuotes(s,e.chainId,e.stubSignatureOverrides,t,{simulate:e.simulateForFeeOptions});return{transactions:s,flatDecorated:En(this.address,n.decorated.transactions),feeOptions:n.options,feeQuote:n.quote}}async sendTransaction(e,t,s,n=!1,i,r){const a=await this.status(t),o=n?e:await this.predecorateTransactions(e,a,t),c=mn(this.address,o).length>0?await this.signTransactions(o,t,void 0,r):void 0,h=await this.orchestrator.predecorateSignedTransactions({chainId:t}),l=[];return void 0!==c&&c.transactions.length>0&&l.push(c),l.push(...h.filter((e=>e.transactions.length>0))),this.sendSignedTransactions(l,t,s,void 0,i)}async signTypedData(e,t,s,n,i="ignore"){const r=Re({domain:e,types:t,message:s});return this.signDigest(r,n,!0,i)}async getSigners(){var e=this;const t=e=>e.length?e[e.length-1]:void 0;return(await Promise.all(this.networks.map((async function({chainId:s,name:n}){try{var i;const n=await e.status(s);let r=null==(i=t(n.presignedConfigurations))?void 0:i.nextImageHash;if(!r&&n.onChain.version!==n.version){const e=t(n.signedMigrations);if(e){const{toVersion:t,toConfig:s}=e;r=Rn(t).config.imageHashOf(s)}}r||(r=n.onChain.imageHash);const o=await e.tracker.configOfImageHash({imageHash:r});if(!o)throw new Error(`unable to find config for image hash ${r}`);const c=Rn(o.version);return c.config.signersOf(o).map((e=>a({},e,{network:s})))}catch(e){return console.warn(`unable to get signers on network ${s} ${n}`,e),[]}})))).flat()}async getAllSigners(){var e=this;const t=[];return await Promise.all(this.networks.map((async function(s){const n=s.chainId,i=await e.status(n,!0),r=[i.onChain.imageHash,...i.onChain.version!==i.version?i.signedMigrations.map((e=>Mn(e.toVersion).config.imageHashOf(e.toConfig))):[],...i.presignedConfigurations.map((e=>e.nextImageHash))];return Promise.all(r.map((async function(s,i){const a=i===r.length-1,o=await e.tracker.configOfImageHash({imageHash:s});if(!o)return void console.warn(`AllSigners may be incomplete, config not found for imageHash ${s}`);Rn(o.version).config.signersOf(o).forEach((e=>{const s=t.find((t=>t.address===e.address&&t.network===n));s&&a&&s.flaggedForRemoval?s.flaggedForRemoval=!1:s||t.push({address:e.address,weight:e.weight,network:n,flaggedForRemoval:!a})}))})))}))),t}}let Ei=function(e){return e.UNKNOWN="UNKNOWN",e.ERC20="ERC20",e.ERC721="ERC721",e.ERC1155="ERC1155",e.SEQUENCE_WALLET="SEQUENCE_WALLET",e.ERC20_BRIDGE="ERC20_BRIDGE",e.ERC721_BRIDGE="ERC721_BRIDGE",e.ERC1155_BRIDGE="ERC1155_BRIDGE",e}({}),Ci=function(e){return e.UNKNOWN="UNKNOWN",e.BLOCK_ADDED="BLOCK_ADDED",e.BLOCK_REMOVED="BLOCK_REMOVED",e}({}),Si=function(e){return e.UNKNOWN="UNKNOWN",e.TOKEN_TRANSFER="TOKEN_TRANSFER",e.NATIVE_TOKEN_TRANSFER="NATIVE_TOKEN_TRANSFER",e.SEQUENCE_TXN="SEQUENCE_TXN",e}({}),ki=function(e){return e.UNKNOWN="UNKNOWN",e.SEND="SEND",e.RECEIVE="RECEIVE",e}({}),Ti=function(e){return e.FAILED="FAILED",e.SUCCESSFUL="SUCCESSFUL",e}({}),_i=function(e){return e.LegacyTxnType="LegacyTxnType",e.AccessListTxnType="AccessListTxnType",e.DynamicFeeTxnType="DynamicFeeTxnType",e}({}),Oi=function(e){return e.DESC="DESC",e.ASC="ASC",e}({});class Ni{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Indexer/",this.ping=e=>this.fetch(this.url("Ping"),Ai({},e)).then((e=>xi(e).then((e=>({status:e.status}))))),this.version=e=>this.fetch(this.url("Version"),Ai({},e)).then((e=>xi(e).then((e=>({version:e.version}))))),this.runtimeStatus=e=>this.fetch(this.url("RuntimeStatus"),Ai({},e)).then((e=>xi(e).then((e=>({status:e.status}))))),this.getChainID=e=>this.fetch(this.url("GetChainID"),Ai({},e)).then((e=>xi(e).then((e=>({chainID:e.chainID}))))),this.getEtherBalance=(e,t)=>this.fetch(this.url("GetEtherBalance"),Ai(e,t)).then((e=>xi(e).then((e=>({balance:e.balance}))))),this.getTokenBalances=(e,t)=>this.fetch(this.url("GetTokenBalances"),Ai(e,t)).then((e=>xi(e).then((e=>({page:e.page,balances:e.balances}))))),this.getTokenSupplies=(e,t)=>this.fetch(this.url("GetTokenSupplies"),Ai(e,t)).then((e=>xi(e).then((e=>({page:e.page,contractType:e.contractType,tokenIDs:e.tokenIDs}))))),this.getTokenSuppliesMap=(e,t)=>this.fetch(this.url("GetTokenSuppliesMap"),Ai(e,t)).then((e=>xi(e).then((e=>({supplies:e.supplies}))))),this.getBalanceUpdates=(e,t)=>this.fetch(this.url("GetBalanceUpdates"),Ai(e,t)).then((e=>xi(e).then((e=>({page:e.page,balances:e.balances}))))),this.getTransactionHistory=(e,t)=>this.fetch(this.url("GetTransactionHistory"),Ai(e,t)).then((e=>xi(e).then((e=>({page:e.page,transactions:e.transactions}))))),this.syncBalance=(e,t)=>this.fetch(this.url("SyncBalance"),Ai(e,t)).then((e=>xi(e).then((e=>({}))))),this.fetchTransactionReceipt=(e,t)=>this.fetch(this.url("FetchTransactionReceipt"),Ai(e,t)).then((e=>xi(e).then((e=>({receipt:e.receipt}))))),this.fetchTransactionReceiptWithFilter=(e,t)=>this.fetch(this.url("FetchTransactionReceiptWithFilter"),Ai(e,t)).then((e=>xi(e).then((e=>({receipt:e.receipt}))))),this.getAllWebhookListeners=(e,t)=>this.fetch(this.url("GetAllWebhookListeners"),Ai(e,t)).then((e=>xi(e).then((e=>({listeners:e.listeners}))))),this.getWebhookListener=(e,t)=>this.fetch(this.url("GetWebhookListener"),Ai(e,t)).then((e=>xi(e).then((e=>({listener:e.listener}))))),this.addWebhookListener=(e,t)=>this.fetch(this.url("AddWebhookListener"),Ai(e,t)).then((e=>xi(e).then((e=>({status:e.status,listener:e.listener}))))),this.updateWebhookListener=(e,t)=>this.fetch(this.url("UpdateWebhookListener"),Ai(e,t)).then((e=>xi(e).then((e=>({status:e.status}))))),this.removeWebhookListener=(e,t)=>this.fetch(this.url("RemoveWebhookListener"),Ai(e,t)).then((e=>xi(e).then((e=>({status:e.status}))))),this.hostname=e,this.fetch=(e,s)=>t(e,s)}url(e){return this.hostname+this.path+e}}const Ai=(e={},t={})=>({method:"POST",headers:a({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}),xi=e=>e.text().then((t=>{let s;try{s=JSON.parse(t)}catch(s){throw{code:"unknown",msg:`expecting JSON, got: ${t}`,status:e.status}}if(!e.ok)throw s;return s})),Pi="object"==typeof global?global.fetch:window.fetch;class Mi extends Ni{constructor(e,t,s){super(e.endsWith("/")?e.slice(0,-1):e,Pi),this.projectAccessKey=t,this.jwtAuth=s,this._fetch=(e,t)=>{const s={},n=this.jwtAuth,i=this.projectAccessKey;return n&&n.length>0&&(s.Authorization=`BEARER ${n}`),i&&i.length>0&&(s["X-Access-Key"]=i),t.headers=a({},t.headers,s),Pi(e,t)},this.fetch=this._fetch}}let Ri=function(e){return e.UNKNOWN="UNKNOWN",e.ERC20="ERC20",e.ERC721="ERC721",e.ERC1155="ERC1155",e}({}),Li=function(e){return e.INT="INT",e.STRING="STRING",e.ARRAY="ARRAY",e.GENERIC="GENERIC",e}({}),Di=function(e){return e.UNKNOWN="UNKNOWN",e.BUY="BUY",e.SELL="SELL",e}({}),Bi=function(e){return e.DESC="DESC",e.ASC="ASC",e}({}),Ui=function(e){return e.PENDING="PENDING",e.PAUSED="PAUSED",e.FAILED="FAILED",e.COMPLETED="COMPLETED",e.DISABLED="DISABLED",e}({});class Hi{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Metadata/",this.ping=e=>this.fetch(this.url("Ping"),ji({},e)).then((e=>Wi(e).then((e=>({status:e.status}))))),this.version=e=>this.fetch(this.url("Version"),ji({},e)).then((e=>Wi(e).then((e=>({version:e.version}))))),this.runtimeStatus=e=>this.fetch(this.url("RuntimeStatus"),ji({},e)).then((e=>Wi(e).then((e=>({status:e.status}))))),this.getTokenMetadata=(e,t)=>this.fetch(this.url("GetTokenMetadata"),ji(e,t)).then((e=>Wi(e).then((e=>({tokenMetadata:e.tokenMetadata}))))),this.enqueueTokensForRefresh=(e,t)=>this.fetch(this.url("EnqueueTokensForRefresh"),ji(e,t)).then((e=>Wi(e).then((e=>({taskId:e.taskId}))))),this.getTokenRefreshStatus=(e,t)=>this.fetch(this.url("GetTokenRefreshStatus"),ji(e,t)).then((e=>Wi(e).then((e=>({status:e.status}))))),this.getTokenRefreshResult=(e,t)=>this.fetch(this.url("GetTokenRefreshResult"),ji(e,t)).then((e=>Wi(e).then((e=>({status:e.status,tokens:e.tokens,failureReasons:e.failureReasons}))))),this.cancelRefreshJob=(e,t)=>this.fetch(this.url("CancelRefreshJob"),ji(e,t)).then((e=>Wi(e).then((e=>({ok:e.ok}))))),this.getTokenMetadataBatch=(e,t)=>this.fetch(this.url("GetTokenMetadataBatch"),ji(e,t)).then((e=>Wi(e).then((e=>({contractTokenMetadata:e.contractTokenMetadata}))))),this.searchTokenMetadata=(e,t)=>this.fetch(this.url("SearchTokenMetadata"),ji(e,t)).then((e=>Wi(e).then((e=>({page:e.page,tokenMetadata:e.tokenMetadata}))))),this.searchTokenIDs=(e,t)=>this.fetch(this.url("SearchTokenIDs"),ji(e,t)).then((e=>Wi(e).then((e=>({page:e.page,tokenIds:e.tokenIds}))))),this.tokenCollectionFilters=(e,t)=>this.fetch(this.url("TokenCollectionFilters"),ji(e,t)).then((e=>Wi(e).then((e=>({filters:e.filters}))))),this.getContractInfo=(e,t)=>this.fetch(this.url("GetContractInfo"),ji(e,t)).then((e=>Wi(e).then((e=>({contractInfo:e.contractInfo}))))),this.getContractInfoBatch=(e,t)=>this.fetch(this.url("GetContractInfoBatch"),ji(e,t)).then((e=>Wi(e).then((e=>({contractInfoMap:e.contractInfoMap}))))),this.searchContractInfo=(e,t)=>this.fetch(this.url("SearchContractInfo"),ji(e,t)).then((e=>Wi(e).then((e=>({contractInfoList:e.contractInfoList}))))),this.searchContractInfoBatch=(e,t)=>this.fetch(this.url("SearchContractInfoBatch"),ji(e,t)).then((e=>Wi(e).then((e=>({contractInfoByChain:e.contractInfoByChain}))))),this.searchMetadata=(e,t)=>this.fetch(this.url("SearchMetadata"),ji(e,t)).then((e=>Wi(e).then((e=>({tokenMetadata:e.tokenMetadata,contractInfo:e.contractInfo}))))),this.projectSetTokenMetadata=(e,t)=>this.fetch(this.url("ProjectSetTokenMetadata"),ji(e,t)).then((e=>Wi(e).then((e=>({ok:e.ok}))))),this.getNiftyswapTokenQuantity=(e,t)=>this.fetch(this.url("GetNiftyswapTokenQuantity"),ji(e,t)).then((e=>Wi(e).then((e=>({quantity:e.quantity}))))),this.getNiftyswapUnitPrices=(e,t)=>this.fetch(this.url("GetNiftyswapUnitPrices"),ji(e,t)).then((e=>Wi(e).then((e=>({prices:e.prices}))))),this.getNiftyswapUnitPricesWithQuantities=(e,t)=>this.fetch(this.url("GetNiftyswapUnitPricesWithQuantities"),ji(e,t)).then((e=>Wi(e).then((e=>({prices:e.prices}))))),this.addContractToMintMonitor=(e,t)=>this.fetch(this.url("AddContractToMintMonitor"),ji(e,t)).then((e=>Wi(e).then((e=>({ok:e.ok}))))),this.removeContractFromMintMonitor=(e,t)=>this.fetch(this.url("RemoveContractFromMintMonitor"),ji(e,t)).then((e=>Wi(e).then((e=>({ok:e.ok}))))),this.mintMonitorJobStatus=(e,t)=>this.fetch(this.url("MintMonitorJobStatus"),ji(e,t)).then((e=>Wi(e).then((e=>({task:e.task}))))),this.mintMonitorTriggerJob=(e,t)=>this.fetch(this.url("MintMonitorTriggerJob"),ji(e,t)).then((e=>Wi(e).then((e=>({ok:e.ok}))))),this.hostname=e,this.fetch=(e,s)=>t(e,s)}url(e){return this.hostname+this.path+e}}const ji=(e={},t={})=>({method:"POST",headers:a({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}),Wi=e=>e.text().then((t=>{let s;try{s=JSON.parse(t)}catch(s){throw{code:"unknown",msg:`expecting JSON, got: ${t}`,status:e.status}}if(!e.ok)throw s;return s})),qi="object"==typeof global?global.fetch:window.fetch;class $i extends Hi{constructor(e="https://metadata.sequence.app",t,s){super(e.endsWith("/")?e.slice(0,-1):e,qi),this.projectAccessKey=t,this.jwtAuth=s,this._fetch=(e,t)=>{const s={},n=this.jwtAuth,i=this.projectAccessKey;return n&&n.length>0&&(s.Authorization=`BEARER ${n}`),i&&i.length>0&&(s["X-Access-Key"]=i),t.headers=a({},t.headers,s),qi(e,t)},this.fetch=this._fetch}}const Fi=604800;class Gi{constructor(e,t,s={},n){this.account=e,this.settings=t,this.status=s,this._initialAuthRequest=void 0,this.proofStrings=new Map,this.onAuthCallbacks=[],this.apiClient=void 0,this.metadataClient=void 0,this.indexerClients=new Map,this.projectAccessKey=void 0,this.projectAccessKey=n}now(){return Math.floor(Date.now()/1e3)}get expiration(){var e;return Math.max(null!=(e=this.settings.metadata.expiration)?e:Fi,120)}onAuth(e){return this.onAuthCallbacks.push(e),()=>this.onAuthCallbacks=this.onAuthCallbacks.filter((t=>t!==e))}async dump(){return this.status.jwt?{jwt:{token:await this.status.jwt.token,expiration:this.status.jwt.expiration},metadata:this.status.metadata}:{metadata:this.settings.metadata}}auth(e=5){var t=this;return this._initialAuthRequest||(this._initialAuthRequest=async function(){const s=t.settings.sequenceApiUrl;if(!s)throw Error("No sequence api url");let n;for(let s=1;;s++)try{n=(await t.getJWT(!0)).token;break}catch(t){if(s===e)throw console.error(`couldn't authenticate after ${e} attempts`,t),t}return new g(s,void 0,n)}()),this._initialAuthRequest}async getJWT(e){var t=this;const s=this.settings.sequenceApiUrl;if(!s)throw Error("No sequence api url");if(this.status.jwt){const e=this.status.jwt,t=await e.token;if(this.now()<e.expiration)return{token:t,expiration:e.expiration};this.status.jwt=void 0}if(!e)throw new Error("no auth token in memory");const n=this.getProofStringKey(),{proofString:i,expiration:r}=this.getProofString(n),a={token:i.then((async function(e){const i=new g(s),r=await i.getAuthToken({ewtString:e});if(!0===(null==r?void 0:r.status)&&0!==r.jwtToken.length)return r.jwtToken;throw await t.isProofStringValid(e)||t.proofStrings.delete(n),new Error("no auth token from server")})).catch((e=>{throw this.status.jwt=void 0,e})),expiration:r};this.status.jwt=a,a.token.then((e=>{this.onAuthCallbacks.forEach((t=>{try{t({status:"fulfilled",value:e})}catch(e){}}))})).catch((e=>{this.onAuthCallbacks.forEach((t=>{try{t({status:"rejected",reason:e})}catch(e){}}))}));return{token:await a.token,expiration:r}}getProofStringKey(){return`${this.account.address} - ${this.settings.metadata.name}`}async isProofStringValid(e){try{const s=new ie,n=t.ethers.BigNumber.from(this.settings.sequenceApiChainId),i=ue(this.account.networks,n);if(!i)throw Error("No network found");return s.chainId=n.toNumber(),s.provider=new t.ethers.providers.StaticJsonRpcProvider(Te(i.rpcUrl,this.projectAccessKey),{name:"",chainId:n.toNumber()}),await s.decodeProof(e),!0}catch(e){return!1}}async getAPIClient(e=!0){if(!this.apiClient){const t=this.settings.sequenceApiUrl;if(!t)throw Error("No sequence api url");const s=(await this.getJWT(e)).token;this.apiClient=new g(t,void 0,s)}return this.apiClient}async getMetadataClient(e=!0){if(!this.metadataClient){const t=(await this.getJWT(e)).token;this.metadataClient=new $i(this.settings.sequenceMetadataUrl,void 0,t)}return this.metadataClient}async getIndexerClient(e,t=!0){const s=ue(this.account.networks,e);if(!s)throw Error(`No network for chain ${e}`);if(!this.indexerClients.has(s.chainId))if(s.indexer)this.indexerClients.set(s.chainId,s.indexer);else{if(!s.indexerUrl)throw Error(`No indexer url for chain ${e}`);{const e=(await this.getJWT(t)).token;this.indexerClients.set(s.chainId,new Mi(s.indexerUrl,void 0,e))}}return this.indexerClients.get(s.chainId)}getProofString(e){if(this.proofStrings.has(e)){const t=this.proofStrings.get(e);if(this.now()<t.expiration)return t;this.proofStrings.delete(e)}const s=new Y({address:this.account.address});s.claims.app=this.settings.metadata.name,s.claims.ogn=window.location.origin,s.setExpiryIn(this.expiration);const n=new ie,i=t.ethers.BigNumber.from(this.settings.sequenceApiChainId),r=ue(this.account.networks,i);if(!r)throw Error("No network found");n.chainId=i.toNumber(),n.provider=new t.ethers.providers.StaticJsonRpcProvider(Te(r.rpcUrl,this.projectAccessKey),{name:"",chainId:i.toNumber()});const a=this.now()+this.expiration-60,o={proofString:Promise.resolve(this.account.signDigest(s.messageDigest(),this.settings.sequenceApiChainId,!0,"eip6492")).then((e=>(s.signature=e,n.encodeProof(s,!0)))).catch((t=>{throw this.proofStrings.delete(e),t})),expiration:a};return this.proofStrings.set(e,o),o}}const Vi=async(e,s,n)=>{const i=t.ethers.utils.getAddress(await e.getAddress());if(!i||""===i||"0x"===i)throw Ji;const r=new Y;if(r.address=i,!n||!n.app||""===n.app)throw new Ki("authorization options requires app to be set");r.claims.app=n.app,r.claims.ogn=n.origin,r.claims.n=n.nonce,r.setExpiryIn(n.expiry?Math.max(n.expiry,200):Fi);const a=r.messageTypedData(),o=Ge(s);r.signature=await(e instanceof Ii?e.signTypedData(a.domain,a.types,a.message,o,"eip6492"):e.signTypedData(a.domain,a.types,a.message,o));const c=new ie;return{typedData:a,proofString:await c.encodeProof(r,!0)}};class Ki extends Error{constructor(e){super(e),this.name="AuthError"}}const Ji=new Ki("auth error: account address is empty");var zi=Object.freeze({__proto__:null,ConfigTracker:class{constructor(){this.loadPresignedConfiguration=void 0,this.savePresignedConfiguration=void 0,this.saveWitnesses=void 0,this.configOfImageHash=void 0,this.saveWalletConfig=void 0,this.imageHashOfCounterfactualWallet=void 0,this.saveCounterfactualWallet=void 0,this.walletsOfSigner=void 0}}});function Yi(e,t=""){if(void 0===e)console.debug(t+"undefined");else JSON.stringify(e,void 0,2).split("\n").map((e=>t+e)).forEach((e=>console.debug(e)));return e}var Zi=Object.freeze({__proto__:null,DebugConfigTracker:class{constructor(e){this.tracker=e}async loadPresignedConfiguration(e){return console.debug("? loadPresignedConfiguration"),Yi(e,"? "),Yi(await this.tracker.loadPresignedConfiguration(e),"! ")}savePresignedConfiguration(e){return console.debug("? savePresignedConfiguration"),Yi(e,"? "),this.tracker.savePresignedConfiguration(e)}saveWitnesses(e){return console.debug("? saveWitnesses"),Yi(e,"? "),this.tracker.saveWitnesses(e)}async configOfImageHash(e){return console.debug("? configOfImageHash"),Yi(e,"? "),Yi(await this.tracker.configOfImageHash(e),"! ")}saveWalletConfig(e){return console.debug("? saveWalletConfig"),Yi(e,"? "),this.tracker.saveWalletConfig(e)}async imageHashOfCounterfactualWallet(e){return console.debug("? imageHashOfCounterfactualWallet"),Yi(e,"? "),Yi(await this.tracker.imageHashOfCounterfactualWallet(e),"! ")}saveCounterfactualWallet(e){return console.debug("? saveCounterfactualWallet"),Yi(e,"? "),this.tracker.saveCounterfactualWallet(e)}async walletsOfSigner(e){return console.debug("? walletsOfSigner"),Yi(e,"? "),Yi(await this.tracker.walletsOfSigner(e),"! ")}async getMigration(e,t,s,n){return console.debug("? getMigration"),Yi({address:e,fromImageHash:t,fromVersion:s,chainId:n},"? "),Yi(await this.tracker.getMigration(e,t,s,n),"! ")}saveMigration(e,t,s){return console.debug("? saveMigration"),Yi({address:e,signed:t,contexts:s},"? "),this.tracker.saveMigration(e,t,s)}}});class Qi{constructor(e,t,s=1e3){this.provider=e,this.solver=t,this.window=s,this.pending=new Map}async runByEIP5719(e,t,s){const n=`${e}-${t}-${s}`,i=Date.now();if(this.pending.has(n)&&i-this.pending.get(n).timestamp<this.window)return this.pending.get(n).promise;const r=Xi(e,this.provider,t,s,this.solver);return this.pending.set(n,{timestamp:i,promise:r}),r}}async function Xi(e,s,n,i,r,a=0){if(a>10)throw new Error("EIP5719 - Too many tries");if(vt(i)){const t=bt(n,i);if(t&&t.toLowerCase()===e.toLowerCase())return i}try{if(await It(e,n,i,s))return i}catch(e){}const o=await async function(e){try{return await e}catch(e){return}}(function(e,s){return new t.ethers.Contract(e,[{inputs:[{internalType:"bytes32",type:"bytes32"}],name:"getAlternativeSignature",outputs:[{internalType:"string",type:"string"}],stateMutability:"view",type:"function"}],s)}(e,s).getAlternativeSignature(n));if(!o||""===o)throw new Error("EIP5719 - Invalid signature and no alternative signature");const c=t.ethers.utils.hexlify(await(r||new er).resolve(o));if(!c||""===c)throw new Error("EIP5719 - Empty alternative signature");if(c===t.ethers.utils.hexlify(i))throw new Error("EIP5719 - Alternative signature is invalid or the same");return Xi(e,s,n,c,r,a+1)}class er{constructor(e="https://cloudflare-ipfs.com/ipfs/"){var t=this;this.gateway=e,this.uri=e=>function(e){return e.startsWith("ipfs://")}(e)?function(e,t){const s=e.replace("ipfs://ipfs/","").replace("ipfs://","");return e.startsWith("ipfs://")?`${t}${s}`:e}(e,this.gateway):e,this.resolve=async function(e){const s=t.uri(e),n=await fetch(s);if(!n.ok)throw new Error(`URISolverIPFS - Failed to fetch ${s}`);return await n.text()}}}class tr{constructor(){this.configs={},this.v2Nodes={},this.counterfactualWallets={},this.payloads={},this.signatures={},this.migrations={},this.loadConfig=e=>Promise.resolve(this.configs[e]),this.saveConfig=(e,t)=>(this.configs[e]=t,Promise.resolve()),this.loadV2Node=e=>Promise.resolve(this.v2Nodes[e]),this.saveV2Node=(e,t)=>(this.v2Nodes[e]=t,Promise.resolve()),this.loadCounterfactualWallet=e=>Promise.resolve(this.counterfactualWallets[e]),this.saveCounterfactualWallet=(e,t,s)=>(this.counterfactualWallets[e]={imageHash:t,context:s},Promise.resolve()),this.loadPayloadOfSubdigest=e=>Promise.resolve(this.payloads[e]),this.savePayloadOfSubdigest=(e,t)=>(this.payloads[e]=t,Promise.resolve()),this.loadSubdigestsOfSigner=e=>Promise.resolve(Object.keys(this.signatures[e]||{})),this.loadSignatureOfSubdigest=(e,t)=>{var s;return Promise.resolve(null==(s=this.signatures[e])?void 0:s[t])},this.saveSignatureOfSubdigest=(e,t,s)=>(this.signatures[e]||(this.signatures[e]={}),this.signatures[e][t]=s,Promise.resolve()),this.loadMigrationsSubdigest=(e,t,s)=>{var n;return Promise.resolve((null==(n=this.migrations[e])||null==(n=n[t])?void 0:n[s])||[])},this.saveMigrationsSubdigest=(e,t,s,n,i)=>(this.migrations[e]||(this.migrations[e]={}),this.migrations[e][t]||(this.migrations[e][t]={}),this.migrations[e][t][s]||(this.migrations[e][t][s]=[]),this.migrations[e][t][s].push({subdigest:n,toImageHash:i}),Promise.resolve())}}const sr=(e,t)=>t.some((t=>e instanceof t));let nr,ir;const rr=new WeakMap,ar=new WeakMap,or=new WeakMap,cr=new WeakMap,hr=new WeakMap;let lr={get(e,t,s){if(e instanceof IDBTransaction){if("done"===t)return ar.get(e);if("objectStoreNames"===t)return e.objectStoreNames||or.get(e);if("store"===t)return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return fr(e[t])},set:(e,t,s)=>(e[t]=s,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function dr(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(ir||(ir=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(gr(this),t),fr(rr.get(this))}:function(...t){return fr(e.apply(gr(this),t))}:function(t,...s){const n=e.call(gr(this),t,...s);return or.set(n,t.sort?t.sort():[t]),fr(n)}}function ur(e){return"function"==typeof e?dr(e):(e instanceof IDBTransaction&&function(e){if(ar.has(e))return;const t=new Promise(((t,s)=>{const n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",r),e.removeEventListener("abort",r)},i=()=>{t(),n()},r=()=>{s(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",r),e.addEventListener("abort",r)}));ar.set(e,t)}(e),sr(e,nr||(nr=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,lr):e)}function fr(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,s)=>{const n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",r)},i=()=>{t(fr(e.result)),n()},r=()=>{s(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",r)}));return t.then((t=>{t instanceof IDBCursor&&rr.set(t,e)})).catch((()=>{})),hr.set(t,e),t}(e);if(cr.has(e))return cr.get(e);const t=ur(e);return t!==e&&(cr.set(e,t),hr.set(t,e)),t}const gr=e=>hr.get(e);const pr=["get","getKey","getAll","getAllKeys","count"],mr=["put","add","delete","clear"],yr=new Map;function wr(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(yr.get(t))return yr.get(t);const s=t.replace(/FromIndex$/,""),n=t!==s,i=mr.includes(s);if(!(s in(n?IDBIndex:IDBObjectStore).prototype)||!i&&!pr.includes(s))return;const r=async function(e,...t){const r=this.transaction(e,i?"readwrite":"readonly");let a=r.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[s](...t),i&&r.done]))[0]};return yr.set(t,r),r}function vr(e){if(void 0===e)return;const s={};for(const n of Object.keys(e)){const i=e[n];!0===i._isBigNumber&&void 0!==i._hex&&"string"==typeof i._hex&&""!==i._hex.length?s[n]=t.ethers.BigNumber.from(i):Array.isArray(i)?s[n]=i.map((e=>vr(e))):s[n]="object"==typeof i&&null!==i?vr(i):i}return s}lr=(e=>({...e,get:(t,s,n)=>wr(t,s)||e.get(t,s,n),has:(t,s)=>!!wr(t,s)||e.has(t,s)}))(lr);function br(e){return void 0!==e.left&&void 0!==e.right}function Ir(e){return void 0!==e.weight&&void 0!==e.threshold&&void 0!==e.tree}function Er(e){return 2===e.version&&void 0!==e.threshold&&void 0!==e.checkpoint&&void 0!==e.tree&&"string"==typeof e.tree}var Cr=Object.freeze({__proto__:null,isPlainNode:br,isPlainNested:Ir,isPlainV2Config:Er,MemoryTrackerStore:tr,recreateBigNumbers:vr,IndexedDBStore:class{constructor(e){var t=this;this.dbName=e,this._lazyDb=void 0,this.loadConfig=async function(e){return(await t.getDb()).get("configs",e).then((e=>vr(e)))},this.saveConfig=async function(e,s){const n=await t.getDb();await n.put("configs",s,e)},this.loadV2Node=async function(e){return(await t.getDb()).get("v2Nodes",e).then((e=>vr(e)))},this.saveV2Node=async function(e,s){const n=await t.getDb();await n.put("v2Nodes",s,e)},this.loadCounterfactualWallet=async function(e){return(await t.getDb()).get("counterfactualWallets",e)},this.saveCounterfactualWallet=async function(e,s,n){const i=await t.getDb();await i.put("counterfactualWallets",{imageHash:s,context:n},e)},this.loadPayloadOfSubdigest=async function(e){return(await t.getDb()).get("payloads",e).then((e=>vr(e)))},this.savePayloadOfSubdigest=async function(e,s){const n=await t.getDb();await n.put("payloads",s,e)},this.loadSubdigestsOfSigner=async function(e){const s=await t.getDb();return(await s.getAllKeysFromIndex("signatures","signer",IDBKeyRange.only(e))).map((e=>e.split("-")[0]))},this.loadSignatureOfSubdigest=async function(e,s){const n=await t.getDb(),i=await n.get("signatures",[s,e].join("-"));return null==i?void 0:i.signature},this.saveSignatureOfSubdigest=async function(e,s,n){const i=await t.getDb();await i.put("signatures",{signature:n,signer:e},[s,e].join("-"))},this.loadMigrationsSubdigest=async function(e,s,n){const i=await t.getDb();return(await i.getAllFromIndex("migrations","jump",IDBKeyRange.only([e,s,n]))).map((e=>({subdigest:e.subdigest,toImageHash:e.toImageHash})))},this.saveMigrationsSubdigest=async function(e,s,n,i,r){const a=await t.getDb();await a.put("migrations",{wallet:e,fromVersion:s,toVersion:n,subdigest:i,toImageHash:r},i)}}async getDb(){if(this._lazyDb)return this._lazyDb;const e=this.dbName;return this._lazyDb=await function(e,t,{blocked:s,upgrade:n,blocking:i,terminated:r}={}){const a=indexedDB.open(e,t),o=fr(a);return n&&a.addEventListener("upgradeneeded",(e=>{n(fr(a.result),e.oldVersion,e.newVersion,fr(a.transaction),e)})),s&&a.addEventListener("blocked",(e=>s(e.oldVersion,e.newVersion,e))),o.then((e=>{r&&e.addEventListener("close",(()=>r())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),o}(e,1,{upgrade(t,s,n,i){if(console.log(`upgrading ${e} from ${s} to ${n} - ${i}`),0===s){t.createObjectStore("configs"),t.createObjectStore("v2Nodes"),t.createObjectStore("counterfactualWallets"),t.createObjectStore("payloads");t.createObjectStore("signatures").createIndex("signer","signer",{unique:!1});t.createObjectStore("migrations").createIndex("jump",["wallet","fromVersion","toVersion"])}}}),this._lazyDb}}});class Sr{constructor(e,s=new tr,n=!1){var i=this;this.provider=e,this.store=s,this.useEIP5719=n,this.cachedEIP5719=void 0,this.loadTopology=async function(e){const s=await i.store.loadV2Node(e);if(!s)return{nodeHash:e};if(br(s)){const[e,t]=await Promise.all([i.loadTopology(s.left),i.loadTopology(s.right)]);return{left:e,right:t}}return Ir(s)?{weight:t.ethers.BigNumber.from(s.weight),threshold:t.ethers.BigNumber.from(s.threshold),tree:await i.loadTopology(s.tree)}:s},this.saveTopology=async function(e){if(Ts(e))return;const s=Ps(e);if(Os(e)){const t=i.saveTopology(e.left),n=i.saveTopology(e.right),r=i.store.saveV2Node(s,{left:Ps(e.left),right:Ps(e.right)});await Promise.all([t,n,r])}else{if(!ks(e)){if(Is(e))return i.store.saveV2Node(s,{address:e.address,weight:e.weight});if(Es(e))return i.store.saveV2Node(s,{subdigest:e.subdigest});throw new Error(`Unknown topology type: ${e}`)}{const n=i.saveTopology(e.tree),r=i.store.saveV2Node(s,{weight:t.ethers.BigNumber.from(e.weight).toString(),threshold:t.ethers.BigNumber.from(e.threshold).toString(),tree:Ps(e.tree)});await Promise.all([n,r])}}},this.saveWalletConfig=async function(e){const{config:t}=e;if(Rt.isWalletConfig(t)){const e=Rt.imageHashOf(t);return i.store.saveConfig(e,t)}if(Gs.isWalletConfig(t)){const e=Gs.imageHashOf(t);if(Fs(t.tree))return i.store.saveConfig(e,t)}},this.configOfImageHashCache={},this.configOfImageHash=async function(e){const{imageHash:s}=e;if(i.configOfImageHashCache[e.imageHash])return i.configOfImageHashCache[e.imageHash];const n=await i.store.loadConfig(s);if(n){if(1===n.version||2===n.version&&!Er(n))return i.configOfImageHashCache[e.imageHash]=n,n;if(Er(n)){const s={version:2,threshold:t.ethers.BigNumber.from(n.threshold),checkpoint:t.ethers.BigNumber.from(n.checkpoint),tree:await i.loadTopology(n.tree)};return i.configOfImageHashCache[e.imageHash]=s,s}throw new Error(`Unknown config type: ${n}`)}},this.saveCounterfactualWallet=async function(e){const{config:t,context:s}=e,n=Rn(t.version).config.imageHashOf(t);await Promise.all([i.saveWalletConfig({config:t}),...s.map((e=>{const t=Zs(e,n);return i.store.saveCounterfactualWallet(t,n,e)}))])},this.imageHashOfCounterfactualWallet=async function(e){const{wallet:t}=e,s=await i.store.loadCounterfactualWallet(t);if(s)return{imageHash:s.imageHash,context:s.context}},this.savePayload=async function(e){const{payload:t}=e,s=dt(t);await i.store.savePayloadOfSubdigest(s,t)},this.payloadOfSubdigestCache={},this.payloadOfSubdigest=async function(e){if(i.payloadOfSubdigestCache[e.subdigest])return i.payloadOfSubdigestCache[e.subdigest];const{subdigest:t}=e,s=await i.store.loadPayloadOfSubdigest(t);return s&&(i.payloadOfSubdigestCache[t]=s),s},this.savePresignedConfiguration=async function(e){const s=vs.decode(e.signature),n=jt(Rn(e.nextConfig.version).config.imageHashOf(e.nextConfig)),r=t.ethers.utils.keccak256(n),a={message:n,address:e.wallet,chainId:0,digest:r},o=i.savePayload({payload:a}),c=i.saveWalletConfig({config:e.nextConfig}),h=await vs.recover(s,a,i.provider),l=ps(h.config.tree);await Promise.all([o,c,i.saveWalletConfig({config:h.config}),...l.map((e=>i.store.saveSignatureOfSubdigest(e.address,h.subdigest,e.signature)))])},this.loadPresignedConfiguration=async function(e){const{wallet:s,fromImageHash:n,longestPath:r}=e,o=await i.configOfImageHash({imageHash:n});if(!o||!Gs.isWalletConfig(o))return[];const c=$s(o.tree).map((e=>e.address)),h=await Promise.all(c.map((e=>i.store.loadSubdigestsOfSigner(e)))),l=[...new Set(h.flat())],d=(await Promise.all([...new Set(l)].map((async function(e){return a({},await i.payloadOfSubdigest({subdigest:e}),{subdigest:e})})))).filter((e=>(null==e?void 0:e.message)&&(null==e?void 0:e.address)&&e.address===s)).map((e=>({payload:e,nextImageHash:Wt(e.message)}))).filter((e=>null==e?void 0:e.nextImageHash));let u;const f=(await Promise.all(d.map((async function({nextImageHash:e,payload:s}){const n=await i.configOfImageHash({imageHash:e});if(!n||!Ms(n))return;return{nextConfig:n,nextCheckpoint:t.ethers.BigNumber.from(n.checkpoint),nextImageHash:e,payload:s}})))).filter((e=>void 0!==e)).filter((e=>e.nextCheckpoint.gt(o.checkpoint))).sort(((e,t)=>e.nextCheckpoint.gt(t.nextCheckpoint)?r?1:-1:r?-1:1));for(const e of f){const{nextConfig:s,nextCheckpoint:n,nextImageHash:a,payload:h}=e;if(u){const e=u.checkpoint;if(r){if(n.gte(e))continue}else if(n.lte(e))continue}const l=new Map((await Promise.all(c.map((async function(e){const s=await i.store.loadSignatureOfSubdigest(e,h.subdigest);if(!s)return[e,void 0];const n=t.ethers.utils.hexlify(i.useEIP5719?await i.cachedEIP5719.runByEIP5719(e,h.subdigest,s):s);return[e,{isDynamic:Et(h.subdigest,n)!==e,signature:n}]})))).filter((e=>Boolean(e[1]))));if(0===l.size)continue;const d=vs.encodeSigners(o,l,[],0);d.weight.lt(o.threshold)||(u={nextImageHash:a,checkpoint:t.ethers.BigNumber.from(s.checkpoint),signature:d.encoded})}if(!u)return[];const g=await i.loadPresignedConfiguration({wallet:s,fromImageHash:u.nextImageHash,longestPath:r});return[{wallet:s,nextImageHash:u.nextImageHash,signature:u.signature},...g]},this.saveWitnesses=async function(e){const t={digest:e.digest,address:e.wallet,chainId:e.chainId},s=dt(t);await Promise.all([i.savePayload({payload:t}),...e.signatures.filter((e=>vt(e))).map((e=>{const t=bt(s,e);return i.store.saveSignatureOfSubdigest(t,s,e)}))])},this.walletsOfSigner=async function(e){const s=await i.store.loadSubdigestsOfSigner(e.signer),n=await Promise.all(s.map((e=>i.payloadOfSubdigest({subdigest:e})))).then((e=>e.filter((e=>void 0!==e)))),r=[];for(const s of n){const n=s.address;if(r.find((e=>e.wallet===n)))continue;const a=dt(s),o=await i.store.loadSignatureOfSubdigest(e.signer,a);o&&r.push({wallet:n,proof:{digest:s.digest,chainId:t.ethers.BigNumber.from(s.chainId),signature:t.ethers.utils.hexlify(o)}})}return r},this.cachedEIP5719=new Qi(e)}async saveMigration(e,s,n){const i=s.fromVersion;if(1!==i)throw new Error("Migration not supported");if(!Ms(s.toConfig))throw new Error("Invalid to config");const{newImageHash:r,address:a}=jn.decodeTransaction(s.tx,n);if(a!==e)throw new Error("Invalid migration transaction - address");if(Gs.imageHashOf(s.toConfig)!=r)throw new Error("Invalid migration transaction - config");const o=nn(s.tx.nonce,s.tx.transactions),c=t.ethers.utils.keccak256(o),h={chainId:s.tx.chainId,message:o,address:e,digest:c},l=dt(h),d=this.savePayload({payload:h}),u=this.saveWalletConfig({config:s.toConfig}),f=Pt.decode(s.tx.signature),g=await Pt.recover(f,h,this.provider),p=Pt.signaturesOf(g.config);await Promise.all([d,u,this.saveWalletConfig({config:g.config}),this.store.saveMigrationsSubdigest(e,i,i+1,l,r),...p.map((e=>this.store.saveSignatureOfSubdigest(e.address,g.subdigest,e.signature)))])}async getMigration(e,s,n,i){var r=this;const[a,o]=await Promise.all([this.configOfImageHash({imageHash:s}),this.store.loadMigrationsSubdigest(e,n,n+1)]),c=Mn(n);if(!a)return;if(!c.config.isWalletConfig(a))return;const h=await Promise.all(o.map((async function(s){const{subdigest:o,toImageHash:h}=s,l=await r.payloadOfSubdigest({subdigest:o});if(!l||!l.message)return;if(!t.ethers.BigNumber.from(i).eq(l.chainId))return;const d=c.config.signersOf(a).map((e=>e.address)),u=new Map((await Promise.all(d.map((async function(e){const s=await r.store.loadSignatureOfSubdigest(e,o);if(!s)return[e,void 0];const n=t.ethers.utils.hexlify(r.useEIP5719?await r.cachedEIP5719.runByEIP5719(e,o,s):s);return[e,{isDynamic:Et(o,n)!==e,signature:n}]})))).filter((e=>Boolean(e[1])))),f=c.signature.encodeSigners(a,u,[],i);if(!f||f.weight<a.threshold)return;const[g,p]=sn(l.message);return{tx:{entrypoint:e,transactions:fn(p),chainId:i,nonce:g,signature:f.encoded,intent:{id:o,wallet:e}},toConfig:await r.configOfImageHash({imageHash:h}),fromVersion:n,toVersion:n+1}}))).then((e=>e.filter((e=>void 0!==e))));return h[0]}updateProvider(e){this.provider=e}}var kr=Object.freeze({__proto__:null,LocalConfigTracker:Sr});let Tr=function(e){return e.EIP712="EIP712",e.EthSign="EthSign",e.EIP1271="EIP1271",e}({});class _r{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Sessions/",this.ping=e=>this.fetch(this.url("Ping"),Or({},e)).then((e=>Nr(e).then((e=>({}))))),this.config=(e,t)=>this.fetch(this.url("Config"),Or(e,t)).then((e=>Nr(e).then((e=>({version:e.version,config:e.config}))))),this.wallets=(e,t)=>this.fetch(this.url("Wallets"),Or(e,t)).then((e=>Nr(e).then((e=>({wallets:e.wallets}))))),this.deployHash=(e,t)=>this.fetch(this.url("DeployHash"),Or(e,t)).then((e=>Nr(e).then((e=>({deployHash:e.deployHash,context:e.context}))))),this.configUpdates=(e,t)=>this.fetch(this.url("ConfigUpdates"),Or(e,t)).then((e=>Nr(e).then((e=>({updates:e.updates}))))),this.migrations=(e,t)=>this.fetch(this.url("Migrations"),Or(e,t)).then((e=>Nr(e).then((e=>({migrations:e.migrations}))))),this.saveConfig=(e,t)=>this.fetch(this.url("SaveConfig"),Or(e,t)).then((e=>Nr(e).then((e=>({}))))),this.saveWallet=(e,t)=>this.fetch(this.url("SaveWallet"),Or(e,t)).then((e=>Nr(e).then((e=>({}))))),this.saveSignature=(e,t)=>this.fetch(this.url("SaveSignature"),Or(e,t)).then((e=>Nr(e).then((e=>({}))))),this.saveSignerSignatures=(e,t)=>this.fetch(this.url("SaveSignerSignatures"),Or(e,t)).then((e=>Nr(e).then((e=>({}))))),this.saveMigration=(e,t)=>this.fetch(this.url("SaveMigration"),Or(e,t)).then((e=>Nr(e).then((e=>({}))))),this.hostname=e,this.fetch=(e,s)=>t(e,s)}url(e){return this.hostname+this.path+e}}const Or=(e={},t={})=>({method:"POST",headers:a({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}),Nr=e=>e.text().then((t=>{let s;try{s=JSON.parse(t)}catch(s){throw{code:"unknown",msg:`expecting JSON, got: ${t}`,status:e.status}}if(!e.ok)throw s;return s}));class Ar{constructor(e,t=!0){this.onlyRecoverable=t,this.sessions=void 0,this.sessions=new _r(e,fetch)}async loadPresignedConfiguration(e){try{const{updates:t}=await this.sessions.configUpdates({wallet:e.wallet,fromImageHash:e.fromImageHash,allUpdates:e.longestPath});return t.map((({toImageHash:t,signature:s})=>({wallet:e.wallet,nextImageHash:t,signature:s})))}catch(e){if(Br(e))return[];throw e}}async savePresignedConfiguration(e){const s=e.nextConfig,n=hs(Rn(s.version).config.imageHashOf(s)),i=t.ethers.utils.keccak256(n);await this.sessions.saveSignature({wallet:e.wallet,digest:i,chainID:"0",signature:e.signature,toConfig:xr(s)})}async saveWitnesses(e){let t=e.signatures;this.onlyRecoverable&&(t=t.filter((e=>vt(e)))),await this.sessions.saveSignerSignatures({wallet:e.wallet,digest:e.digest,chainID:Dr(e.chainId),signatures:t})}async configOfImageHash(e){try{const{version:t,config:s}=await this.sessions.config(e);return function(e,t){switch(e){case 1:return a({},t,{version:e});case 2:return a({},t,{version:e,tree:Mr(t.tree)});default:throw new Error(`unknown version ${e}`)}}(t,s)}catch(e){if(Br(e))return;throw e}}async saveWalletConfig(e){const t=xr(e.config);await this.sessions.saveConfig({version:e.config.version,config:t})}async imageHashOfCounterfactualWallet(e){try{const{deployHash:t,context:s}=await this.sessions.deployHash(e);return{imageHash:t,context:s}}catch(e){if(Br(e))return;throw e}}async saveCounterfactualWallet(e){const t=xr(e.config);await this.sessions.saveWallet({version:e.config.version,deployConfig:t})}async walletsOfSigner(e){const{wallets:s}=await this.sessions.wallets(e);return Object.entries(s).map((([e,{digest:s,chainID:n,type:i,signature:r}])=>{switch(i){case Tr.EIP712:r+=t.ethers.utils.hexlify(wt.EIP712).slice(2);break;case Tr.EthSign:r+=t.ethers.utils.hexlify(wt.ETH_SIGN).slice(2);break;case Tr.EIP1271:r+=t.ethers.utils.hexlify(wt.WALLET_BYTES32).slice(2)}return{wallet:e,proof:{digest:s,signature:r,chainId:t.ethers.BigNumber.from(n)}}}))}async getMigration(e,t,s,n){var i=this;const r=Dr(n),{migrations:a}=await this.sessions.migrations({wallet:e,fromVersion:s,fromImageHash:t,chainID:r}),o=async function(t){const n=a[t];if(n){const r=Object.keys(n).map(Number).sort(((e,t)=>t-e));for(const a of r)for(const[r,o]of Object.entries(n[a]))try{const n=await i.configOfImageHash({imageHash:r});if(n)return{fromVersion:s,toVersion:a,toConfig:n,tx:{entrypoint:o.executor,transactions:o.transactions,nonce:o.nonce,signature:o.signature,chainId:t,intent:{id:an(e,t,o.nonce,o.transactions),wallet:e}}}}catch(e){console.error(e)}}},c=await o(r);if(c)return c;for(const e in a)if(e!==r){const t=await o(e);if(t)return t}}async saveMigration(e,t,s){await this.sessions.saveMigration({wallet:e,fromVersion:t.fromVersion,toVersion:t.toVersion,toConfig:xr(t.toConfig),executor:t.tx.entrypoint,transactions:t.tx.transactions.map(Rr),nonce:Dr(t.tx.nonce),signature:t.tx.signature,chainID:Dr(t.tx.chainId)})}}function xr(e){switch(e.version){case 1:if(Rt.isWalletConfig(e))return{threshold:Lr(e.threshold),signers:e.signers.map((({weight:e,address:t})=>({weight:Lr(e),address:t})))};throw new Error(`not a v${e.version} config: ${e}`);case 2:if(Gs.isWalletConfig(e))return{threshold:Lr(e.threshold),checkpoint:Lr(e.checkpoint),tree:Pr(e.tree)};throw new Error(`not a v${e.version} config: ${e}`);default:throw new Error(`unknown version ${e.version}`)}}function Pr(e){return Os(e)?{left:Pr(e.left),right:Pr(e.right)}:Is(e)?{weight:Lr(e.weight),address:e.address}:ks(e)?{weight:Lr(e.weight),threshold:Lr(e.threshold),tree:Pr(e.tree)}:Ts(e)?{node:e.nodeHash}:a({},e)}function Mr(e){if("object"==typeof e){const t=a({},e);return void 0!==t.left&&(t.left=Mr(t.left)),void 0!==t.right&&(t.right=Mr(t.right)),void 0!==t.tree&&(t.tree=Mr(t.tree)),void 0!==t.node&&(t.nodeHash=t.node,delete t.node),t}throw new Error(`v2 config tree ${e} is not an object`)}function Rr(e){return{to:e.to,value:void 0!==e.value?Dr(e.value):void 0,data:void 0!==e.data?t.ethers.utils.hexlify(e.data):void 0,gasLimit:void 0!==e.gasLimit?Dr(e.gasLimit):void 0,delegateCall:e.delegateCall,revertOnError:e.revertOnError}}function Lr(e){return t.ethers.BigNumber.from(e).toNumber()}function Dr(e){return t.ethers.BigNumber.from(e).toString()}function Br(e){return"object"==typeof e&&404===e.status}var Ur=Object.freeze({__proto__:null,RemoteConfigTracker:Ar});function Hr(e,t,s){return new Promise((n=>{let i=0;e.forEach((r=>r.then((r=>{s(r)?n(r):(i++,i===e.length&&n(t))})).catch((()=>{i++,i===e.length&&n(t)}))))}))}async function jr(e,t){return Promise.all(e.map((e=>e.catch((()=>t)))))}class Wr{constructor(){this.cache=void 0,this.cache=new Map}do(e,s,n,...i){e=`${e}:${t.ethers.utils.keccak256(t.ethers.utils.toUtf8Bytes(JSON.stringify(i,qr)))}`;let r=this.cache.get(e);if(r&&r.expiration&&new Date>=r.expiration&&(r=void 0,this.cache.delete(e)),!r){const t={promise:n(...i)};void 0!==s&&(t.promise=t.promise.then((e=>(t.expiration=new Date(Date.now()+s),e)))),r=t,this.cache.set(e,r)}return r.promise}}function qr(e,t){return"object"!=typeof t||null===t||Array.isArray(t)?t:Object.fromEntries(Object.entries(t).sort())}function $r(e){return e instanceof Fr}class Fr{constructor(e,t=50,s=!1){this.tracker=e,this.window=t,this.verbose=s,this.cache=new Wr}invalidateCache(){this.cache=new Wr}configOfImageHash(e){return this.cache.do("configOfImageHash",this.window,(e=>this.tracker.configOfImageHash(e)),e)}getMigration(e,t,s,n){return this.cache.do("getMigration",this.window,((...e)=>this.tracker.getMigration(...e)),e,t,s,n)}saveMigration(e,t,s){return this.cache.do("saveMigration",void 0,((...e)=>this.tracker.saveMigration(...e)),e,t,s)}loadPresignedConfiguration(e){return this.cache.do("loadPresignedConfiguration",this.window,(e=>this.tracker.loadPresignedConfiguration(e)),e)}savePresignedConfiguration(e){return this.cache.do("savePresignedConfiguration",void 0,(e=>this.tracker.savePresignedConfiguration(e)),e)}saveWitnesses(e){return this.cache.do("saveWitnesses",void 0,(e=>this.tracker.saveWitnesses(e)),e)}saveWalletConfig(e){return this.cache.do("saveWalletConfig",void 0,(e=>this.tracker.saveWalletConfig(e)),e)}imageHashOfCounterfactualWallet(e){return this.cache.do("imageHashOfCounterfactualWallet",void 0,(e=>this.tracker.imageHashOfCounterfactualWallet(e)),e)}saveCounterfactualWallet(e){return this.cache.do("saveCounterfactualWallet",void 0,(e=>this.tracker.saveCounterfactualWallet(e)),e)}walletsOfSigner(e){return this.cache.do("walletsOfSigner",this.window,(e=>this.tracker.walletsOfSigner(e)),e)}updateProvider(e){this.tracker instanceof Sr&&this.tracker.updateProvider(e)}}var Gr=Object.freeze({__proto__:null,debug:Zi,local:kr,remote:Ur,stores:Cr,raceUntil:Hr,allSafe:jr,MultipleTracker:class{constructor(e){this.trackers=e}async configOfImageHash(e){const t=this.trackers.map((async function(t,s){return{res:await t.configOfImageHash(e),i:s}})),s=await Hr(t,void 0,(e=>void 0!==(null==e?void 0:e.res)&&Rn(e.res.version).config.isComplete(e.res)));if(null!=s&&s.res)return this.saveWalletConfig({config:s.res,skipTracker:s.i}),s.res;const n=new Sr(void 0),i=await jr(t,void 0);for(const e of i)null!=e&&e.res&&await n.saveWalletConfig({config:e.res});const r=await n.configOfImageHash(e);return r&&this.saveWalletConfig({config:r}),r}async saveWalletConfig(e){await Promise.all(this.trackers.map(((t,s)=>{if(s!==e.skipTracker)return t.saveWalletConfig(e)})))}async imageHashOfCounterfactualWallet(e){const t=await Hr(this.trackers.map((t=>t.imageHashOfCounterfactualWallet(e))),void 0,(e=>Boolean(e)));return t&&this.configOfImageHash({imageHash:t.imageHash}).then((e=>{e&&this.saveCounterfactualWallet({config:e,context:[t.context]})})),t}async saveCounterfactualWallet(e){await Promise.all(this.trackers.map(((t,s)=>{if(s!==e.skipTracker)return t.saveCounterfactualWallet(e)})))}async walletsOfSigner(e){const t=await jr(this.trackers.map((t=>t.walletsOfSigner(e))),[]).then((e=>e.flat())),s={};for(const e of t)s[e.wallet]=e.proof;const n=Object.keys(s).map((e=>({wallet:e,proof:s[e]}))),i=new Map;return n.forEach((({wallet:e,proof:{digest:t,chainId:s,signature:n}})=>{const r=`${e}-${t}-${s}`;let a=i.get(r);a||(a={wallet:e,digest:t,chainId:s,signatures:[]},i.set(r,a)),a.signatures.push(n)})),i.forEach((e=>this.saveWitnesses(e))),n}async saveWitnesses(e){await Promise.all(this.trackers.map((t=>t.saveWitnesses(e))))}async loadPresignedConfiguration(e){var t=this;const s=await jr(this.trackers.map((t=>t.loadPresignedConfiguration(e))),[]),n=await jr(s.map((async function(e){const s=e[e.length-1],n=await t.configOfImageHash({imageHash:s.nextImageHash});if(n)return{checkpoint:Rn(n.version).config.checkpointOf(n),result:e}})),void 0),i=n.reduce(((e,t)=>t?e?t.checkpoint.gt(e.checkpoint)?t:e:t:e));if(!i)return[];const r=new Map,a=e=>(r.has(e)||r.set(e,this.configOfImageHash({imageHash:e})),r.get(e));return i.result.forEach((async function(s){const n=await a(s.nextImageHash);n&&t.savePresignedConfiguration({wallet:e.wallet,nextConfig:n,signature:s.signature})})),i.result}async savePresignedConfiguration(e){await Promise.all(this.trackers.map((t=>t.savePresignedConfiguration(e))))}async getMigration(e,t,s,n){return(await Promise.all(this.trackers.map((i=>i.getMigration(e,t,s,n))))).find((e=>!!e))}async saveMigration(e,t,s){await Promise.all(this.trackers.map((n=>n.saveMigration(e,t,s))))}},CachedTracker:class{constructor(e,t,s){this.tracker=e,this.cache=t,this.contexts=s}async loadPresignedConfiguration(e){var t=this;const s=[this.tracker.loadPresignedConfiguration(e),this.cache.loadPresignedConfiguration(e)];let n;const[i,r]=await Promise.all(s);if(i.length>0&&r.length>0&&i[i.length-1].nextImageHash===r[r.length-1].nextImageHash)n=!0===e.longestPath?i.length>r.length?i:r:i.length<r.length?i:r;else{var a,o;const e=await Promise.all(s.map((async function(e){const s=await e,n=s[s.length-1];if(!n)return;const i=await t.configOfImageHash({imageHash:n.nextImageHash});return i?{checkpoint:Rn(i.version).config.checkpointOf(i),result:s}:void 0})));n=null!=(a=null==(o=e.reduce(((e,t)=>t?e?t.checkpoint.gt(e.checkpoint)?t:e:t:e)))?void 0:o.result)?a:[]}return n||[]}async savePresignedConfiguration(e){await Promise.all([this.tracker.savePresignedConfiguration(e),this.cache.savePresignedConfiguration(e)])}async configOfImageHash(e){if(!0!==e.noCache){const t=await this.cache.configOfImageHash(e);if(t)return t}const t=await this.tracker.configOfImageHash(e);return t&&await this.cache.saveWalletConfig({config:t}),t}async saveWalletConfig(e){await Promise.all([this.tracker.saveWalletConfig(e),this.cache.saveWalletConfig(e)])}async imageHashOfCounterfactualWallet(e){if(!0!==e.noCache){const t=await this.cache.imageHashOfCounterfactualWallet(e);if(t)return t}const t=await this.tracker.imageHashOfCounterfactualWallet(e);if(t){const e=await this.configOfImageHash({imageHash:t.imageHash});e&&await this.cache.saveCounterfactualWallet({config:e,context:[t.context]})}return t}async saveCounterfactualWallet(e){await Promise.all([this.tracker.saveCounterfactualWallet(e),this.cache.saveCounterfactualWallet(e)])}async walletsOfSigner(e){if(e.noCache)return this.tracker.walletsOfSigner(e);const t=await Promise.all([this.tracker.walletsOfSigner(e),this.cache.walletsOfSigner(e)]),s=new Map;for(const e of t)for(const t of e)s.set(t.wallet,t);return Array.from(s.values())}async saveWitnesses(e){await Promise.all([this.tracker.saveWitnesses(e),this.cache.saveWitnesses(e)])}async getMigration(e,t,s,n){const i=await this.cache.getMigration(e,t,s,n);if(i)return i;const r=await this.tracker.getMigration(e,t,s,n);return r&&await this.cache.saveMigration(e,r,this.contexts),r}async saveMigration(e,t,s){await Promise.all([this.tracker.saveMigration(e,t,s),this.cache.saveMigration(e,t,s)])}},isDedupedTracker:$r,DedupedTracker:Fr});function Vr(e){return e.config&&e.metadata&&void 0===e.version}function Kr(e){return 2===e.version&&e.address}const Jr=[1,137],zr={contexts:Qs,networks:Ke,tracker:new Ar("https://sessions.sequence.app")};class Yr{constructor(e,t,s,n){this.networks=e,this.contexts=t,this.account=s,this.services=n}async dump(){const e={version:2,address:this.account.address};return this.services?a({},e,await this.services.dump()):e}static async singleSigner(e){let{signer:s}=e;"string"==typeof s&&(s=new t.ethers.Wallet(s));const n=new pi([s]),i=await s.getAddress(),r=[{weight:1,address:i}],o=e.selectWallet||async function(t){var s,n;if(0===t.length)return;const r=null!=(s=null==(n=e.settings)?void 0:n.tracker)?s:zr.tracker,a=await Promise.all(t.map((async function(e){const t=await r.imageHashOfCounterfactualWallet({wallet:e});return{wallet:e,config:t&&await r.configOfImageHash({imageHash:t.imageHash})}})));for(const e of a){if(!e.config)continue;const t=Rn(e.config.version).config.signersOf(e.config);if(1===t.length&&t[0].address===i)return e.wallet}};return Yr.open(a({},e,{orchestrator:n,referenceSigner:i,threshold:1,addSigners:r,selectWallet:o}))}static async open(e){var t,s,n,i,r;const{referenceSigner:o,threshold:c,addSigners:h,selectWallet:l,onAccountAddress:d,settings:u,editConfigOnMigration:f,onMigration:g,orchestrator:p,projectAccessKey:m}=e,{contexts:y,networks:w,tracker:v,services:b}=a({},zr,u),I=null!=(t=null==(s=ue(w,null!=(n=null==u||null==(i=u.services)?void 0:i.sequenceApiChainId)?n:re.MAINNET))?void 0:s.chainId)?t:null==(r=w[0])?void 0:r.chainId;if(!I)throw Error("No reference chain found");const E=await v.walletsOfSigner({signer:o}),C=await l(E.map((e=>e.wallet)));let S,k;if(C){if(null==d||d(C),S=new Ii({address:C,tracker:v,networks:w,contexts:y,orchestrator:p,projectAccessKey:m}),h&&h.length>0){let e=await S.status(I);if(e.original.version!==e.version||S.version!==e.version){const{migratedAllChains:t,failedChains:s}=await S.isMigratedAllChains();if(s.some((e=>Jr.includes(e))))throw Error(`Failed to fetch account status on ${s.join(", ")}`);if(!t){if(g&&!await g(S))throw Error("Migration cancelled, cannot open session");const{failedChains:t}=await S.signAllMigrations(f||(e=>e));if(t.some((e=>Jr.includes(e))))throw Error(`Failed to sign migrations on ${t.join(", ")}`);let s;if($r(v)&&v.invalidateCache(),[s,e]=await Promise.all([S.isMigratedAllChains().then((e=>e.migratedAllChains)),S.status(I)]),!s)throw Error("Failed to migrate account")}}e.onChain.version!==e.version&&await S.doBootstrap(I,void 0,e);const t=e.config,s=S.coders.config.editConfig(t,{add:h,threshold:c});if(S.coders.config.imageHashOf(t)!==S.coders.config.imageHashOf(s)){const e=S.coders.config.editConfig(s,{checkpoint:S.coders.config.checkpointOf(t).add(1)});await S.updateConfig(e)}}}else{if(!h||0===h.length)throw Error("Cannot create new account without signers");if(!c)throw Error("Cannot create new account without threshold");S=await Ii.new({config:{threshold:c,checkpoint:0,signers:h},tracker:v,contexts:y,orchestrator:p,networks:w,projectAccessKey:m}),null==d||d(S.address),await S.publishWitness();if(!(await v.walletsOfSigner({signer:o,noCache:!0})).some((e=>e.wallet===S.address)))throw Error("Account not found on tracker")}return b&&(k=new Gi(S,b),k.auth(),k.onAuth((e=>{"fulfilled"===e.status&&S.setJwt(e.value)}))),new Yr(w,y,S,k)}static async load(e){const{dump:t,settings:s,editConfigOnMigration:n,onMigration:i,orchestrator:r}=e,{contexts:o,networks:c,tracker:h,services:l}=a({},zr,s);let d,u;if(Vr(t)){var f,g,p;const e=t.config.address||Zs(o[1],Rt.imageHashOf(a({},t.config,{version:1}))),s=(null!=(f=null==(g=t.jwt)?void 0:g.expiration)?f:0)<Math.floor(Date.now()/1e3);if(d=new Ii({address:e,tracker:h,networks:c,contexts:o,orchestrator:r,jwt:s||null==(p=t.jwt)?void 0:p.token}),!await d.isMigratedAllChains().then((e=>e.migratedAllChains))){if(i&&!await i(d))throw Error("Migration cancelled, cannot open session");if(console.log("Migrating account..."),await d.signAllMigrations(n),!await d.isMigratedAllChains().then((e=>e.migratedAllChains)))throw Error("Failed to migrate account")}}else{if(!Kr(t))throw Error("Invalid dump format");{var m,y,w;const e=(null!=(m=null==(y=t.jwt)?void 0:y.expiration)?m:0)<Math.floor(Date.now()/1e3);d=new Ii({address:t.address,tracker:h,networks:c,contexts:o,orchestrator:r,jwt:e||null==(w=t.jwt)?void 0:w.token})}}var v;l&&(u=new Gi(d,l,t.jwt&&{jwt:{token:Promise.resolve(t.jwt.token),expiration:null!=(v=t.jwt.expiration)?v:Ee(t.jwt.token).exp},metadata:t.metadata}));return new Yr(c,o,d,u)}}var Zr=Object.freeze({__proto__:null,signAuthorization:Vi,AuthError:Ki,ErrAccountIsRequired:Ji,isSessionDumpV1:Vr,isSessionDumpV2:Kr,CRITICAL_CHAINS:Jr,SessionSettingsDefault:zr,Session:Yr,ValidateSequenceWalletProof:(e,t,s)=>async(t,s,n)=>{const i=n.messageDigest();return{isValid:await e(s).isValidSignature(n.address,i,n.signature)}}});class Qr{constructor(e,t){this.hostname=void 0,this.fetch=void 0,this.path="/rpc/Guard/",this.ping=e=>this.fetch(this.url("Ping"),Xr({},e)).then((e=>ea(e).then((e=>({status:e.status}))))),this.version=e=>this.fetch(this.url("Version"),Xr({},e)).then((e=>ea(e).then((e=>({version:e.version}))))),this.runtimeStatus=e=>this.fetch(this.url("RuntimeStatus"),Xr({},e)).then((e=>ea(e).then((e=>({status:e.status}))))),this.getSignerConfig=(e,t)=>this.fetch(this.url("GetSignerConfig"),Xr(e,t)).then((e=>ea(e).then((e=>({signerConfig:e.signerConfig}))))),this.sign=(e,t)=>this.fetch(this.url("Sign"),Xr(e,t)).then((e=>ea(e).then((e=>({sig:e.sig}))))),this.signWith=(e,t)=>this.fetch(this.url("SignWith"),Xr(e,t)).then((e=>ea(e).then((e=>({sig:e.sig}))))),this.authMethods=(e,t)=>this.fetch(this.url("AuthMethods"),Xr(e,t)).then((e=>ea(e).then((e=>({methods:e.methods,active:e.active}))))),this.setPIN=(e,t)=>this.fetch(this.url("SetPIN"),Xr(e,t)).then((e=>ea(e).then((e=>({}))))),this.resetPIN=(e,t)=>this.fetch(this.url("ResetPIN"),Xr(e,t)).then((e=>ea(e).then((e=>({}))))),this.createTOTP=(e,t)=>this.fetch(this.url("CreateTOTP"),Xr(e,t)).then((e=>ea(e).then((e=>({uri:e.uri}))))),this.commitTOTP=(e,t)=>this.fetch(this.url("CommitTOTP"),Xr(e,t)).then((e=>ea(e).then((e=>({codes:e.codes}))))),this.resetTOTP=(e,t)=>this.fetch(this.url("ResetTOTP"),Xr(e,t)).then((e=>ea(e).then((e=>({}))))),this.reset2FA=(e,t)=>this.fetch(this.url("Reset2FA"),Xr(e,t)).then((e=>ea(e).then((e=>({}))))),this.recoveryCodes=(e,t)=>this.fetch(this.url("RecoveryCodes"),Xr(e,t)).then((e=>ea(e).then((e=>({codes:e.codes}))))),this.resetRecoveryCodes=(e,t)=>this.fetch(this.url("ResetRecoveryCodes"),Xr(e,t)).then((e=>ea(e).then((e=>({codes:e.codes}))))),this.hostname=e,this.fetch=(e,s)=>t(e,s)}url(e){return this.hostname+this.path+e}}const Xr=(e={},t={})=>({method:"POST",headers:a({},t,{"Content-Type":"application/json"}),body:JSON.stringify(e||{})}),ea=e=>e.text().then((t=>{let s;try{s=JSON.parse(t)}catch(s){throw{code:"unknown",msg:`expecting JSON, got: ${t}`,status:e.status}}if(!e.ok)throw s;return s})),ta="object"==typeof global?global.fetch:window.fetch;let sa=function(e){return e.PIN="PIN",e.TOTP="TOTP",e}({});function na(e){switch(e){case sa.PIN:case sa.TOTP:return e;default:throw new Error(`unknown auth method '${e}'`)}}function ia(e){return"signerAddress"in e&&"string"==typeof e.signerAddress}async function ra(e){if(ia(e))return e;{const s=li(e.signer)?e.signer:new di(e.signer),n=await s.getAddress(),i=new Date,r=oa(e.walletAddress,i),a=Re(r);return{walletAddress:e.walletAddress,timestamp:i,signerAddress:n,signature:t.ethers.utils.hexlify(await s.sign(a,{}))}}}async function aa(e){if("wallet"in e){var t;const s=new Date,n=ca(s),i=await e.wallet.signTypedData(n.domain,n.types,n.message,null!=(t=n.domain.chainId)?t:1,"eip6492");return{jwt:e.jwt,timestamp:s,signature:i}}return e}function oa(e,s){return{domain:ha,types:{AuthMethods:[{name:"wallet",type:"address"},{name:"timestamp",type:"string"}]},message:{wallet:t.ethers.utils.getAddress(e),timestamp:la(s)}}}function ca(e){return{domain:ha,types:{AuthUpdate:[{name:"timestamp",type:"string"}]},message:{timestamp:la(e)}}}const ha={name:"Sequence Guard",version:"1",chainId:1};function la(e){return e.toUTCString().replace("GMT","UTC")}var da=Object.freeze({__proto__:null,GuardSigner:class{constructor(e,t,s=!1){this.address=e,this.url=t,this.appendSuffix=s,this.guard=void 0,this.guard=new Qr(t,ta)}async getAddress(){return this.address}async buildDeployTransaction(e){}async predecorateSignedTransactions(e){return[]}async decorateTransactions(e,t){return e}async sign(e,s){var n;if(!An(s))throw new Error("expected sequence signature request metadata");const i=s.guardTotpCode,r=Rn(s.config.version),{encoded:a}=r.signature.encodeSigners(s.config,null!=(n=s.parts)?n:new Map,[],s.chainId);return(await this.guard.signWith({signer:this.address,request:{msg:t.ethers.utils.hexlify(e),auxData:this.packMsgAndSig(s.address,s.digest,a,s.chainId),chainId:t.ethers.BigNumber.from(s.chainId).toNumber()},token:i?{id:sa.TOTP,token:i}:void 0})).sig}notifyStatusChange(e,t,s){}async getAuthMethods(e){let t;if("jwt"in e)t=await this.guard.authMethods({},{Authorization:`BEARER ${e.jwt}`});else{const s=await ra(e);t=await this.guard.authMethods({proof:{wallet:s.walletAddress,timestamp:s.timestamp.getTime(),signer:s.signerAddress,signature:s.signature}})}return a({},t,{methods:t.methods.map(na)})}async setPin(e,t){const s=await aa(t);void 0===e?await this.guard.resetPIN({timestamp:s.timestamp.getTime(),signature:s.signature},{Authorization:`BEARER ${t.jwt}`}):await this.guard.setPIN({pin:e,timestamp:s.timestamp.getTime(),signature:s.signature},{Authorization:`BEARER ${t.jwt}`})}resetPin(e){return this.setPin(void 0,e)}async createTotp(e){const t=await aa(e),{uri:s}=await this.guard.createTOTP({timestamp:t.timestamp.getTime(),signature:t.signature},{Authorization:`BEARER ${e.jwt}`});return new URL(s)}async commitTotp(e,t){const{codes:s}=await this.guard.commitTOTP({token:e},{Authorization:`BEARER ${t}`});return s}async resetTotp(e){const t=await aa(e);await this.guard.resetTOTP({timestamp:t.timestamp.getTime(),signature:t.signature},{Authorization:`BEARER ${e.jwt}`})}async reset2fa(e,t){if("jwt"in t)await this.guard.reset2FA({code:e},{Authorization:`BEARER ${t.jwt}`});else{const s=await ra(t);await this.guard.reset2FA({code:e,proof:{wallet:s.walletAddress,timestamp:s.timestamp.getTime(),signer:s.signerAddress,signature:s.signature}})}}async getRecoveryCodes(e){const t=await aa(e),{codes:s}=await this.guard.recoveryCodes({timestamp:t.timestamp.getTime(),signature:t.signature},{Authorization:`BEARER ${e.jwt}`});return s}async resetRecoveryCodes(e){const t=await aa(e),{codes:s}=await this.guard.resetRecoveryCodes({timestamp:t.timestamp.getTime(),signature:t.signature},{Authorization:`BEARER ${e.jwt}`});return s}packMsgAndSig(e,s,n,i){return t.ethers.utils.defaultAbiCoder.encode(["address","uint256","bytes","bytes"],[e,i,s,n])}suffix(){return this.appendSuffix?[3]:[]}},AuthMethod:sa,isSignedOwnershipProof:ia,signOwnershipProof:ra,getOwnershipProofTypedData:oa,getAuthUpdateProofTypedData:ca}),ua=Object.freeze({__proto__:null,WebRPCVersion:"v1",WebRPCSchemaVersion:"v0.4.0",WebRPCSchemaHash:"b53b368f85445da25796f8cc90459c61425c13f4",ContractType:Ei,EventLogType:Ci,EventLogDataType:Si,TxnTransferType:ki,TransactionStatus:Ti,TransactionType:_i,SortOrder:Oi,Indexer:Ni,SequenceIndexer:Mi}),fa=Object.freeze({__proto__:null,WebRPCVersion:"v1",WebRPCSchemaVersion:"v0.4.0",WebRPCSchemaHash:"4abf3a2d23aa0f4c036e7392ac23919dc611f1c3",ContractType:Ri,PropertyType:Li,SwapType:Di,SortOrder:Bi,TaskStatus:Ui,Metadata:Hi,SequenceMetadata:$i});let ga=function(e){return e.ethCall="eth_call",e.ethGetBalance="eth_getBalance",e.ethGetCode="eth_getCode",e}({});function pa(e,t){return e.reduce((function(e,s,n){return t(s,n)?e[0].push(s):e[1].push(s),e}),[[],[]])}class ma{constructor(e){var s=this;if(this.batchableJsonRpcMethods=[ga.ethCall,ga.ethGetCode,ga.ethGetBalance],this.multicallInterface=new t.ethers.utils.Interface(i.sequenceUtils.abi),this.options=void 0,this.timeout=void 0,this.queue=[],this.scheduleExecution=()=>{this.queue.length>0&&(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(this.run,this.options.timeWindow))},this.handle=(e,t,s)=>this.batchableJsonRpcMethods.find((e=>e===t.method))?(this.queue.push({request:t,callback:s,next:e}),this.options.verbose&&console.log("Scheduling call",t.method),void this.scheduleExecution()):(this.options.verbose&&console.log("Forwarded call",t.method),e(t,s)),this.run=async function(){s.options.verbose&&console.log("Processing multicall");const e=Math.min(s.options.batchSize,s.queue.length);if(0===e)return void(s.options.verbose&&console.log("Skip multicall, empty queue"));if(1===e)return s.forward(s.queue[0]),s.queue=[],void(s.options.verbose&&console.log("Skip multicall, single item"));s.options.verbose&&console.log("Resolving",e);var n=s.queue.slice(0,e);s.queue=e===s.queue.length?[]:s.queue.slice(e),s.options.verbose&&console.log("Updated queue",s.queue.length),0!==s.queue.length&&(s.options.verbose&&console.log("Scheduling next batch"),s.scheduleExecution());const i=n[0].next;let r;var[n,a]=pa(n,(e=>{try{if(e.next!==i)return!1;switch(e.request.method){case ga.ethCall:if(e.request.params[0].from||e.request.params[0].gasPrice||e.request.params[0].value)return!1;case ga.ethGetBalance:case ga.ethGetCode:const i=function(e){if(void 0===e)return"latest";switch(e){case"earliest":case"latest":case"pending":return e}return t.BigNumber.from(e)}(e.request.params[1]);if(void 0===r&&(r=i),(s=i)!==(n=r)&&!(t.BigNumber.isBigNumber(s)?t.BigNumber.isBigNumber(n)&&s.eq(n):!t.BigNumber.isBigNumber(n)&&s===n))return!1}return!0}catch(e){return!1}var s,n}));if(0!==a.length&&(s.options.verbose&&console.log("Forwarding incompatible calls",a.length),s.forward(a),0===n.length))return void(s.options.verbose&&console.log("Skip multicall, all calls are incompatible"));let o=n.map((e=>{try{switch(e.request.method){case ga.ethCall:return{delegateCall:!1,revertOnError:!1,target:e.request.params[0].to,data:e.request.params[0].data,gasLimit:e.request.params[0].gas?e.request.params[0].gas:0,value:0};case ga.ethGetCode:return{delegateCall:!1,revertOnError:!1,target:s.options.contract,gasLimit:0,value:0,data:s.multicallInterface.encodeFunctionData(s.multicallInterface.getFunction("callCode"),[e.request.params[0]])};case ga.ethGetBalance:return{delegateCall:!1,revertOnError:!1,target:s.options.contract,gasLimit:0,value:0,data:s.multicallInterface.encodeFunctionData(s.multicallInterface.getFunction("callBalanceOf"),[e.request.params[0]])};default:return null}}catch(e){return null}}));var[n,a]=pa(n,((e,t)=>void 0!==o[t]));if(o=o.filter((e=>e)),0!==a.length&&(s.options.verbose&&console.log("Forwarding calls on error",a.length),s.forward(a),0===n.length))return void(s.options.verbose&&console.log("Skip multicall, all calls had encoding errors"));let c;try{s.options.verbose&&console.log("Encoding multicall"),c=s.multicallInterface.encodeFunctionData(s.multicallInterface.getFunction("multiCall"),[o])}catch(e){return s.options.verbose&&console.warn("Error encoding multicall, forwarding one by one",e),void s.forward(n)}const h=Ne(),l=await async function(e,t){try{return await e}catch(e){return t instanceof Function?t(e):t}}(Oe(i)({id:h,jsonrpc:Je,method:ga.ethCall,params:[{to:s.options.contract,value:0,data:c},t.BigNumber.isBigNumber(r)?r.toNumber():r]}),(e=>({jsonrpc:Je,id:h,result:void 0,error:e})));if(l.error)return s.options.verbose&&console.warn("Error calling multicall, forwarding one by one",l.error),s.forward(n);let d;try{d=s.multicallInterface.decodeFunctionResult(s.multicallInterface.getFunction("multiCall"),l.result)}catch(e){return s.options.verbose&&console.warn("Error decoding multicall result, forwarding one by one",e),void s.forward(n)}s.options.verbose&&console.log("Got response for",n.length),n.forEach(((e,n)=>{if(d[0][n])switch(e.request.method){case ga.ethCall:e.callback(void 0,{jsonrpc:e.request.jsonrpc,id:e.request.id,result:d[1][n]});break;case ga.ethGetCode:e.callback(void 0,{jsonrpc:e.request.jsonrpc,id:e.request.id,result:t.ethers.utils.defaultAbiCoder.decode(["bytes"],d[1][n])[0]});break;case ga.ethGetBalance:e.callback(void 0,{jsonrpc:e.request.jsonrpc,id:e.request.id,result:t.ethers.utils.defaultAbiCoder.decode(["uint256"],d[1][n])[0]})}else s.options.verbose&&console.warn(`Multicall error for ${e.request.method} not found`),s.forward(e)}))},this.options=e?a({},ma.DefaultOptions,e):ma.DefaultOptions,this.options.batchSize<=0)throw new Error(`Invalid batch size of ${this.options.batchSize}`)}forward(e){Array.isArray(e)?e.forEach((e=>e.next(e.request,e.callback))):e.next(e.request,e.callback)}static isMulticall(e){return e&&void 0!==e.handle&&void 0!==e.conf&&ma.isMulticallOptions(e.options)}static isMulticallOptions(e){return void 0!==e&&void 0!==e.batchSize&&void 0!==e.timeWindow&&void 0!==e.contract}}ma.DefaultOptions=a({},{batchSize:50,timeWindow:50,contract:"0xdbbFa3cB3B087B64F4ef5E3D20Dda2488AA244e6",verbose:!1});const ya=["getNetwork","getBlockNumber","getGasPrice","getTransactionCount","getStorageAt","sendTransaction","estimateGas","getBlock","getTransaction","getTransactionReceipt","getLogs","emit","litenerCount","addListener","removeListener","waitForTransaction","detectNetwork","getBlockWithTransactions"];class wa extends t.ethers.providers.BaseProvider{constructor(e,s){var n;super(e.getNetwork()),n=this,this.provider=e,this.multicall=void 0,this.getResolver=async function(e){const s=n.provider;if(s.getResolver){const i=await s.getResolver(await e);return i?new t.ethers.providers.Resolver(n,i.address,i.name):null}return s.getResolver(await e)},this.next=async function(e,t){try{switch(e.method){case ga.ethCall:n.callback(e,t,await n.provider.call(e.params[0],e.params[1]));break;case ga.ethGetCode:n.callback(e,t,await n.provider.getCode(e.params[0],e.params[1]));break;case ga.ethGetBalance:n.callback(e,t,await n.provider.getBalance(e.params[0],e.params[1]))}}catch(s){n.callback(e,t,void 0,s)}},this.listenerCount=e.listenerCount.bind(e),this.multicall=ma.isMulticall(s)?s:new ma(s),ya.forEach((t=>{void 0!==e[t]&&(this[t]=(...s)=>e[t](...s))}))}callback(e,t,s,n){t(n,{jsonrpc:Je,id:e.id,result:s,error:n})}async call(e,t){return this.rpcCall(ga.ethCall,e,t)}async getCode(e,t){return this.rpcCall(ga.ethGetCode,e,t)}async getBalance(e,t){return this.rpcCall(ga.ethGetBalance,e,t)}async rpcCall(e,...t){const s=Ne();return(await Oe(this.multicall.handle)(this.next,{jsonrpc:Je,id:s,method:e,params:t})).result}}var va=Object.freeze({__proto__:null,ProxyMethods:ya,MulticallProvider:wa,MulticallExternalProvider:class{constructor(e,t){if(this.provider=e,this.multicall=void 0,this.multicall=ma.isMulticall(t)?t:new ma(t),e.send){const t=async function(t,s){e.send(t,s)};this.send=(e,s)=>{this.multicall.handle(t,e,s)}}if(e.sendAsync){const t=async function(t,s){e.sendAsync(t,s)};this.sendAsync=(e,s)=>{this.multicall.handle(t,e,s)}}}get isMetaMask(){return this.provider.isMetaMask}get isStatus(){return this.provider.isStatus}},multicallMiddleware:e=>t=>{const s=ma.isMulticall(e)?e:new ma(e);return(e,n)=>s.handle(t,e,n)}}),ba=Object.freeze({__proto__:null,Multicall:ma,providers:va}),Ia=Object.freeze({__proto__:null,ChainId:re,NetworkType:ae,networks:oe,indexerURL:We,relayerURL:qe,nodesURL:$e,findSupportedNetwork:Fe,toChainIdNumber:Ge,allNetworks:Ke,JsonRpcVersion:Je,JsonRpcRouter:ze,createJsonRpcMiddlewareStack:Ye,JsonRpcSender:et,JsonRpcExternalProvider:class{constructor(e){this.provider=e,this.sendAsync=(e,t)=>{this.provider.send(e.method,e.params).then((s=>{t(void 0,{jsonrpc:"2.0",id:e.id,result:s})})).catch((e=>{t(e,void 0)}))},this.send=this.sendAsync}},AllowProvider:class{constructor(e){this.sendAsyncMiddleware=void 0,this.isAllowedFunc=void 0,this.isAllowedFunc=e||(e=>!0),this.sendAsyncMiddleware=tt(this.isAllowedFunc)}setIsAllowedFunc(e){this.isAllowedFunc=e,this.sendAsyncMiddleware=tt(this.isAllowedFunc)}},allowProviderMiddleware:tt,CachedProvider:st,EagerProvider:nt,exceptionProviderMiddleware:it,loggingProviderMiddleware:rt,networkProviderMiddleware:e=>s=>(n,i,r)=>{const a=e(n),{id:o,method:c}=n;switch(c){case"net_version":return void i(void 0,{jsonrpc:"2.0",id:o,result:`${a}`});case"eth_chainId":return void i(void 0,{jsonrpc:"2.0",id:o,result:t.ethers.utils.hexlify(a)})}s(n,i,r)},PublicProvider:class{constructor(e){this.privateJsonRpcMethods=["net_version","eth_chainId","eth_accounts",...at],this.provider=void 0,this.rpcUrl=void 0,this.sendAsyncMiddleware=e=>(t,s)=>{!this.provider||this.privateJsonRpcMethods.includes(t.method)?(ke.debug("[public-provider] sending request to signer window",t.method),e(t,s)):this.provider.send(t.method,t.params).then((e=>{s(void 0,{jsonrpc:"2.0",id:t.id,result:e})})).catch((e=>s(e)))},e&&this.setRpcUrl(e)}getRpcUrl(){return this.rpcUrl}setRpcUrl(e){e&&""!==e?(this.rpcUrl=e,this.provider=new t.providers.JsonRpcProvider(e)):(this.rpcUrl=void 0,this.provider=void 0)}},SigningProvider:class{constructor(e){this.provider=void 0,this.sendAsyncMiddleware=e=>(t,s,n)=>{at.includes(t.method)?this.provider.sendAsync(t,s,n):e(t,s,n)},this.provider=e}},SingleflightMiddleware:ot,isJsonRpcProvider:Ze,isJsonRpcHandler:Qe,JsonRpcProvider:ct,isNetworkConfig:function(e){return e&&void 0!==e.chainId&&void 0!==e.name&&void 0!==e.rpcUrl&&void 0!==e.relayer},getChainId:ce,maybeChainId:e=>{if(e)return ce(e)},isValidNetworkConfig:he,ensureValidNetworks:le,ensureUniqueNetworks:(e,t=!0)=>{const s=e.map((e=>e.chainId)).sort(),n=s.filter(((e,t)=>s.indexOf(e)!==t));if(n.length>0){if(t)throw new Error(`invalid network config: duplicate chainIds ${n}`);return!1}return!0},updateNetworkConfig:(e,t)=>{if(e&&t){if(!e.chainId&&!e.name)throw new Error("failed to update network config: source config is missing chainId or name");if(e.chainId!==t.chainId&&e.name!==t.name)throw new Error("failed to update network config: one of chainId or name must match");e.rpcUrl&&(t.rpcUrl=e.rpcUrl,t.provider=void 0),e.provider&&(t.provider=e.provider),e.relayer&&(t.relayer=e.relayer)}},validateAndSortNetworks:de,findNetworkConfig:ue,checkNetworkConfig:(e,t)=>!!e&&(e.name===t||e.chainId===t),networksIndex:e=>{const t={};for(let s=0;s<e.length;s++)t[e[s].name]=e[s];return t},sortNetworks:fe,stringTemplate:ge});var Ea=function(e,t,s){return e(s={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&s.path)}},s.exports),s.exports}((function(e,t){!function(t){var s=Object.hasOwnProperty,n=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},i="object"==typeof process&&"function"==typeof process.nextTick,r="function"==typeof Symbol,a="object"==typeof Reflect,o="function"==typeof setImmediate?setImmediate:setTimeout,c=r?a&&"function"==typeof Reflect.ownKeys?Reflect.ownKeys:function(e){var t=Object.getOwnPropertyNames(e);return t.push.apply(t,Object.getOwnPropertySymbols(e)),t}:Object.keys;function h(){this._events={},this._conf&&l.call(this,this._conf)}function l(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners!==t&&(this._maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),e.ignoreErrors&&(this.ignoreErrors=e.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function d(e,t){var s="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(s+=" Event name: "+t+"."),"undefined"!=typeof process&&process.emitWarning){var n=new Error(s);n.name="MaxListenersExceededWarning",n.emitter=this,n.count=e,process.emitWarning(n)}else console.error(s),console.trace&&console.trace()}var u=function(e,t,s){var n=arguments.length;switch(n){case 0:return[];case 1:return[e];case 2:return[e,t];case 3:return[e,t,s];default:for(var i=new Array(n);n--;)i[n]=arguments[n];return i}};function f(e,s){for(var n={},i=e.length,r=s?s.length:0,a=0;a<i;a++)n[e[a]]=a<r?s[a]:t;return n}function g(e,t,s){var n,i;if(this._emitter=e,this._target=t,this._listeners={},this._listenersCount=0,(s.on||s.off)&&(n=s.on,i=s.off),t.addEventListener?(n=t.addEventListener,i=t.removeEventListener):t.addListener?(n=t.addListener,i=t.removeListener):t.on&&(n=t.on,i=t.off),!n&&!i)throw Error("target does not implement any known event API");if("function"!=typeof n)throw TypeError("on method must be a function");if("function"!=typeof i)throw TypeError("off method must be a function");this._on=n,this._off=i;var r=e._observers;r?r.push(this):e._observers=[this]}function p(e,n,i,r){var a=Object.assign({},n);if(!e)return a;if("object"!=typeof e)throw TypeError("options must be an object");var o,c,h,l=Object.keys(e),d=l.length;function u(e){throw Error('Invalid "'+o+'" option value'+(e?". Reason: "+e:""))}for(var f=0;f<d;f++){if(o=l[f],!r&&!s.call(n,o))throw Error('Unknown "'+o+'" option');(c=e[o])!==t&&(h=i[o],a[o]=h?h(c,u):c)}return a}function m(e,t){return"function"==typeof e&&e.hasOwnProperty("prototype")||t("value must be a constructor"),e}function y(e){var t="value must be type of "+e.join("|"),s=e.length,n=e[0],i=e[1];return 1===s?function(e,s){if(typeof e===n)return e;s(t)}:2===s?function(e,s){var r=typeof e;if(r===n||r===i)return e;s(t)}:function(n,i){for(var r=typeof n,a=s;a-- >0;)if(r===e[a])return n;i(t)}}Object.assign(g.prototype,{subscribe:function(e,t,s){var n=this,i=this._target,r=this._emitter,a=this._listeners,o=function(){var n=u.apply(null,arguments),a={data:n,name:t,original:e};s?!1!==s.call(i,a)&&r.emit.apply(r,[a.name].concat(n)):r.emit.apply(r,[t].concat(n))};if(a[e])throw Error("Event '"+e+"' is already listening");this._listenersCount++,r._newListener&&r._removeListener&&!n._onNewListener?(this._onNewListener=function(s){s===t&&null===a[e]&&(a[e]=o,n._on.call(i,e,o))},r.on("newListener",this._onNewListener),this._onRemoveListener=function(s){s===t&&!r.hasListeners(s)&&a[e]&&(a[e]=null,n._off.call(i,e,o))},a[e]=null,r.on("removeListener",this._onRemoveListener)):(a[e]=o,n._on.call(i,e,o))},unsubscribe:function(e){var t,s,n,i=this,r=this._listeners,a=this._emitter,o=this._off,h=this._target;if(e&&"string"!=typeof e)throw TypeError("event must be a string");function l(){i._onNewListener&&(a.off("newListener",i._onNewListener),a.off("removeListener",i._onRemoveListener),i._onNewListener=null,i._onRemoveListener=null);var e=I.call(a,i);a._observers.splice(e,1)}if(e){if(!(t=r[e]))return;o.call(h,e,t),delete r[e],--this._listenersCount||l()}else{for(n=(s=c(r)).length;n-- >0;)e=s[n],o.call(h,e,r[e]);this._listeners={},this._listenersCount=0,l()}}});var w=y(["function"]),v=y(["object","function"]);function b(e,t,s){var n,i,r,a=0,o=new e((function(c,h,l){function d(){i&&(i=null),a&&(clearTimeout(a),a=0)}s=p(s,{timeout:0,overload:!1},{timeout:function(e,t){return("number"!=typeof(e*=1)||e<0||!Number.isFinite(e))&&t("timeout must be a positive number"),e}}),n=!s.overload&&"function"==typeof e.prototype.cancel&&"function"==typeof l;var u=function(e){d(),c(e)},f=function(e){d(),h(e)};n?t(u,f,l):(i=[function(e){f(e||Error("canceled"))}],t(u,f,(function(e){if(r)throw Error("Unable to subscribe on cancel event asynchronously");if("function"!=typeof e)throw TypeError("onCancel callback must be a function");i.push(e)})),r=!0),s.timeout>0&&(a=setTimeout((function(){var e=Error("timeout");e.code="ETIMEDOUT",a=0,o.cancel(e),h(e)}),s.timeout))}));return n||(o.cancel=function(e){if(i){for(var t=i.length,s=1;s<t;s++)i[s](e);i[0](e),i=null}}),o}function I(e){var t=this._observers;if(!t)return-1;for(var s=t.length,n=0;n<s;n++)if(t[n]._target===e)return n;return-1}function E(e,t,s,n,i){if(!s)return null;if(0===n){var r=typeof t;if("string"===r){var a,o,h=0,l=0,d=this.delimiter,u=d.length;if(-1!==(o=t.indexOf(d))){a=new Array(5);do{a[h++]=t.slice(l,o),l=o+u}while(-1!==(o=t.indexOf(d,l)));a[h++]=t.slice(l),t=a,i=h}else t=[t],i=1}else"object"===r?i=t.length:(t=[t],i=1)}var f,g,p,m,y,w,v,b=null,I=t[n],C=t[n+1];if(n===i)s._listeners&&("function"==typeof s._listeners?(e&&e.push(s._listeners),b=[s]):(e&&e.push.apply(e,s._listeners),b=[s]));else{if("*"===I){for(o=(w=c(s)).length;o-- >0;)"_listeners"!==(f=w[o])&&(v=E(e,t,s[f],n+1,i))&&(b?b.push.apply(b,v):b=v);return b}if("**"===I){for((y=n+1===i||n+2===i&&"*"===C)&&s._listeners&&(b=E(e,t,s,i,i)),o=(w=c(s)).length;o-- >0;)"_listeners"!==(f=w[o])&&("*"===f||"**"===f?(s[f]._listeners&&!y&&(v=E(e,t,s[f],i,i))&&(b?b.push.apply(b,v):b=v),v=E(e,t,s[f],n,i)):v=E(e,t,s[f],f===C?n+2:n,i),v&&(b?b.push.apply(b,v):b=v));return b}s[I]&&(b=E(e,t,s[I],n+1,i))}if((g=s["*"])&&E(e,t,g,n+1,i),p=s["**"])if(n<i)for(p._listeners&&E(e,t,p,i,i),o=(w=c(p)).length;o-- >0;)"_listeners"!==(f=w[o])&&(f===C?E(e,t,p[f],n+2,i):f===I?E(e,t,p[f],n+1,i):((m={})[f]=p[f],E(e,t,{"**":m},n+1,i)));else p._listeners?E(e,t,p,i,i):p["*"]&&p["*"]._listeners&&E(e,t,p["*"],i,i);return b}function C(e,t,s){var n,i,r=0,a=0,o=this.delimiter,c=o.length;if("string"==typeof e)if(-1!==(n=e.indexOf(o))){i=new Array(5);do{i[r++]=e.slice(a,n),a=n+c}while(-1!==(n=e.indexOf(o,a)));i[r++]=e.slice(a)}else i=[e],r=1;else i=e,r=e.length;if(r>1)for(n=0;n+1<r;n++)if("**"===i[n]&&"**"===i[n+1])return;var h,l=this.listenerTree;for(n=0;n<r;n++)if(l=l[h=i[n]]||(l[h]={}),n===r-1)return l._listeners?("function"==typeof l._listeners&&(l._listeners=[l._listeners]),s?l._listeners.unshift(t):l._listeners.push(t),!l._listeners.warned&&this._maxListeners>0&&l._listeners.length>this._maxListeners&&(l._listeners.warned=!0,d.call(this,l._listeners.length,h))):l._listeners=t,!0;return!0}function S(e,t,s,n){for(var i,r,a,o,h=c(e),l=h.length,d=e._listeners;l-- >0;)i=e[r=h[l]],a="_listeners"===r?s:s?s.concat(r):[r],o=n||"symbol"==typeof r,d&&t.push(o?a:a.join(this.delimiter)),"object"==typeof i&&S.call(this,i,t,a,o);return t}function k(e){for(var t,s,n,i=c(e),r=i.length;r-- >0;)(t=e[s=i[r]])&&(n=!0,"_listeners"===s||k(t)||delete e[s]);return n}function T(e,t,s){this.emitter=e,this.event=t,this.listener=s}function _(e,s,n){if(!0===n)a=!0;else if(!1===n)r=!0;else{if(!n||"object"!=typeof n)throw TypeError("options should be an object or true");var r=n.async,a=n.promisify,c=n.nextTick,h=n.objectify}if(r||c||a){var l=s,d=s._origin||s;if(c&&!i)throw Error("process.nextTick is not supported");a===t&&(a="AsyncFunction"===s.constructor.name),s=function(){var e=arguments,t=this,s=this.event;return a?c?Promise.resolve():new Promise((function(e){o(e)})).then((function(){return t.event=s,l.apply(t,e)})):(c?process.nextTick:o)((function(){t.event=s,l.apply(t,e)}))},s._async=!0,s._origin=d}return[s,h?new T(this,e,s):this]}function O(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,l.call(this,e)}T.prototype.off=function(){return this.emitter.off(this.event,this.listener),this},O.EventEmitter2=O,O.prototype.listenTo=function(e,s,i){if("object"!=typeof e)throw TypeError("target musts be an object");var r=this;function a(t){if("object"!=typeof t)throw TypeError("events must be an object");var s,n=i.reducers,a=I.call(r,e);s=-1===a?new g(r,e,i):r._observers[a];for(var o,h=c(t),l=h.length,d="function"==typeof n,u=0;u<l;u++)o=h[u],s.subscribe(o,t[o]||o,d?n:n&&n[o])}return i=p(i,{on:t,off:t,reducers:t},{on:w,off:w,reducers:v}),n(s)?a(f(s)):a("string"==typeof s?f(s.split(/\s+/)):s),this},O.prototype.stopListeningTo=function(e,t){var s=this._observers;if(!s)return!1;var n,i=s.length,r=!1;if(e&&"object"!=typeof e)throw TypeError("target should be an object");for(;i-- >0;)n=s[i],e&&n._target!==e||(n.unsubscribe(t),r=!0);return r},O.prototype.delimiter=".",O.prototype.setMaxListeners=function(e){e!==t&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},O.prototype.getMaxListeners=function(){return this._maxListeners},O.prototype.event="",O.prototype.once=function(e,t,s){return this._once(e,t,!1,s)},O.prototype.prependOnceListener=function(e,t,s){return this._once(e,t,!0,s)},O.prototype._once=function(e,t,s,n){return this._many(e,1,t,s,n)},O.prototype.many=function(e,t,s,n){return this._many(e,t,s,!1,n)},O.prototype.prependMany=function(e,t,s,n){return this._many(e,t,s,!0,n)},O.prototype._many=function(e,t,s,n,i){var r=this;if("function"!=typeof s)throw new Error("many only accepts instances of Function");function a(){return 0==--t&&r.off(e,a),s.apply(this,arguments)}return a._origin=s,this._on(e,a,n,i)},O.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||h.call(this);var e,t,s,n,i,a,o=arguments[0],c=this.wildcard;if("newListener"===o&&!this._newListener&&!this._events.newListener)return!1;if(c&&(e=o,"newListener"!==o&&"removeListener"!==o&&"object"==typeof o)){if(s=o.length,r)for(n=0;n<s;n++)if("symbol"==typeof o[n]){a=!0;break}a||(o=o.join(this.delimiter))}var l,d=arguments.length;if(this._all&&this._all.length)for(n=0,s=(l=this._all.slice()).length;n<s;n++)switch(this.event=o,d){case 1:l[n].call(this,o);break;case 2:l[n].call(this,o,arguments[1]);break;case 3:l[n].call(this,o,arguments[1],arguments[2]);break;default:l[n].apply(this,arguments)}if(c)l=[],E.call(this,l,e,this.listenerTree,0,s);else{if("function"==typeof(l=this._events[o])){switch(this.event=o,d){case 1:l.call(this);break;case 2:l.call(this,arguments[1]);break;case 3:l.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(d-1),i=1;i<d;i++)t[i-1]=arguments[i];l.apply(this,t)}return!0}l&&(l=l.slice())}if(l&&l.length){if(d>3)for(t=new Array(d-1),i=1;i<d;i++)t[i-1]=arguments[i];for(n=0,s=l.length;n<s;n++)switch(this.event=o,d){case 1:l[n].call(this);break;case 2:l[n].call(this,arguments[1]);break;case 3:l[n].call(this,arguments[1],arguments[2]);break;default:l[n].apply(this,t)}return!0}if(!this.ignoreErrors&&!this._all&&"error"===o)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},O.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||h.call(this);var e,t,s,n,i,a,o=arguments[0],c=this.wildcard;if("newListener"===o&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(c&&(e=o,"newListener"!==o&&"removeListener"!==o&&"object"==typeof o)){if(n=o.length,r)for(i=0;i<n;i++)if("symbol"==typeof o[i]){t=!0;break}t||(o=o.join(this.delimiter))}var l,d=[],u=arguments.length;if(this._all)for(i=0,n=this._all.length;i<n;i++)switch(this.event=o,u){case 1:d.push(this._all[i].call(this,o));break;case 2:d.push(this._all[i].call(this,o,arguments[1]));break;case 3:d.push(this._all[i].call(this,o,arguments[1],arguments[2]));break;default:d.push(this._all[i].apply(this,arguments))}if(c?(l=[],E.call(this,l,e,this.listenerTree,0)):l=this._events[o],"function"==typeof l)switch(this.event=o,u){case 1:d.push(l.call(this));break;case 2:d.push(l.call(this,arguments[1]));break;case 3:d.push(l.call(this,arguments[1],arguments[2]));break;default:for(s=new Array(u-1),a=1;a<u;a++)s[a-1]=arguments[a];d.push(l.apply(this,s))}else if(l&&l.length){if(l=l.slice(),u>3)for(s=new Array(u-1),a=1;a<u;a++)s[a-1]=arguments[a];for(i=0,n=l.length;i<n;i++)switch(this.event=o,u){case 1:d.push(l[i].call(this));break;case 2:d.push(l[i].call(this,arguments[1]));break;case 3:d.push(l[i].call(this,arguments[1],arguments[2]));break;default:d.push(l[i].apply(this,s))}}else if(!this.ignoreErrors&&!this._all&&"error"===o)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(d)},O.prototype.on=function(e,t,s){return this._on(e,t,!1,s)},O.prototype.prependListener=function(e,t,s){return this._on(e,t,!0,s)},O.prototype.onAny=function(e){return this._onAny(e,!1)},O.prototype.prependAny=function(e){return this._onAny(e,!0)},O.prototype.addListener=O.prototype.on,O.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},O.prototype._on=function(e,s,n,i){if("function"==typeof e)return this._onAny(e,s),this;if("function"!=typeof s)throw new Error("on only accepts instances of Function");this._events||h.call(this);var r,a=this;return i!==t&&(s=(r=_.call(this,e,s,i))[0],a=r[1]),this._newListener&&this.emit("newListener",e,s),this.wildcard?(C.call(this,e,s,n),a):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),n?this._events[e].unshift(s):this._events[e].push(s),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,d.call(this,this._events[e].length,e))):this._events[e]=s,a)},O.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var s,i=[];if(this.wildcard){var r="string"==typeof e?e.split(this.delimiter):e.slice();if(!(i=E.call(this,null,r,this.listenerTree,0)))return this}else{if(!this._events[e])return this;s=this._events[e],i.push({_listeners:s})}for(var a=0;a<i.length;a++){var o=i[a];if(s=o._listeners,n(s)){for(var c=-1,h=0,l=s.length;h<l;h++)if(s[h]===t||s[h].listener&&s[h].listener===t||s[h]._origin&&s[h]._origin===t){c=h;break}if(c<0)continue;return this.wildcard?o._listeners.splice(c,1):this._events[e].splice(c,1),0===s.length&&(this.wildcard?delete o._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(s===t||s.listener&&s.listener===t||s._origin&&s._origin===t)&&(this.wildcard?delete o._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return this.listenerTree&&k(this.listenerTree),this},O.prototype.offAny=function(e){var t,s=0,n=0;if(e&&this._all&&this._all.length>0){for(s=0,n=(t=this._all).length;s<n;s++)if(e===t[s])return t.splice(s,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(s=0,n=t.length;s<n;s++)this.emit("removeListenerAny",t[s]);this._all=[]}return this},O.prototype.removeListener=O.prototype.off,O.prototype.removeAllListeners=function(e){if(e===t)return!this._events||h.call(this),this;if(this.wildcard){var s,n=E.call(this,null,e,this.listenerTree,0);if(!n)return this;for(s=0;s<n.length;s++)n[s]._listeners=null;this.listenerTree&&k(this.listenerTree)}else this._events&&(this._events[e]=null);return this},O.prototype.listeners=function(e){var s,n,i,r,a,o=this._events;if(e===t){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!o)return[];for(r=(s=c(o)).length,i=[];r-- >0;)"function"==typeof(n=o[s[r]])?i.push(n):i.push.apply(i,n);return i}if(this.wildcard){if(!(a=this.listenerTree))return[];var h=[],l="string"==typeof e?e.split(this.delimiter):e.slice();return E.call(this,h,l,a,0),h}return o&&(n=o[e])?"function"==typeof n?[n]:n:[]},O.prototype.eventNames=function(e){var t=this._events;return this.wildcard?S.call(this,this.listenerTree,[],null,e):t?c(t):[]},O.prototype.listenerCount=function(e){return this.listeners(e).length},O.prototype.hasListeners=function(e){if(this.wildcard){var s=[],n="string"==typeof e?e.split(this.delimiter):e.slice();return E.call(this,s,n,this.listenerTree,0),s.length>0}var i=this._events,r=this._all;return!!(r&&r.length||i&&(e===t?c(i).length:i[e]))},O.prototype.listenersAny=function(){return this._all?this._all:[]},O.prototype.waitFor=function(e,s){var n=this,i=typeof s;return"number"===i?s={timeout:s}:"function"===i&&(s={filter:s}),b((s=p(s,{timeout:0,filter:t,handleError:!1,Promise:Promise,overload:!1},{filter:w,Promise:m})).Promise,(function(t,i,r){function a(){var r=s.filter;if(!r||r.apply(n,arguments))if(n.off(e,a),s.handleError){var o=arguments[0];o?i(o):t(u.apply(null,arguments).slice(1))}else t(u.apply(null,arguments))}r((function(){n.off(e,a)})),n._on(e,a,!1)}),{timeout:s.timeout,overload:s.overload})};var N=O.prototype;Object.defineProperties(O,{defaultMaxListeners:{get:function(){return N._maxListeners},set:function(e){if("number"!=typeof e||e<0||Number.isNaN(e))throw TypeError("n must be a non-negative number");N._maxListeners=e},enumerable:!0},once:{value:function(e,t,s){return b((s=p(s,{Promise:Promise,timeout:0,overload:!1},{Promise:m})).Promise,(function(s,n,i){var r;if("function"==typeof e.addEventListener)return r=function(){s(u.apply(null,arguments))},i((function(){e.removeEventListener(t,r)})),void e.addEventListener(t,r,{once:!0});var a,o=function(){a&&e.removeListener("error",a),s(u.apply(null,arguments))};"error"!==t&&(a=function(s){e.removeListener(t,o),n(s)},e.once("error",a)),i((function(){a&&e.removeListener("error",a),e.removeListener(t,o)})),e.once(t,o)}),{timeout:s.timeout,overload:s.overload})},writable:!0,configurable:!0}}),Object.defineProperties(N,{_maxListeners:{value:10,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),"function"==typeof t&&t.amd?t((function(){return O})):e.exports=O}()}));function Ca(e){return e&&"object"==typeof e&&"function"==typeof e.register&&"function"==typeof e.unregister&&"function"==typeof e.openWallet&&"function"==typeof e.closeWallet&&"function"==typeof e.isOpened&&"function"==typeof e.isConnected&&"function"==typeof e.on}class Sa extends URLSearchParams{static new(e){return new URLSearchParams(e)}}let ka=function(e){return e.OPEN="open",e.CLOSE="close",e.MESSAGE="message",e.CONNECT="connect",e.DISCONNECT="disconnect",e.ACCOUNTS_CHANGED="accountsChanged",e.CHAIN_CHANGED="chainChanged",e.NETWORKS="networks",e.WALLET_CONTEXT="walletContext",e.INIT="init",e.DEBUG="_debug",e}({}),Ta=function(e){return e[e.CLOSED=0]="CLOSED",e[e.OPENING=1]="OPENING",e[e.OPENED=2]="OPENED",e}({}),_a=function(e){return e[e.NIL=0]="NIL",e[e.SENT_NONCE=1]="SENT_NONCE",e[e.OK=2]="OK",e}({});class Oa extends Error{constructor(e){super(e),this.name="ProviderError"}}const Na=new Oa("Wallet is not signed in. Connect a wallet and try again."),Aa=3e4;let xa=0;const Pa=()=>++xa;class Ma{constructor(){var e=this;this.pendingMessageRequests=[],this.responseCallbacks=new Map,this.state=void 0,this.confirmationOnly=!1,this.events=new Ea.EventEmitter2,this.openPayload=void 0,this.connectPayload=void 0,this.accountsChangedPayload=void 0,this.networksPayload=void 0,this.walletContextPayload=void 0,this._sessionId=void 0,this._init=void 0,this._registered=void 0,this.sendAsync=async function(t,s,n){e.state===Ta.CLOSED&&(e.confirmationOnly=!0),e.openWallet(void 0,{type:"jsonRpcRequest",method:t.method},n);try{e.isOpened()||await e.waitUntilOpened();s(void 0,(await e.sendMessageRequest({idx:Pa(),type:ka.MESSAGE,data:t,chainId:n})).data)}catch(e){s(e)}},this.sendMessageRequest=async function(t){return new Promise(((s,n)=>{(!t.idx||t.idx<=0)&&"init"!==t.type&&n(new Error("message idx not set"));const i=(e,t)=>{if(e)n(e);else{if(!t)throw new Error("no valid response to return");s(t)}},r=t.idx;e.responseCallbacks.get(r)?n(new Error("duplicate message idx, should never happen")):e.responseCallbacks.set(r,i),e.isOpened()?e.sendMessage(t):(ke.debug("pushing to pending requests",t),e.pendingMessageRequests.push(t))}))},this.waitUntilOpened=async function(t=3e4){let s=!1;return Promise.race([new Promise(((n,i)=>{const r=setTimeout((()=>{clearTimeout(r),s||(e.state=Ta.CLOSED,e.events.emit("close",{code:1005,message:"opening wallet timed out"})),i(new Error("opening wallet timed out"))}),t)})),new Promise((t=>{var n;if(e.isOpened())return s=!0,void t(null==(n=e.openPayload)?void 0:n.session);e.events.once("open",(n=>{e.openPayload=n,s=!0,t(n.session)}))}))])},this.waitUntilConnected=async function(){await e.waitUntilOpened();const t=new Promise((t=>{e.connectPayload?t(e.connectPayload):e.events.once("connect",(s=>{e.connectPayload=s,t(s)}))})),s=new Promise(((t,s)=>{e.events.once("close",(e=>{s(e?new Error(`wallet closed due to ${JSON.stringify(e)}`):new Error("user closed the wallet"))}))}));return Promise.race([t,s])},this.state=Ta.CLOSED,this._registered=!1,this._init=_a.NIL}get registered(){return this._registered}register(){throw new Error("abstract method")}unregister(){throw new Error("abstract method")}openWallet(e,t,s){throw new Error("abstract method")}closeWallet(){throw new Error("abstract method")}isOpened(){return this.registered&&this.state===Ta.OPENED}isConnected(){var e;const t=null==(e=this.openPayload)?void 0:e.session;return this.registered&&void 0!==t&&!!t.accountAddress&&42===t.accountAddress.length&&!!t.networks&&t.networks.length>0}handleMessage(e){var s=this;if(e.type===ka.INIT){ke.debug("MessageProvider, received INIT message",e);const{nonce:t}=e.data;if(!t||0==t.length)return void ke.error("invalid init nonce");this._init=_a.OK,this.sendMessage({idx:-1,type:ka.INIT,data:{sessionId:this._sessionId,nonce:t}})}if(this._init!==_a.OK)return;ke.debug("RECEIVED MESSAGE FROM WALLET",e.idx,e);const n=e.idx,i=this.responseCallbacks.get(n);if(n&&this.responseCallbacks.delete(n),e.type!==ka.OPEN||this.isOpened()){if(e.type===ka.MESSAGE){if(this.confirmationOnly&&setTimeout((()=>{0===this.responseCallbacks.size&&this.closeWallet()}),500),!i)throw new Error("impossible state");if(i)return this.events.emit("message",e),void i(e.data.error,e)}if(e.type===ka.ACCOUNTS_CHANGED)return this.accountsChangedPayload={accounts:[]},void(e.data&&e.data.length>0?(this.accountsChangedPayload={accounts:[t.ethers.utils.getAddress(e.data[0])],origin:e.origin},this.events.emit("accountsChanged",this.accountsChangedPayload.accounts,this.accountsChangedPayload.origin)):this.events.emit("accountsChanged",[],e.origin));if(e.type!==ka.CHAIN_CHANGED){if(e.type===ka.NETWORKS)return this.networksPayload=e.data,void this.events.emit("networks",this.networksPayload);if(e.type===ka.WALLET_CONTEXT)return this.walletContextPayload=e.data,void this.events.emit("walletContext",this.walletContextPayload);e.type===ka.CLOSE&&this.state!==Ta.CLOSED&&this.close(e.data),e.type===ka.CONNECT&&(this.connectPayload=e.data,this.events.emit("connect",this.connectPayload)),e.type===ka.DISCONNECT&&this.isConnected()&&(this.events.emit("disconnect",e.data,e.origin),this.close())}else this.events.emit("chainChanged",e.data,e.origin)}else{var r,a;if(this._sessionId&&this._sessionId!==(null==(r=e.data)?void 0:r.sessionId))return void ke.debug("open event received from wallet, but does not match sessionId",this._sessionId);if(null!=(a=e.data)&&a.error){var o;const t=new Error(`opening wallet failed: received ${null==(o=e.data)?void 0:o.error}`);throw ke.error(t),this.close(),t}if(this.state=Ta.OPENED,this.openPayload=e.data,this.events.emit("open",this.openPayload),0!==this.pendingMessageRequests.length){this.pendingMessageRequests.splice(0,this.pendingMessageRequests.length).forEach((async function(e){s.sendMessage(e)}))}}}sendMessage(e){throw new Error("abstract method")}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}emit(e,...t){return this.events.emit(e,...t)}close(e){this.state!==Ta.CLOSED&&(this.state=Ta.CLOSED,this.confirmationOnly=!1,this._sessionId=void 0,ke.info("closing wallet and flushing!"),this.pendingMessageRequests.length=0,this.responseCallbacks.forEach((e=>{e(a({},new Error("wallet closed"),{code:4001}))})),this.responseCallbacks.clear(),this.connectPayload=void 0,this.openPayload=void 0,this.accountsChangedPayload=void 0,this.networksPayload=void 0,this.walletContextPayload=void 0,this.events.emit("close",e))}}const Ra=[{name:"Decentraland Exception",predicate:function(e){try{const s=t.ethers.utils.toUtf8String(e);return La.test(s)}catch(e){return!1}}},{name:"0x v3 Exception",predicate:function(e){const s=new t.ethers.utils.Interface(Da);try{return s.decodeFunctionData("OrderWithHash",e),!0}catch(e){return!1}}}],La=/^Decentraland Login\nEphemeral address: 0x[a-fA-F0-9]{40}\nExpiration: (\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)((-(\d{2}):(\d{2})|Z)?)$/;const Da=[{inputs:[{components:[{internalType:"address",name:"makerAddress",type:"address"},{internalType:"address",name:"takerAddress",type:"address"},{internalType:"address",name:"feeRecipientAddress",type:"address"},{internalType:"address",name:"senderAddress",type:"address"},{internalType:"uint256",name:"makerAssetAmount",type:"uint256"},{internalType:"uint256",name:"takerAssetAmount",type:"uint256"},{internalType:"uint256",name:"makerFee",type:"uint256"},{internalType:"uint256",name:"takerFee",type:"uint256"},{internalType:"uint256",name:"expirationTimeSeconds",type:"uint256"},{internalType:"uint256",name:"salt",type:"uint256"},{internalType:"bytes",name:"makerAssetData",type:"bytes"},{internalType:"bytes",name:"takerAssetData",type:"bytes"},{internalType:"bytes",name:"makerFeeAssetData",type:"bytes"},{internalType:"bytes",name:"takerFeeAssetData",type:"bytes"}],internalType:"struct IEIP1271Data.Order",name:"order",type:"tuple"},{internalType:"bytes32",name:"orderHash",type:"bytes32"}],name:"OrderWithHash",outputs:[],stateMutability:"pure",type:"function"}],Ba=t.ethers.utils.toUtf8Bytes("Ethereum Signed Message:\n"),Ua=e=>t.ethers.utils.isBytes(e)||t.ethers.utils.isHexString(e)?t.ethers.utils.arrayify(e):t.ethers.utils.toUtf8Bytes(e),Ha=e=>{const s=Ua(e);return function(e){return Ra.some((t=>t.predicate(e)))}(s)?s:t.ethers.utils.concat([Ba,t.ethers.utils.toUtf8Bytes(String(s.length)),s])},ja=async(e,t,s,n)=>new On(n).isValidSignature(e,t,s),Wa=async(e,t,s,n)=>{const i=Ha(t),r=we(i);return ja(e,r,s,n)},qa=(e,t,s,n)=>ja(e,Re(t),s,n),$a=()=>"chrome-extension:"===window.location.protocol||"moz-extension:"===window.location.protocol,Fa=()=>!!navigator.userAgent.match(/UnitySequence/i),Ga=e=>e.onChain.deployed&&e.fullyMigrated;class Va{constructor(){this.callbacks=[],this.store={}}getItem(e){return this.store[e]||null}setItem(e,t){this.store[e]=t,this.callbacks.filter((t=>t.key===e)).forEach((e=>e.cb(t)))}removeItem(e){delete this.store[e]}onItemChange(e,t){return this.callbacks.push({key:e,cb:t}),()=>{this.callbacks=this.callbacks.filter((e=>e.cb!==t))}}}class Ka{static isAvailable(){return"object"==="object".localStorage}constructor(){if(this.callbacks=[],!Ka.isAvailable())throw new Error("LocalStorage is not available");window.addEventListener("storage",(e=>{const{key:t}=e;this.callbacks.filter((e=>e.key===t)).forEach((e=>e.cb(this.getItem(t))))}))}getItem(e){return window.localStorage.getItem(e)}setItem(e,t){window.localStorage.setItem(e,t),this.callbacks.filter((t=>t.key===e)).forEach((e=>e.cb(t)))}removeItem(e){window.localStorage.removeItem(e),this.callbacks.filter((t=>t.key===e)).forEach((e=>e.cb(null)))}onItemChange(e,t){return this.callbacks.push({key:e,cb:t}),()=>{this.callbacks=this.callbacks.filter((e=>e.cb!==t))}}}function Ja(){return Ka.isAvailable()?new Ka:new Va}async function za(e){return Array.isArray(e)?Promise.all(e.map((e=>t.ethers.utils.resolveProperties(e)))):t.ethers.utils.resolveProperties(e)}const Ya="@sequence.transportSession";class Za{constructor(e){var s=this;this.walletRequestHandler=void 0,this._sessionId=void 0,this._registered=void 0,this._init=void 0,this._initNonce=void 0,this._initCallback=void 0,this.appOrigin=void 0,this.sendAsync=async function(e,t,s){throw new Error("abstract method")},this.handleMessage=async function(e){const t=e;if(s._init===_a.OK)switch(t.type){case ka.OPEN:{if(s._init!==_a.OK)return;const e={sessionId:t.data.sessionId,intent:t.data.intent,networkId:t.data.networkId};return void await s.open(e)}case ka.CLOSE:return s._init,void _a.OK;case ka.MESSAGE:{const e=await s.walletRequestHandler.sendMessageRequest(t);return s.sendMessage(e),void e.data.error}default:ke.error(`unexpected payload type ${t.type}`)}else if(t.type===ka.INIT){if(!s.isValidInitAck(e))return void(s._initCallback&&s._initCallback("invalid init"));s._initCallback&&s._initCallback()}},this.sendMessageRequest=async function(e){return s.walletRequestHandler.sendMessageRequest(e)},this.open=async function({sessionId:e,intent:t,networkId:n}){let i;e&&(s._sessionId=Ae(e),s.saveTransportSession({sessionId:e,intent:t,networkId:n})),s.walletRequestHandler.setOpenIntent(t),await s.init();try{if(n){const e=Fe(n);if(!e)throw new Error(`unknown network ${n}`);i=e.chainId}else i=s.walletRequestHandler.defaultChainId()}catch(e){console.error(e)}if(t&&"connect"===t.type&&t.options){const e=t.options,i=e;if(s.appOrigin&&null!=i&&i.origin){if(!$a()&&i.origin!==s.appOrigin)throw new Error("origin is invalid")}else!s.appOrigin&&null!=i&&i.origin?e.origin=Pe(i.origin):s.appOrigin&&(e.origin=s.appOrigin);e.app&&(e.app=xe(e.app)),e.networkId?n=e.networkId:n&&(e.networkId=n),s.walletRequestHandler.setConnectOptions(e)}else s.walletRequestHandler.setConnectOptions(void 0);if(await s.walletRequestHandler.getAccount(),!await s.walletRequestHandler.isSignedIn())return s.notifyOpen({sessionId:s._sessionId}),!0;if(t&&"connect"===t.type){(!i||i<=0)&&console.log("Failed to set default network on open"),s.notifyOpen({sessionId:s._sessionId});try{const e=await s.walletRequestHandler.promptConnect(t.options);e.connected&&s.walletRequestHandler.notifyConnect(e)}catch(e){ke.warn("promptConnect not connected:",e)}finally{t.options&&!0===t.options.keepWalletOpened||s.notifyClose()}}else{if(!i||i<=0)return s.notifyOpen({sessionId:s._sessionId,error:`failed to open wallet on network ${n}`}),!1;s.notifyOpen({sessionId:s._sessionId,chainId:`${i}`,session:await s.walletRequestHandler.walletSession(i)})}return!0},this.saveTransportSession=e=>{Ja().setItem(Ya,JSON.stringify(e))},this.getCachedTransportSession=async function(){const e=Ja().getItem(Ya);try{return e?JSON.parse(e):null}catch(t){return console.error(`unable to parse transport session: ${e}`),null}},this.walletRequestHandler=e,this._init=_a.NIL,this.walletRequestHandler.on("connect",(e=>{this.registered&&this.notifyConnect(e)})),this.walletRequestHandler.on("disconnect",((e,t)=>{this.registered&&this.notifyDisconnect(e,t)})),this.walletRequestHandler.on("accountsChanged",((e,t)=>{this.registered&&this.notifyAccountsChanged(e,t)})),this.walletRequestHandler.on("networks",(e=>{this.registered&&(this.notifyNetworks(e),e&&0!==e.length?this.notifyChainChanged(t.ethers.utils.hexValue(e.find((e=>e.isDefaultChain)).chainId)):this.notifyChainChanged("0x0"))})),this.walletRequestHandler.on("chainChanged",((e,t)=>{this.notifyChainChanged(e,t)})),this.walletRequestHandler.on("walletContext",(e=>{this.registered&&e&&this.notifyWalletContext(e)})),this.walletRequestHandler.on("close",(e=>{this.registered&&this.notifyClose(e)}))}get registered(){return this._registered}register(){throw new Error("abstract method")}unregister(){throw new Error("abstract method")}sendMessage(e){throw new Error("abstract method")}notifyOpen(e){const{chainId:t,sessionId:s,session:n,error:i}=e;this.sendMessage({idx:-1,type:ka.OPEN,data:{chainId:t,sessionId:s,session:n,error:i}})}notifyClose(e){this.sendMessage({idx:-1,type:ka.CLOSE,data:e?{error:e}:null})}notifyConnect(e){this.sendMessage({idx:-1,type:ka.CONNECT,data:e})}notifyDisconnect(e,t){this.sendMessage({idx:-1,type:ka.DISCONNECT,data:e?{error:e}:null,origin:t})}notifyAccountsChanged(e,t){this.sendMessage({idx:-1,type:ka.ACCOUNTS_CHANGED,data:e,origin:t})}notifyChainChanged(e,t){this.sendMessage({idx:-1,type:ka.CHAIN_CHANGED,data:e,origin:t})}notifyNetworks(e){this.sendMessage({idx:-1,type:ka.NETWORKS,data:e})}notifyWalletContext(e){this.sendMessage({idx:-1,type:ka.WALLET_CONTEXT,data:e})}isValidInitAck(e){if(this._init===_a.OK)return ke.warn("isValidInitAck, already in init'd state, so inquiry is invalid."),!1;if(e.type!==ka.INIT)return ke.warn("isValidInitAck, invalid message type, expecting init"),!1;const{sessionId:t,nonce:s}=e.data;return t&&0!==t.length&&s&&0!==s.length?t===this._sessionId&&s===this._initNonce||(ke.error("invalid init ack match"),!1):(ke.error("invalid init ack"),!1)}init(){return new Promise(((e,t)=>{if(this._init===_a.OK)return void e();if(this._init!==_a.NIL||this._initCallback)return void t("transport init is in progress");const s=setTimeout((()=>{ke.warn("transport init timed out"),this._initCallback&&this._initCallback("transport init timed out")}),15e3);this._initCallback=n=>{this._initCallback=void 0,clearTimeout(s),n?t(n):(this._init=_a.OK,e())},this._initNonce=`${performance.now()}`,this.sendMessage({idx:-1,type:ka.INIT,data:{nonce:this._initNonce}}),this._init=_a.SENT_NONCE}))}}class Qa{constructor(){this.conn=void 0,this.events=new Ea.EventEmitter2,this.handleMessage=e=>{throw new Error("ProxyMessageChannelPort is not registered")},this.sendMessage=e=>{this.conn.handleMessage(e),"open"===e.type&&this.events.emit("open",e),"close"===e.type&&this.events.emit("close",e),"connect"===e.type&&this.events.emit("connect",e),"disconnect"===e.type&&this.events.emit("disconnect",e)}}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}}class Xa extends Ma{constructor(e){if(super(),this.port=void 0,this.register=()=>{this.port.handleMessage=e=>{this.handleMessage(e)},this.on("open",((...e)=>{this.port.events.emit("open",...e)})),this.on("close",((...e)=>{this.port.events.emit("close",...e)})),this.on("connect",((...e)=>{this.port.events.emit("connect",...e)})),this.on("disconnect",((...e)=>{this.port.events.emit("disconnect",...e)})),this._registered=!0},this.unregister=()=>{this._registered=!1,this.closeWallet(),this.events.removeAllListeners(),this.port.handleMessage=void 0},this.openWallet=(e,t,s)=>{if(this.state===Ta.CLOSED){this.state=Ta.OPENING;const n=`${performance.now()}`;this._sessionId=n,this.sendMessage({idx:-1,type:ka.OPEN,data:{path:e,intent:t,networkId:s,sessionId:n}})}},this.state=Ta.CLOSED,this.port=e,!e)throw new Error("port argument cannot be empty");this._init=_a.OK}closeWallet(){this.sendMessage({idx:-1,type:ka.CLOSE,data:null}),this.close()}sendMessage(e){if(!e.idx)throw new Error("message idx is empty");this.port.sendMessage(e)}}function eo(e){var t;if(null!=(t=window.ue)&&t.sequencewallettransport&&!window.logsOverriddenForUnreal){var s;const t=null==(s=window.ue)?void 0:s.sequencewallettransport;console.log=(...s)=>{t.logfromjs(`${e}: ${to(s)}`)},console.warn=(...s)=>{t.warnfromjs(`${e}: ${to(s)}`)},console.error=(...s)=>{t.errorfromjs(`${e}: ${to(s)}`)},window.logsOverriddenForUnreal=!0}}function to(e){return e.map((e=>"object"==typeof e?e instanceof Error?e.message:JSON.stringify(e):String(e))).join(" ")}let so;class no extends Ma{constructor(e){super(),this.walletURL=void 0,this.register=()=>{var e;eo("dapp"),so&&(so.unregister(),so=this),null!=(e=window.ue)&&e.sequencewallettransport&&(window.ue.sequencewallettransport.onmessagefromwallet=this.onUnrealCallback),so=this,this._registered=!0,console.log("registering transport!")},this.unregister=()=>{var e;this._registered=!1,this.closeWallet(),so===this&&(so=void 0),(null==(e=window.ue)||null==(e=e.sequencewallettransport)?void 0:e.onmessagefromwallet)===this.onUnrealCallback&&delete window.ue.sequencewallettransport.onmessagefromwallet,this.events.removeAllListeners()},this.openWallet=(e,t,s)=>{if(this.isOpened())return void console.log("wallet already open!");console.log("opening wallet!");const n=new URL(this.walletURL.href),i=new Sa;e&&(n.pathname=e.toLowerCase()),this._init=_a.NIL,this._sessionId=`${performance.now()}`,i.set("sid",this._sessionId),t&&i.set("intent",pe(t)),s&&i.set("net",`${s}`),n.search=i.toString(),console.log("opening wallet to",n.href),window.open(n.href)},this.onUnrealCallback=e=>{if(!e)throw new Error("ProviderMessage object is empty");this.handleMessage(e)},this.walletURL=new URL(e)}closeWallet(){this.close()}sendMessage(e){var t;const s="string"!=typeof e?JSON.stringify(e):e;console.log("Sending message to wallet:",s),null==(t=window.ue)||null==(t=t.sequencewallettransport)||t.sendmessagetowallet(s)}}const io="sequence-extension-message-handler";class ro extends Ma{constructor(e){super(),this.register=()=>{this._registered=!0},e.onConnect.addListener((e=>{e.name===io&&(this._init=_a.OK,e.onMessage.addListener((e=>{this.handleMessage(e)})))}))}sendMessage(e){}unregister(){}openWallet(e,t,s){}closeWallet(){}}class ao extends Ea.EventEmitter2{constructor(e){var t;super(),t=this,this.stream=e,this.responseCallbacks=new Map,this._messageIdx=0,this.nextMessageIdx=()=>++this._messageIdx,this.handleMessage=e=>{if(!e.type||!e.data)return;ke.info("[received message]",e);const t=e.idx,s=this.responseCallbacks.get(t);switch(t&&this.responseCallbacks.delete(t),e.type){case ka.MESSAGE:if(!s)throw new Error("impossible state");this.emit(ka.MESSAGE,e),s(e.data.error,e);break;case ka.DISCONNECT:case ka.ACCOUNTS_CHANGED:case ka.CHAIN_CHANGED:this.emit(e.type,e.data);break;default:console.error("unknown message type",e)}},this.sendMessageRequest=async function(e){return new Promise(((s,n)=>{(!e.idx||e.idx<=0)&&n(new Error("message idx not set"));const i=(e,t)=>{if(e)n(e);else{if(!t)throw new Error("no valid response to return");s(t)}},{idx:r}=e;t.responseCallbacks.get(r)?n(new Error("duplicate message idx, should never happen")):t.responseCallbacks.set(r,i),t.sendMessage(e)}))},this.stream.on("data",this.handleMessage)}sendMessage(e){this.stream.writable||console.error("window post message stream is not writable"),this.stream.write(e)}}let oo;class co extends Ma{constructor(e){super(),this.walletURL=void 0,this.walletWindow=void 0,this.register=()=>{oo&&(oo.unregister(),oo=this),window.addEventListener("message",this.onWindowEvent),oo=this,this.on("open",(()=>{const e=this.walletWindow,t=setInterval((()=>{e&&e.closed&&(clearInterval(t),this.close())}),500)})),this.on("close",(()=>{this.walletWindow&&(this.walletWindow.close(),this.walletWindow=null)})),this._registered=!0},this.unregister=()=>{this._registered=!1,this.closeWallet(),oo===this&&(oo=void 0),window.removeEventListener("message",this.onWindowEvent),this.events.removeAllListeners()},this.openWallet=(e,t,s)=>{if(this.walletWindow&&this.isOpened())return void this.walletWindow.focus();const n=new URL(this.walletURL.href),i=new Sa;let r,a;e&&""!==e&&(n.pathname=e.toLowerCase()),this._init=_a.NIL,this._sessionId=`${performance.now()}`,i.set("sid",this._sessionId),t&&("connect"===t.type&&(t.options||(t.options={app:window.location.origin}),$a()||Fa()||!t.options||(t.options.origin=window.location.origin)),i.set("intent",pe(t))),s&&i.set("net",`${s}`),$a()?(r=[450,750],a=[Math.abs(window.screen.width/2-r[0]/2),Math.abs(window.screen.height/2-r[1]/2)]):(r=[450,750],a=[Math.abs(window.screenX+window.innerWidth/2-r[0]/2),Math.abs(window.screenY+window.innerHeight/2-r[1]/2)]);const o=`toolbar=0,location=0,menubar=0,scrollbars=yes,status=yes,width=${r[0]},height=${r[1]},left=${a[0]},top=${a[1]}`;n.search=i.toString(),this.walletWindow=window.open(n.href,"sequence.app",o)},this.onWindowEvent=e=>{if(e.origin!==this.walletURL.origin)return;let t;try{t=JSON.parse(e.data)}catch(e){return}if(!t)throw new Error("ProviderMessage object is empty");this.handleMessage(t)},this.walletURL=new URL(e)}closeWallet(){var e;this.close(),null==(e=this.walletWindow)||e.close()}sendMessage(e){if(!this.walletWindow)return void ke.warn("WindowMessageProvider: sendMessage failed as walletWindow is unavailable");const t="string"!=typeof e?JSON.stringify(e):e;this.walletWindow.postMessage(t,this.walletURL.origin)}}function ho(e){return e&&"object"==typeof e&&(e.windowTransport&&"object"==typeof e.windowTransport||e.proxyTransport&&"object"==typeof e.proxyTransport||e.extensionTransport&&"object"==typeof e.extensionTransport||e.unrealTransport&&"object"==typeof e.unrealTransport)&&(e.windowTransport&&e.windowTransport.enabled||e.proxyTransport&&e.proxyTransport.enabled||e.extensionTransport&&e.extensionTransport.enabled||e.unrealTransport&&e.unrealTransport.enabled)}class lo{constructor(...e){var t=this;this.messageProviders=void 0,this.provider=void 0,this.register=()=>{if(1===this.messageProviders.length)return this.provider=this.messageProviders[0],void this.provider.register();this.messageProviders.forEach((e=>{e.register(),e.once("open",(()=>{this.provider||(this.provider=e,this.messageProviders.forEach((e=>{this.provider!==e&&e.unregister()})))}))}))},this.unregister=()=>{this.messageProviders.forEach((e=>e.unregister())),this.provider=void 0},this.openWallet=(e,t,s)=>{this.provider?this.provider.openWallet(e,t,s):this.messageProviders.forEach((n=>n.openWallet(e,t,s)))},this.sendAsync=async function(e,s,n){if(!t.provider)throw new Error("impossible state, wallet must be opened first");t.provider.sendAsync(e,s,n)},this.sendMessageRequest=async function(e){if(t.provider)return t.provider.sendMessageRequest(e);throw new Error("impossible state, wallet must be opened first")},this.waitUntilOpened=async function(){return t.provider?t.provider.waitUntilOpened():Promise.race(t.messageProviders.map((e=>e.waitUntilOpened())))},this.waitUntilConnected=async function(){if(t.provider)return t.provider.waitUntilConnected();throw new Error("impossible state, wallet must be opened first")},this.messageProviders=e,this.provider=void 0}static new(e){var t,s,n,i;const r=new lo;if(null!=(t=e.windowTransport)&&t.enabled&&e.walletAppURL){const t=new co(e.walletAppURL);r.add(t)}if(null!=(s=e.proxyTransport)&&s.enabled){const t=new Xa(e.proxyTransport.appPort);r.add(t)}if(null!=(n=e.extensionTransport)&&n.enabled){const t=new ro(e.extensionTransport.runtime);r.add(t)}if(null!=(i=e.unrealTransport)&&i.enabled&&e.windowTransport&&e.walletAppURL){const t=new no(e.walletAppURL);r.add(t)}return r.register(),r}add(...e){this.messageProviders.push(...e)}closeWallet(){this.provider&&this.provider.closeWallet()}isOpened(){return!!this.provider&&this.provider.isOpened()}isConnected(){return!!this.provider&&this.provider.isConnected()}on(e,t){this.provider?this.provider.on(e,t):this.messageProviders.forEach((s=>{s.on(e,t)}))}once(e,t){this.provider?this.provider.once(e,t):this.messageProviders.forEach((s=>{s.once(e,t)}))}emit(e,...t){if(this.provider)return this.provider.emit(e,...t);for(let s=0;s<this.messageProviders.length;s++)this.messageProviders[s].emit(e,...t);return!0}sendMessage(e){if(!e.idx||e.idx<=0)throw new Error("message idx is empty");if(!this.provider)throw new Error("impossible state, wallet must be opened first");this.provider.sendMessage(e)}handleMessage(e){if(!this.provider)throw new Error("impossible state, wallet must be opened first");this.provider.handleMessage(e)}}function uo(e,s){const n=mn(e,s);En(e,n).forEach((s=>function(e,s){if(s.to.toLowerCase()===e.toLowerCase()&&s.data){const e=t.ethers.utils.arrayify(s.data);if(e.length>=4&&!function(e){const s=new t.ethers.utils.Interface(i.mainModule.abi);try{return s.decodeFunctionData("createContract",e),!0}catch(e){return!1}}(e))throw new Error("self calls are forbidden")}if(s.delegateCall)throw new Error("delegate calls are forbidden")}(e,s)))}function fo(e,t){return{context:t.original.context,config:t.onChain.config,address:Zs(t.original.context,t.original.imageHash),chainId:e,deployed:t.onChain.deployed,imageHash:t.imageHash,lastImageHash:t.onChain.imageHash,published:!0,status:t}}const go=["net_version","eth_chainId","eth_getBalance","eth_getTransactionCount","eth_blockNumber","eth_getBlockByNumber","eth_getBlockByHash","eth_getTransactionByHash","eth_getCode","eth_estimateGas","eth_gasPrice","sequence_getWalletContext","sequence_getNetworks","sequence_setDefaultNetwork"];class po{get utils(){return this.provider.utils}constructor(e,t){this.client=e,this.provider=t,this.singleNetworkSigners={},this._isSigner=!0,this._isSequenceSigner=!0}async getAddress(){return this.client.getAddress()}connect(e){if(!wo.is(e))throw new Error("SequenceSigner can only be connected to a SequenceProvider");return new po(this.client,e)}getSigner(e){if(!e)return this;const t=this.provider.toChainId(e);return this.singleNetworkSigners[t]||(this.singleNetworkSigners[t]=new mo(this.client,this.provider,t)),this.singleNetworkSigners[t]}useChainId(e){return this.provider.toChainId(e)||this.client.getChainId()}async signMessage(e,t){const{eip6492:s=!0}=t||{},n=this.useChainId(null==t?void 0:t.chainId);return this.client.signMessage(e,{eip6492:s,chainId:n})}async signTypedData(e,t,s,n){const{eip6492:i=!0}=n||{},r=this.useChainId(null==n?void 0:n.chainId);return this.client.signTypedData({domain:e,types:t,message:s},{eip6492:i,chainId:r})}getProvider(e){return this.provider.getProvider(e)}async sendTransaction(e,s){const n=this.useChainId(null==s?void 0:s.chainId),i=await za(e),r=await this.client.sendTransaction(i,{chainId:n}),a=this.getProvider(n);try{return await t.ethers.utils.poll((async function(){const e=await a.getTransaction(r);return e?a._wrapTransaction(e,r):void 0}),{onceBlock:a})}catch(e){throw e.transactionHash=r,e}}async getWalletConfig(e){const t=this.useChainId(e);return this.client.getOnchainWalletConfig({chainId:t})}getNetworks(){return this.client.getNetworks()}async getBalance(e,t){return this.getProvider(null==t?void 0:t.chainId).getBalance(this.getAddress(),e)}async estimateGas(e,t){return this.getProvider(null==t?void 0:t.chainId).estimateGas(e)}async call(e,t,s){return this.getProvider(null==s?void 0:s.chainId).call(e,t)}getChainId(){return Promise.resolve(this.client.getChainId())}async getGasPrice(e){return this.getProvider(null==e?void 0:e.chainId).getGasPrice()}async getFeeData(e){return this.getProvider(null==e?void 0:e.chainId).getFeeData()}async resolveName(e){const t=await this.provider.resolveName(e);if(null===t)throw new Error(`ENS name not found: ${e}`);return t}_checkProvider(e){}populateTransaction(e){throw new Error("SequenceSigner does not support populateTransaction")}checkTransaction(e){throw new Error("SequenceSigner does not support checkTransaction")}getTransactionCount(e){throw new Error("SequenceSigner does not support getTransactionCount")}signTransaction(e){throw new Error("SequenceWallet does not support signTransaction, use sendTransaction instead.")}static is(e){return e&&"object"==typeof e&&!0===e._isSequenceSigner}}class mo extends po{constructor(e,t,s){super(e,t.getProvider(s)),this.chainId=s,this._isSingleNetworkSequenceSigner=!0}_useChainId(e){const t=this.provider.toChainId(e);if(t&&t!==this.chainId)throw new Error(`This signer only supports the network ${this.chainId}, but ${t} was requested.`);return t||this.provider.toChainId(this.chainId)}useChainId(e){return this._useChainId(e)}getChainId(){return Promise.resolve(this.provider.toChainId(this.chainId))}getProvider(e){return super.getProvider(this._useChainId(e))}getSigner(e){if(this._useChainId(e)!==this.chainId)throw new Error("Unreachable code");return this}static is(e){return e&&"object"==typeof e&&!0===e._isSingleNetworkSequenceSigner}}class yo{constructor(e){if(this.signer=e,mo.is(e))throw new Error("WalletUtils does not support SingleNetworkSequenceSigner")}signMessage(e,t,s){return this.signer.signMessage(e,{chainId:t,eip6492:s})}signTypedData(e,t,s,n,i){return this.signer.signTypedData(e,t,s,{chainId:n,eip6492:i})}async isValidSignature(e,t,s,n){return ja(e,t,s,this.signer.getProvider(n))}async isValidMessageSignature(e,t,s,n){const i=this.signer.getProvider(n),r=Ha(t),a=we(r);return ja(e,a,s,i)}isValidTypedDataSignature(e,t,s,n){return this.isValidSignature(e,Re(t),s,n)}}class wo extends t.ethers.providers.BaseProvider{constructor(e,t,s=Ke){super(e.getChainId()),this.client=e,this.providerFor=t,this.networks=s,this.singleNetworkProviders={},this._isSequenceProvider=!0,this.utils=void 0,this.signer=void 0,e.onConnect((e=>{this.emit("connect",e)})),e.onDisconnect((e=>{this.emit("disconnect",e)})),e.onDefaultChainIdChanged((e=>{this.emit("chainChanged",e)})),e.onAccountsChanged((e=>{this.emit("accountsChanged",e)})),this.signer=new po(this.client,this),this.utils=new yo(this.signer)}getSigner(e){return this.signer.getSigner(e)}connect(e){return this.client.connect(e)}disconnect(){return this.client.disconnect()}isConnected(){return this.client.isConnected()}getSession(){return this.client.getSession()}listAccounts(){return[this.client.getAddress()]}getAddress(){return this.client.getAddress()}getNetworks(){return this.client.getNetworks()}getChainId(){return this.client.getChainId()}setDefaultChainId(e){return this.client.setDefaultChainId(this.toChainId(e))}isOpened(){return this.client.isOpened()}closeWallet(){return this.client.closeWallet()}getWalletContext(){return this.client.getWalletContext()}async getWalletConfig(e){const t=await this.useChainId(e);return this.client.getOnchainWalletConfig({chainId:t})}authorize(e){return this.client.connect(a({},e,{authorize:!0}))}async openWallet(e,t){return await this.client.openWallet(e,t),!0}toChainId(e){if(void 0===e)return;const t=ue(this.networks,e);if(!t)throw new Error(`Unsupported network ${e}`);return t.chainId}async useChainId(e){return this.toChainId(e)||this.client.getChainId()}getProvider(e){if(!e)return this;const t=this.toChainId(e);return this.singleNetworkProviders[t]||(this.singleNetworkProviders[t]=new bo(this.client,this.providerFor,t)),this.singleNetworkProviders[t]}async _getSubprovider(e){const t=await this.useChainId(e),s=this.providerFor(t);if(!s)throw new Error(`Unsupported network ${t}`);return s}async perform(e,s){var n;if("eth_chainId"===e)return t.ethers.utils.hexValue(await this.useChainId());if("eth_accounts"===e)return[this.client.getAddress()];if("wallet_switchEthereumChain"===e){const e=vo(s[0]);return this.setDefaultChainId(e)}if("eth_sendTransaction"===e||"eth_sign"===e||"eth_signTypedData"===e||"eth_signTypedData_v4"===e||"personal_sign"===e||"sequence_sign"===e||"sequence_signTypedData_v4"===e)return this.client.send({method:e,params:s},this.getChainId());const i=await this._getSubprovider(),r=null!=(n=i.prepareRequest(e,s))?n:[e,s];return i.send(r[0],r[1])}send(e,t){return this.perform(e,t)}request(e){return this.perform(e.method,e.params)}async detectNetwork(){const e=this.client.getChainId(),t=ue(this.networks,e);if(!t)throw new Error(`Unknown network ${e}`);return t}async waitForTransaction(e,t,s,n){return(await this._getSubprovider(null==n?void 0:n.chainId)).waitForTransaction(e,t,s)}async getBlockNumber(e){return(await this._getSubprovider(null==e?void 0:e.chainId)).getBlockNumber()}async getGasPrice(e){return(await this._getSubprovider(null==e?void 0:e.chainId)).getGasPrice()}async getBalance(e,t,s){return(await this._getSubprovider(null==s?void 0:s.chainId)).getBalance(e,t)}async getTransactionCount(e,t,s){return(await this._getSubprovider(null==s?void 0:s.chainId)).getTransactionCount(e,t)}async getCode(e,t,s){return(await this._getSubprovider(null==s?void 0:s.chainId)).getCode(e,t)}async getStorageAt(e,t,s,n){return(await this._getSubprovider(null==n?void 0:n.chainId)).getStorageAt(e,t,s)}async call(e,t,s){return(await this._getSubprovider(null==s?void 0:s.chainId)).call(e,t)}async estimateGas(e,t){return(await this._getSubprovider(null==t?void 0:t.chainId)).estimateGas(e)}async getBlock(e,t){return(await this._getSubprovider(null==t?void 0:t.chainId)).getBlock(e)}async getTransaction(e,t){return(await this._getSubprovider(null==t?void 0:t.chainId)).getTransaction(e)}async getLogs(e,t){return(await this._getSubprovider(null==t?void 0:t.chainId)).getLogs(e)}async supportsENS(){return(await this.getNetworks()).some((e=>1===e.chainId))}async getResolver(e){if(!await this.supportsENS())return null;return(await this._getSubprovider(1)).getResolver(e)}async resolveName(e){if(t.ethers.utils.isAddress(await e))return e;if(!await this.supportsENS())return null;return(await this._getSubprovider(1)).resolveName(e)}async lookupAddress(e){if(!await this.supportsENS())return null;return(await this._getSubprovider(1)).lookupAddress(e)}async getAvatar(e){if(!await this.supportsENS())return null;return(await this._getSubprovider(1)).getAvatar(e)}}function vo(e){return"object"==typeof e?vo(e.chainId):t.ethers.BigNumber.from(e).toNumber()}wo.is=e=>e&&"object"==typeof e&&!0===e._isSequenceProvider;class bo extends wo{constructor(e,t,s){super(e,t),this.chainId=s,this._isSingleNetworkSequenceProvider=!0}_useChainId(e){const t=this.toChainId(e);if(t&&t!==this.chainId)throw new Error(`This provider only supports the network ${this.chainId}, but ${t} was requested.`);return t||super.toChainId(this.chainId)}useChainId(e){return Promise.resolve(this._useChainId(e))}getChainId(){return super.toChainId(this.chainId)}async getNetwork(){const e=await this.client.getNetworks(),t=ue(e,this.chainId);if(!t)throw new Error(`Unsupported network ${this.chainId}`);return t}getProvider(e){if(this._useChainId(e)!==this.chainId)throw new Error("Unreachable code");return this}getSigner(e){return super.getSigner(this._useChainId(e))}setDefaultChainId(e){throw new Error(`This provider only supports the network ${this.chainId}; use the parent provider to switch networks.`)}static is(e){return e&&"object"==typeof e&&!0===e._isSingleNetworkSequenceProvider}}function Io(e,...t){if(!((s=e)instanceof Uint8Array||null!=s&&"object"==typeof s&&"Uint8Array"===s.constructor.name))throw new Error("Expected Uint8Array");var s;if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Eo(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
function Co(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}const So=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),ko=(e,t)=>e<<32-t|e>>>t;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");const To=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function _o(e){if(!Co(e))throw new Error("Uint8Array expected");let t="";for(let s=0;s<e.length;s++)t+=To[e[s]];return t}function Oo(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!Co(e))throw new Error("expected Uint8Array, got "+typeof e);return e}class No{clone(){return this._cloneInto()}}function Ao(e){const t=t=>e().update(Oo(t)).digest(),s=e();return t.outputLen=s.outputLen,t.blockLen=s.blockLen,t.create=()=>e(),t}class xo extends No{constructor(e,t,s,n){super(),this.blockLen=e,this.outputLen=t,this.padOffset=s,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=So(this.buffer)}update(e){Eo(this);const{view:t,buffer:s,blockLen:n}=this,i=(e=Oo(e)).length;for(let r=0;r<i;){const a=Math.min(n-this.pos,i-r);if(a!==n)s.set(e.subarray(r,r+a),this.pos),this.pos+=a,r+=a,this.pos===n&&(this.process(t,0),this.pos=0);else{const t=So(e);for(;n<=i-r;r+=n)this.process(t,r)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){Eo(this),function(e,t){Io(e);const s=t.outputLen;if(e.length<s)throw new Error(`digestInto() expects output buffer of length at least ${s}`)}(e,this),this.finished=!0;const{buffer:t,view:s,blockLen:n,isLE:i}=this;let{pos:r}=this;t[r++]=128,this.buffer.subarray(r).fill(0),this.padOffset>n-r&&(this.process(s,0),r=0);for(let e=r;e<n;e++)t[e]=0;!function(e,t,s,n){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,s,n);const i=BigInt(32),r=BigInt(4294967295),a=Number(s>>i&r),o=Number(s&r),c=n?4:0,h=n?0:4;e.setUint32(t+c,a,n),e.setUint32(t+h,o,n)}(s,n-8,BigInt(8*this.length),i),this.process(s,0);const a=So(e),o=this.outputLen;if(o%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=o/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)a.setUint32(4*e,h[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const s=e.slice(0,t);return this.destroy(),s}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:s,length:n,finished:i,destroyed:r,pos:a}=this;return e.length=n,e.pos=a,e.finished=i,e.destroyed=r,n%t&&e.buffer.set(s),e}}const Po=(e,t,s)=>e&t^e&s^t&s,Mo=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ro=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Lo=new Uint32Array(64);class Do extends xo{constructor(){super(64,32,8,!1),this.A=0|Ro[0],this.B=0|Ro[1],this.C=0|Ro[2],this.D=0|Ro[3],this.E=0|Ro[4],this.F=0|Ro[5],this.G=0|Ro[6],this.H=0|Ro[7]}get(){const{A:e,B:t,C:s,D:n,E:i,F:r,G:a,H:o}=this;return[e,t,s,n,i,r,a,o]}set(e,t,s,n,i,r,a,o){this.A=0|e,this.B=0|t,this.C=0|s,this.D=0|n,this.E=0|i,this.F=0|r,this.G=0|a,this.H=0|o}process(e,t){for(let s=0;s<16;s++,t+=4)Lo[s]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=Lo[e-15],s=Lo[e-2],n=ko(t,7)^ko(t,18)^t>>>3,i=ko(s,17)^ko(s,19)^s>>>10;Lo[e]=i+Lo[e-7]+n+Lo[e-16]|0}let{A:s,B:n,C:i,D:r,E:a,F:o,G:c,H:h}=this;for(let e=0;e<64;e++){const t=h+(ko(a,6)^ko(a,11)^ko(a,25))+((l=a)&o^~l&c)+Mo[e]+Lo[e]|0,d=(ko(s,2)^ko(s,13)^ko(s,22))+Po(s,n,i)|0;h=c,c=o,o=a,a=r+t|0,r=i,i=n,n=s,s=t+d|0}var l;s=s+this.A|0,n=n+this.B|0,i=i+this.C|0,r=r+this.D|0,a=a+this.E|0,o=o+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(s,n,i,r,a,o,c,h)}roundClean(){Lo.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Bo=Ao((()=>new Do));var Uo=class{hostname;fetch;path="/rpc/Databeat/";constructor(e,t){this.hostname=e,this.fetch=(e,s)=>t(e,s)}url(e){return this.hostname+this.path+e}ping=(e,t)=>this.fetch(this.url("Ping"),Ho({},e,t)).then((e=>jo(e).then((e=>({status:e.status})))),(e=>{throw qo.new({cause:`fetch(): ${e.message||""}`})}));version=(e,t)=>this.fetch(this.url("Version"),Ho({},e,t)).then((e=>jo(e).then((e=>({version:e.version})))),(e=>{throw qo.new({cause:`fetch(): ${e.message||""}`})}));runtimeStatus=(e,t)=>this.fetch(this.url("RuntimeStatus"),Ho({},e,t)).then((e=>jo(e).then((e=>({status:e.status})))),(e=>{throw qo.new({cause:`fetch(): ${e.message||""}`})}));tick=(e,t,s)=>this.fetch(this.url("Tick"),Ho(e,t,s)).then((e=>jo(e).then((e=>({ok:e.ok})))),(e=>{throw qo.new({cause:`fetch(): ${e.message||""}`})}));rawEvents=(e,t,s)=>this.fetch(this.url("RawEvents"),Ho(e,t,s)).then((e=>jo(e).then((e=>({ok:e.ok})))),(e=>{throw qo.new({cause:`fetch(): ${e.message||""}`})}))},Ho=(e={},t={},s=null)=>({method:"POST",headers:{...t,"Content-Type":"application/json"},body:JSON.stringify(e||{}),signal:s}),jo=e=>e.text().then((t=>{let s;try{s=JSON.parse(t)}catch(s){let n="";throw s instanceof Error&&(n=s.message),$o.new({status:e.status,cause:`JSON.parse(): ${n}: response text: ${t}`})}if(!e.ok){const e="number"==typeof s.code?s.code:0;throw(Fo[e]||Wo).new(s)}return s})),Wo=class e extends Error{name;code;message;status;cause;msg;constructor(t,s,n,i,r){super(n),this.name=t||"WebrpcError",this.code="number"==typeof s?s:0,this.message=n||`endpoint error ${this.code}`,this.msg=this.message,this.status="number"==typeof i?i:0,this.cause=r,Object.setPrototypeOf(this,e.prototype)}static new(e){return new this(e.error,e.code,e.message||e.msg,e.status,e.cause)}},qo=class e extends Wo{constructor(t="WebrpcRequestFailed",s=-1,n="request failed",i=0,r){super(t,s,n,i,r),Object.setPrototypeOf(this,e.prototype)}},$o=class e extends Wo{constructor(t="WebrpcBadResponse",s=-5,n="bad response",i=0,r){super(t,s,n,i,r),Object.setPrototypeOf(this,e.prototype)}},Fo={0:class e extends Wo{constructor(t="WebrpcEndpoint",s=0,n="endpoint error",i=0,r){super(t,s,n,i,r),Object.setPrototypeOf(this,e.prototype)}},[-1]:qo,[-2]:class e extends Wo{constructor(t="WebrpcBadRoute",s=-2,n="bad route",i=0,r){super(t,s,n,i,r),Object.setPrototypeOf(this,e.prototype)}},[-3]:class e extends Wo{constructor(t="WebrpcBadMethod",s=-3,n="bad method",i=0,r){super(t,s,n,i,r),Object.setPrototypeOf(this,e.prototype)}},[-4]:class e extends Wo{constructor(t="WebrpcBadRequest",s=-4,n="bad request",i=0,r){super(t,s,n,i,r),Object.setPrototypeOf(this,e.prototype)}},[-5]:$o,[-6]:class e extends Wo{constructor(t="WebrpcServerPanic",s=-6,n="server panic",i=0,r){super(t,s,n,i,r),Object.setPrototypeOf(this,e.prototype)}},[-7]:class e extends Wo{constructor(t="WebrpcInternalError",s=-7,n="internal error",i=0,r){super(t,s,n,i,r),Object.setPrototypeOf(this,e.prototype)}},[-8]:class e extends Wo{constructor(t="WebrpcClientDisconnected",s=-8,n="client disconnected",i=0,r){super(t,s,n,i,r),Object.setPrototypeOf(this,e.prototype)}},[-9]:class e extends Wo{constructor(t="WebrpcStreamLost",s=-9,n="stream lost",i=0,r){super(t,s,n,i,r),Object.setPrototypeOf(this,e.prototype)}},[-10]:class e extends Wo{constructor(t="WebrpcStreamFinished",s=-10,n="stream finished",i=0,r){super(t,s,n,i,r),Object.setPrototypeOf(this,e.prototype)}},1e3:class e extends Wo{constructor(t="Unauthorized",s=1e3,n="Unauthorized access",i=0,r){super(t,s,n,i,r),Object.setPrototypeOf(this,e.prototype)}},2e3:class e extends Wo{constructor(t="PermissionDenied",s=2e3,n="Permission denied",i=0,r){super(t,s,n,i,r),Object.setPrototypeOf(this,e.prototype)}},2001:class e extends Wo{constructor(t="SessionExpired",s=2001,n="Session expired",i=0,r){super(t,s,n,i,r),Object.setPrototypeOf(this,e.prototype)}},3e3:class e extends Wo{constructor(t="NotFound",s=3e3,n="Resource not found",i=0,r){super(t,s,n,i,r),Object.setPrototypeOf(this,e.prototype)}},4e3:class e extends Wo{constructor(t="InvalidAppKey",s=4e3,n="Invalid app key",i=0,r){super(t,s,n,i,r),Object.setPrototypeOf(this,e.prototype)}},4001:class e extends Wo{constructor(t="QueryFailed",s=4001,n="DB query failed",i=0,r){super(t,s,n,i,r),Object.setPrototypeOf(this,e.prototype)}},4002:class e extends Wo{constructor(t="InvalidProjectId",s=4002,n="Invalid project id",i=0,r){super(t,s,n,i,r),Object.setPrototypeOf(this,e.prototype)}}},Go=class extends Uo{constructor(e,t){const s="object"==typeof global?global.fetch.bind(global):window.fetch.bind(window);super(e.endsWith("/")?e.slice(0,-1):e,s),this.auth=t,this._globalFetch=s,this.fetch=this._fetch}_globalFetch;_fetch=(e,t)=>{if(this.auth){let e={};this.auth.jwt?.length>0&&(e.Authorization=`BEARER ${this.auth.jwt}`),this.auth.headers&&(e={...e,...this.auth.headers}),t.headers={...t.headers,...e}}return this._globalFetch(e,t)}},Vo={defaultEnabled:!0,noop:!1,privacy:{userIdHash:!0,userAgentSalt:!1},userIdentTracking:!1,strictMode:!1,flushInterval:500,initProps:()=>({})},Ko=class{rpc;auth;options;enabled;ident;userId;sessionId;allowUserTracking;projectId;queue;flushTimeout;defaultProps;previousPageKey;ts;constructor(e,t,s){this.auth=t,this.rpc=new Go(e,t),this.options=Vo,s&&(this.options={defaultEnabled:s.defaultEnabled||Vo.defaultEnabled,projectId:s.projectId||null,privacy:s.privacy||Vo.privacy,userIdentTracking:s.userIdentTracking||Vo.userIdentTracking,strictMode:s.strictMode||Vo.strictMode,flushInterval:s.flushInterval||Vo.flushInterval,noop:s.noop||!1,initProps:s.initProps||Vo.initProps}),this.init()}init(){this.enabled=zo(this.options.defaultEnabled,this.auth),this.projectId=this.options.projectId||null,this.userId=null,this.sessionId=nc(),this.queue=[],this.flushTimeout=null,this.defaultProps={...Qo(),...this.options.initProps()},this.identify()}reset(e){this.enabled=zo(this.options.defaultEnabled,this.auth),this.userId&&!this.isAnon()&&(this.userId=null),this.ident=0,this.ts=tc({on:this.enabled,id:this.userId,it:this.ident,ut:this.allowUserTracking}),!0!==e&&this.init()}identify(e,t){if(Jo()){if(t&&void 0!==t.allowTracking&&this.allowTracking(t.allowTracking),!e){const e=ec();null!==e&&null!==e.id&&(this.userId=e.id,this.ident=e.it,this.allowUserTracking=e.ut,void 0===e.it?(this.userId.startsWith("anon:")?this.ident=0:this.ident=1,this.ts=tc({on:this.enabled,id:this.userId,it:this.ident,ut:this.allowUserTracking})):this.ident=e.it)}if(e||null===this.userId){const t=sc(e,this.allowUserTracking,this.options);this.userId=t.userId,this.ident=t.ident,this.ts=tc({on:this.enabled,id:this.userId,it:this.ident,ut:this.allowUserTracking})}this.track({event:"INIT",source:Zo(),props:this.defaultProps}),this.flush()}}allowTracking(e){this.allowUserTracking=e,tc({on:this.enabled,id:this.userId,it:this.ident,ut:this.allowUserTracking}),this.options.strictMode&&(e?this.enable():this.disable())}async track(e,t){if(Jo()&&null===this.userId)throw new Error("databeat: init first");if(Array.isArray(e)){for(let t=0;t<e.length;t++)e[t].ident=this.ident,e[t].userId=this.userId,e[t].sessionId=this.sessionId,!e[t].projectId&&this.projectId&&(e[t].projectId=this.projectId);this.queue.push(...e)}else e.ident=this.ident,e.userId=this.userId,e.sessionId=this.sessionId,!e.projectId&&this.projectId&&(e.projectId=this.projectId),this.queue.push(e);this.queue.length>150&&(this.queue=this.queue.splice(this.queue.length-150)),this.enabled&&(t&&t.flush?await this.flush():null===this.flushTimeout&&(this.flushTimeout=setTimeout((()=>{this.flush()}),this.options.flushInterval)))}trackView(e={}){const t={...this.defaultProps,...e},s=Zo(),n=`${s}:${JSON.stringify(t)}:${this.userId}:${this.sessionId}`;this.previousPageKey!==n&&(this.previousPageKey=n,this.track({event:"VIEW",source:s,props:t}))}flush=async()=>{if(null!==this.flushTimeout&&(clearTimeout(this.flushTimeout),this.flushTimeout=null),!this.enabled)return;if(this.options.noop)return;if(this.options.strictMode&&!this.allowUserTracking)return;if(0===this.queue.length)return;const e=this.dedupedQueue();this.queue=[];try{await this.rpc.tick({events:e})}catch(e){console.warn(`databeat flush failed: ${e}`)}};isEnabled(){return this.enabled}isAnon(){return 0===this.ident}getIdent(){return this.ident}getUserId(){return this.userId}getSessionId(){return this.sessionId}getStorageTS(){if(this.ts)return this.ts;const e=ec();return null!=e&&null!==e.id?(this.ts=e.ts,this.ts):void 0}enable(){Yo(this.auth)?Jo()&&(this.enabled=!0,this.ts=tc({on:this.enabled,id:this.userId,it:this.ident,ut:this.allowUserTracking}),this.identify()):this.enabled=!1}disable(){Jo()&&(this.enabled=!1,this.ts=tc({on:this.enabled,id:this.userId,it:this.ident,ut:this.allowUserTracking}))}dedupedQueue=()=>{const e=new Map;for(let t=0;t<this.queue.length;t++){const s=this.queue[t],n=`${s.event}:${s.source}:${s.userId}:${s.sessionId}:${JSON.stringify(s.props)}:${JSON.stringify(s.nums)}`;e.has(n)||e.set(n,s)}return Array.from(e.values())}},Jo=()=>"object"==="object".localStorage&&"function"==="object".localStorage.getItem&&"function"==="object".localStorage.setItem,zo=(e,t)=>{if(!Yo(t))return!1;if(!Jo())return!0;const s=ec();return null===s?null==e||e:s.on},Yo=e=>e?.jwt?.length>0||!!(e?.headers&&Object.keys(e.headers).length>0),Zo=()=>{try{return window.location.pathname}catch(e){return""}},Qo=()=>{if(!Jo())return{};const e=new URL(window.location.href).searchParams,t={};return t.origin=window.location.origin,e.get("ref")&&""!==e.get("ref")&&(t.ref=e.get("ref")||""),e.get("source")&&""!==e.get("source")&&(t.source=e.get("source")||""),e.get("utm_source")&&""!==e.get("utm_source")&&(t.utmSource=e.get("utm_source")||""),e.get("utm_campaign")&&""!==e.get("utm_campaign")&&(t.utmCampaign=e.get("utm_campaign")||""),e.get("utm_medium")&&""!==e.get("utm_medium")&&(t.utmMedium=e.get("utm_medium")||""),e.get("utm_content")&&""!==e.get("utm_content")&&(t.utmContent=e.get("utm_content")||""),e.get("utm_term")&&""!==e.get("utm_term")&&(t.utmTerm=e.get("utm_term")||""),document.referrer&&""!==document.referrer&&(t.referrer=document.referrer),e.get("gclid")&&""!==e.get("gclid")&&(t.gclid=e.get("gclid")||""),t},Xo="_dbeat",ec=()=>{try{return JSON.parse(window.localStorage.getItem(Xo))}catch(e){return null}},tc=e=>{try{return e.ts||(e.ts=Math.floor(Date.now()/1e3)),window.localStorage.setItem(Xo,JSON.stringify(e)),e.ts}catch(e){return}},sc=(e,t,s)=>{if(!e||null===e||""===e){return{userId:`${Math.floor(1e14*Math.random())}`,ident:0}}if(s.userIdentTracking&&t)return{userId:e,ident:2};if(!0!==s.privacy.userIdHash&&s.userIdentTracking&&t)throw new Error("invalid configuration");return Jo()&&!0===s.privacy.userAgentSalt&&(e=e+":"+navigator.userAgent),s.privacy.extraSalt&&s.privacy.extraSalt.length>0&&(e=e+":"+s.privacy.extraSalt),{userId:_o(Bo(e)).substring(0,50),ident:1}},nc=()=>{if(Jo()&&"object"==="object".sessionStorage&&"function"==="object".sessionStorage.getItem&&"function"==="object".sessionStorage.setItem){const e=window.sessionStorage.getItem(Xo);if(e&&e.length>0)return e;{const e=ic(16);return window.sessionStorage.setItem(Xo,e),e}}return ic(16)},ic=e=>{let t="";for(let s=0;s<e;s++)t+=Math.floor(16*Math.random()).toString(16);return"0x"+t};"object"==typeof process&&process.version&&process.version<"v18"&&(console.error(`ERROR! expecting node v18+ but your node version is reporting ${process.version}`),process&&process.exit&&process.exit(1));class rc extends Ko{}var ac="1.8.8";class oc{constructor(e){this.store=e}connectedSession(){const e=this.getSession();if(e&&e.accountAddress&&e.walletContext&&e.networks)return{accountAddress:e.accountAddress,walletContext:e.walletContext,networks:e.networks};throw new Error("Sequence session not connected")}hasSession(){var e;return void 0!==(null==(e=this.getSession())?void 0:e.accountAddress)}setSession(e){return this.store.setItem(oc.SESSION_LOCALSTORE_KEY,JSON.stringify(e))}getSession(){const e=this.store.getItem(oc.SESSION_LOCALSTORE_KEY);if(e)return JSON.parse(e)}async clearSession(){return this.store.removeItem(oc.SESSION_LOCALSTORE_KEY)}}oc.SESSION_LOCALSTORE_KEY="@sequence.session";class cc{constructor(e,t=1){this.store=e,this.startingChainId=t,this.callbacks=[],e.onItemChange(cc.SESSION_CHAIN_ID_KEY,(e=>{if(e){const t=parseInt(e);this.callbacks.forEach((e=>e(t)))}}))}onDefaultChainIdChanged(e){return this.callbacks.push(e),()=>{this.callbacks=this.callbacks.filter((t=>t!==e))}}setDefaultChainId(e){e!==this.getDefaultChainId()&&this.store.setItem(cc.SESSION_CHAIN_ID_KEY,e.toString())}getDefaultChainId(){const e=this.store.getItem(cc.SESSION_CHAIN_ID_KEY);return e&&0!==e.length?parseInt(e):this.startingChainId}}cc.SESSION_CHAIN_ID_KEY="@sequence.session.defaultChainId";class hc{constructor(e,s,n){var i,r;if(this.session=void 0,this.defaultChainId=void 0,this.callbacks={},this.transport=void 0,this.defaultEIP6492=void 0,this.projectAccessKey=void 0,this.analytics=void 0,ho(e))this.transport=lo.new(e);else{if(!Ca(e))throw new Error("Invalid transport");this.transport=e}const o=null==n?void 0:n.defaultChainId;var c,h;(this.defaultEIP6492=null!=(i=null==n?void 0:n.defaultEIP6492)&&i,this.session=new oc(s),this.defaultChainId=new cc(s,o),this.transport.on("accountsChanged",(e=>{var t;e.length>1&&console.warn("SequenceClient: wallet-webapp returned more than one account"),null==(t=this.callbacks.accountsChanged)||t.forEach((t=>t(e)))})),this.transport.on("connect",(e=>{var s;const n=t.ethers.utils.hexValue(this.getChainId());null==(s=this.callbacks.connect)||s.forEach((t=>t(a({},e,{chainId:n}))))})),this.transport.on("disconnect",((e,t)=>{var s;null==(s=this.callbacks.disconnect)||s.forEach((s=>s(e,t)))})),this.transport.on("networks",(e=>{var t;null==(t=this.callbacks.networks)||t.forEach((t=>t(e)))})),this.transport.on("walletContext",(e=>{var t;null==(t=this.callbacks.walletContext)||t.forEach((t=>t(e)))})),this.transport.on("open",(e=>{var t;null==(t=this.callbacks.open)||t.forEach((t=>t(e)))})),this.transport.on("close",(()=>{var e;null==(e=this.callbacks.close)||e.forEach((e=>e()))})),this.transport.on("chainChanged",((e,t)=>{var s;null==(s=this.callbacks.chainChanged)||s.forEach((s=>s(e,t)))})),this.defaultChainId.onDefaultChainIdChanged((e=>{var s;const n=t.ethers.utils.hexValue(e);null==(s=this.callbacks.chainChanged)||s.forEach((e=>e(n)))})),null!=n&&n.projectAccessKey&&(this.projectAccessKey=n.projectAccessKey),this.projectAccessKey&&null!=n&&n.analytics&&(this.analytics=((e,t)=>{t||(t="https://nodes.sequence.app");const s=!e,n={};return e&&(n.headers={"X-Access-Key":e}),new rc(t,n,{noop:s,defaultEnabled:!0,privacy:{userIdHash:!0,userAgentSalt:!1},initProps:()=>Jo()?{origin:window.location.origin}:{}})})(this.projectAccessKey)),null!=(r=this.session.getSession())&&r.accountAddress)&&(null==(c=this.analytics)||c.identify(null==(h=this.session.getSession())?void 0:h.accountAddress))}registerCallback(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),()=>{this.callbacks[e]=this.callbacks[e].filter((e=>e!==t))}}onOpen(e){return this.registerCallback("open",e)}onClose(e){return this.registerCallback("close",e)}onConnect(e){return this.registerCallback("connect",e)}onDisconnect(e){return this.registerCallback("disconnect",e)}onNetworks(e){return this.registerCallback("networks",e)}onAccountsChanged(e){return this.registerCallback("accountsChanged",e)}onWalletContext(e){return this.registerCallback("walletContext",e)}onChainChanged(e){return this.registerCallback("chainChanged",e)}onDefaultChainIdChanged(e){return this.registerCallback("chainChanged",e)}getChainId(){return this.defaultChainId.getDefaultChainId()}setDefaultChainId(e){return this.defaultChainId.setDefaultChainId(e)}async openWallet(e,t){return this.transport.openWallet(e,t,this.getChainId()),await this.transport.waitUntilOpened(),this.isOpened()}closeWallet(){return this.transport.closeWallet()}isOpened(){return this.transport.isOpened()}isConnected(){return this.session.hasSession()}getSession(){return this.session.getSession()}getAddress(){return this.session.connectedSession().accountAddress}async connect(e){if(void 0===(null==e?void 0:e.authorizeVersion)&&(e.authorizeVersion=2),!0===(null==e?void 0:e.refresh)&&this.disconnect(),e.projectAccessKey=this.projectAccessKey,e&&e.authorize){if(!e.app)throw new Error("connecting with 'authorize' option also requires 'app' to be set");void 0===e.authorizeVersion&&(e.authorizeVersion=2)}await this.openWallet(void 0,{type:"connect",options:a({},e,{networkId:this.getChainId(),clientVersion:ac})});const s=await this.transport.waitUntilConnected().catch((e=>e instanceof Error?{connected:!1,error:e.message}:{connected:!1,error:JSON.stringify(e)}));if(s.chainId&&(s.chainId=t.ethers.BigNumber.from(s.chainId).toString()),s.connected){var n,i;if(!s.session)throw new Error("impossible state, connect response is missing session");if(this.session.setSession(s.session),null!=(n=s.session)&&n.accountAddress)null==(i=this.analytics)||i.identify(s.session.accountAddress)}return s}disconnect(){var e;return this.isOpened()&&this.closeWallet(),null==(e=this.analytics)||e.reset(),this.session.clearSession()}send(e,t){return e.method=this.mapSignMethod(e.method),new Promise(((s,n)=>{this.transport.sendAsync(e,((t,i)=>{t?n(t):void 0===i?n(new Error(`Got undefined response for request: ${e}`)):"object"==typeof i&&i.error?n(i.error):"object"==typeof i&&i.result?s(i.result):n(new Error(`Got invalid response for request: ${e}`))}),t||this.getChainId())}))}async getNetworks(e){const t=this.session.connectedSession();return e&&(t.networks=await this.send({method:"sequence_getNetworks"}),this.session.setSession(t)),t.networks}signMethod(e){return void 0===(null==e?void 0:e.eip6492)?"personal_sign":e.eip6492?"sequence_sign":"legacy_sign"}signTypedDataMethod(e){return void 0===(null==e?void 0:e.eip6492)?"eth_signTypedData_v4":e.eip6492?"sequence_signTypedData_v4":"legacy_signTypedData_v4"}mapSignMethod(e){return"personal_sign"===e?this.defaultEIP6492?"sequence_sign":"personal_sign":"eth_signTypedData_v4"===e?this.defaultEIP6492?"sequence_signTypedData_v4":"eth_signTypedData_v4":"legacy_sign"===e?"personal_sign":"legacy_signTypedData_v4"===e?"eth_signTypedData_v4":e}async signMessage(e,t){var s;const n=this.signMethod(t);return null==(s=this.analytics)||s.track({event:"SIGN_MESSAGE_REQUEST",props:{chainId:`${(null==t?void 0:t.chainId)||this.getChainId()}`}}),this.send({method:n,params:[e,this.getAddress()]},null==t?void 0:t.chainId)}async signTypedData(e,s){var n;const i=this.signTypedDataMethod(s),r=t.ethers.utils._TypedDataEncoder.getPayload(e.domain,e.types,e.message);return null==(n=this.analytics)||n.track({event:"SIGN_TYPED_DATA_REQUEST",props:{chainId:`${(null==s?void 0:s.chainId)||this.getChainId()}`}}),this.send({method:i,params:[this.getAddress(),r]},(null==s?void 0:s.chainId)||e.domain.chainId&&t.ethers.BigNumber.from(e.domain.chainId).toNumber()||this.getChainId())}async sendTransaction(e,t){var s;const n=function(e){if(0===e.length)throw new Error("No transaction provided");const[t,...s]=e;return a({},t,{auxiliary:s})}(Array.isArray(e)?e:[e]);return null==(s=this.analytics)||s.track({event:"SEND_TRANSACTION_REQUEST",props:{chainId:`${(null==t?void 0:t.chainId)||this.getChainId()}`}}),this.send({method:"eth_sendTransaction",params:[n]},null==t?void 0:t.chainId)}async getWalletContext(){return this.send({method:"sequence_getWalletContext"})}async getOnchainWalletConfig(e){const t=await this.send({method:"sequence_getWalletConfig",params:[(null==e?void 0:e.chainId)||this.getChainId()]},null==e?void 0:e.chainId);return Array.isArray(t)?t[0]:t}}const lc={transports:{walletAppURL:"https://sequence.app",windowTransport:{enabled:!0},proxyTransport:{enabled:!1}},defaultNetwork:1,analytics:!0};let dc;const uc=(e,s)=>{var n,i,r;if(!e||"string"!=typeof e)throw new Error("Please pass a projectAccessKey in initWallet.");if(dc)return dc;const o=a({},lc,s,{transports:a({},lc.transports,null==s?void 0:s.transports)}),c={},h=null!=(n=null==(i=o.networks)?void 0:i.filter((e=>{void 0!==e.rpcUrl&&void 0!==e.chainId&&Ke.find((t=>t.chainId===e.chainId))})))?n:[],l=Ke.map((e=>{var t;const s=null==(t=o.networks)?void 0:t.find((t=>t.chainId===e.chainId));return s?a({},e,s):e})).concat(h).map((t=>(t.rpcUrl=t.rpcUrl+`/${e}`,t))),d=o.defaultNetwork?null==(r=ue(l,o.defaultNetwork))?void 0:r.chainId:void 0;if(!d&&o.defaultNetwork)throw new Error(`defaultNetwork not found for chainId: ${o.defaultNetwork}`);const u=o.localStorage||Ja(),f=new hc(o.transports,u,{defaultChainId:d,defaultEIP6492:o.defaultEIP6492,projectAccessKey:e,analytics:o.analytics});return dc=new wo(f,(e=>{if(!c[e]){var s;const n=null==(s=l.find((t=>t.chainId===e)))?void 0:s.rpcUrl;if(!n)throw new Error(`no rpcUrl found for chainId: ${e}`);const i=new t.ethers.providers.JsonRpcProvider(n),r=new ze([rt,it,new st],new et(i));c[e]=new t.ethers.providers.Web3Provider(r,e)}return c[e]})),dc},fc=()=>{dc&&(dc.client.closeWallet(),dc.client.transport.unregister(),dc=void 0)},gc=()=>{if(!dc)throw new Error("Wallet has not been initialized, call sequence.initWallet(config) first.");return dc};var pc=Object.freeze({__proto__:null,PROVIDER_OPEN_TIMEOUT:Aa,nextMessageIdx:Pa,BaseProviderTransport:Ma,BaseWalletTransport:Za,ProxyMessageChannel:class{constructor(){this.app=void 0,this.wallet=void 0;const e=new Qa,t=new Qa;e.conn=t,t.conn=e,this.app=e,this.wallet=t}},ProxyMessageChannelPort:Qa,ProxyMessageProvider:Xa,ProxyMessageHandler:class extends Za{constructor(e,t){super(e),this.port=void 0,this.port=t,this._init=_a.OK}register(){this.port.handleMessage=e=>{this.handleMessage(e)},this._registered=!0}async restoreSession(){const e=await this.getCachedTransportSession();e&&this.open(e)}unregister(){this.port.handleMessage=void 0,this._registered=!1}sendMessage(e){this.port.sendMessage(e)}},isMuxTransportTemplate:ho,MuxMessageProvider:lo,WindowMessageProvider:co,WindowMessageHandler:class extends Za{constructor(e){var t;super(e),t=this,this.parentWindow=void 0,this._isPopup=!1,this.onWindowEvent=async function(e){if(!e.origin||""===e.origin)return;if(t.appOrigin&&e.origin!==t.appOrigin)return;let s;try{s=JSON.parse(e.data)}catch(e){return}ke.debug("RECEIVED MESSAGE",s),t._init!==_a.OK&&t.isValidInitAck(s)&&(t.appOrigin=e.origin),t._init!==_a.OK||t.appOrigin&&!(t.appOrigin.length<8)?t.handleMessage(s):ke.error("impossible state, init.OK and appOrigin required")},this.getWindowTransportSession=e=>{const t=new Sa(e);return{sessionId:t.get("sid"),networkId:t.get("net"),intent:me(t.get("intent"))}},this._init=_a.NIL}async register(e){const t=null!==parent.window.opener;if(this._isPopup=t,!0!==t)return;const{pathname:s,search:n}=new URL(e||window.location.href);let i=this.getWindowTransportSession(n);!!i.sessionId||(i=await this.getCachedTransportSession()),i?(this.parentWindow=parent.window.opener,window.addEventListener("message",this.onWindowEvent,!1),this._registered=!0,this.open(i).then((e=>{if(!e){var t;const e=`failed to open to network ${null==(t=i)?void 0:t.networkId}`;ke.error(e),this.notifyClose({message:e}),window.close()}})).catch((e=>{var t;const s=`failed to open to network ${null==(t=i)?void 0:t.networkId}, due to: ${e}`;ke.error(s),this.notifyClose({message:s}),window.close()}))):ke.error("window session is undefined")}unregister(){window.removeEventListener("message",this.onWindowEvent),this._registered=!1}sendMessage(e){const t=JSON.stringify(e);e.type===ka.INIT?this.postMessage(t,!0):this.postMessage(t)}get isPopup(){return this._isPopup}postMessage(e,t=!1){!0===t||this._init===_a.OK?t?this.parentWindow.postMessage(e,"*"):this.appOrigin&&this.appOrigin.length>4?this.parentWindow.postMessage(e,this.appOrigin):ke.error("unable to postMessage as parentOrigin is invalid"):ke.error("impossible state, should not be calling postMessage until inited")}},WalletRequestHandler:class{constructor(e,s,n){var i=this;this.account=void 0,this.signerReadyCallbacks=[],this.prompter=void 0,this.networks=void 0,this._openIntent=void 0,this._connectOptions=void 0,this.events=new Ea.EventEmitter2,this.onConnectOptionsChange=void 0,this.promptConnect=async function(e){if(!e&&!i._connectOptions)throw new Error("prompter connect options are empty");if(!i.prompter)return i.connect(e);const t=await i.prompter.promptConnect(e||i._connectOptions).catch((e=>({connected:!1}))),s=t;return s.connected&&!s.session&&(s.session=await i.walletSession(null==e?void 0:e.networkId)),t},this.sendAsync=async function(e,s,n){const r={jsonrpc:"2.0",id:e.id,result:null};await i.getAccount();try{var o;if(!(i.account&&null!==i.account||go.includes(e.method)))throw Na;const s=i.account;if(!s)throw new Error("WalletRequestHandler: wallet account is not configured");const a=null==(o=i.account)?void 0:o.providerFor(null!=n?n:i.defaultChainId());if(!a)throw new Error(`WalletRequestHandler: wallet provider is not configured for chainId ${n}`);const h=a instanceof t.ethers.providers.JsonRpcProvider?a:void 0;switch(e.method){case"net_version":{if(!h)throw new Error("Account provider doesn't support send method");const e=await h.send("net_version",[]);r.result=e;break}case"eth_chainId":{if(!h)throw new Error("Account provider doesn't support send method");const e=await h.send("eth_chainId",[]);r.result=e;break}case"eth_accounts":{const e=s.address;r.result=[e];break}case"eth_getBalance":{const[t,s]=e.params,n=await a.getBalance(t,s);r.result=n.toHexString();break}case"sequence_sign":case"personal_sign":case"eth_sign":{let t;switch(e.method){case"sequence_sign":case"personal_sign":{const[s,n]=e.params;t=s;break}case"eth_sign":{const[s,n]=e.params;t=n;break}}let a="";const o=Ha(t),c="sequence_sign"===e.method;if(a=null===i.prompter?await s.signMessage(o,null!=n?n:i.defaultChainId(),c?"eip6492":"ignore"):await i.prompter.promptSignMessage({chainId:n,message:o,eip6492:c},i.connectOptions),!(a&&a.length>0))throw new Error("declined by user");r.result=a;break}case"sequence_signTypedData_v4":case"eth_signTypedData":case"eth_signTypedData_v4":{const[t,a]=e.params;let o;if("string"==typeof a)try{o=JSON.parse(a)}catch(e){console.warn("walletRequestHandler: error parsing typedData",e)}else o=a;if(!(o&&o.domain&&o.types&&o.message))throw new Error("invalid typedData object");let c="";const h="sequence_signTypedData_v4"===e.method;if(c=null===i.prompter?await s.signTypedData(o.domain,o.types,o.message,null!=n?n:i.defaultChainId(),h?"eip6492":"ignore"):await i.prompter.promptSignMessage({chainId:n,typedData:o,eip6492:h},i.connectOptions),!(c&&c.length>0))throw new Error("declined by user");r.result=c;break}case"eth_sendTransaction":{const t=function(e){return[e,...e.auxiliary||[]]}(e.params[0]).map((e=>("gas"in e&&void 0===e.gasLimit&&(e.gasLimit=e.gas,delete e.gas),e)));uo(s.address,t);let a="";if(null===i.prompter){var c;const e=await s.sendTransaction(t,null!=n?n:i.defaultChainId());a=null!=(c=null==e?void 0:e.hash)?c:""}else a=await i.prompter.promptSendTransaction(t,n,i.connectOptions);if(!a)throw new Error("declined by user");r.result=a;break}case"eth_signTransaction":{const[a]=e.params;if(t.ethers.utils.getAddress(a.from)!==s.address)throw new Error("sender address does not match wallet");uo(s.address,a),null===i.prompter?r.result=await s.signTransactions(a,null!=n?n:i.defaultChainId()):r.result=await i.prompter.promptSignTransaction(a,n,i.connectOptions);break}case"eth_sendRawTransaction":if(wn(e.params[0])){const n=t.BigNumber.from(e.params[0].chainId).toNumber(),i=await s.relayer(n).relay(e.params[0]);r.result=i.hash}else{const t=await a.sendTransaction(e.params[0]);r.result=t.hash}break;case"eth_getTransactionCount":{const s=t.ethers.utils.getAddress(e.params[0]),n=e.params[1],i=await a.getTransactionCount(s,n);r.result=t.ethers.BigNumber.from(i).toHexString();break}case"eth_blockNumber":r.result=await a.getBlockNumber();break;case"eth_getBlockByNumber":case"eth_getBlockByHash":r.result=await a.getBlock(e.params[0]);break;case"eth_getTransactionByHash":r.result=await a.getTransaction(e.params[0]);break;case"eth_call":{const[t,s]=e.params;r.result=await a.call(t,s);break}case"eth_getCode":{const[t,s]=e.params;r.result=await a.getCode(t,s);break}case"eth_estimateGas":{const[t]=e.params;r.result=await a.estimateGas(t);break}case"eth_gasPrice":{const e=await a.getGasPrice();r.result=e.toHexString();break}case"wallet_switchEthereumChain":{const[s]=e.params;if(!s.chainId||0===s.chainId.length)throw new Error("invalid chainId");const n=t.ethers.BigNumber.from(s.chainId);i.setDefaultChainId(n.toNumber()),r.result=null;break}case"sequence_getWalletContext":r.result=s.contexts;break;case"sequence_getWalletConfig":{const[t]=e.params;r.result=t?[(await s.status(t)).onChain.config]:await Promise.all(s.networks.map((async function(e){return(await s.status(e.chainId)).onChain.config})));break}case"sequence_getWalletState":{const[t]=e.params;r.result=t?[fo(t,await s.status(t))]:await Promise.all(s.networks.map((async function(e){const t=await s.status(e.chainId);return fo(e.chainId,t)})));break}case"sequence_getNetworks":r.result=await i.getNetworks(!0);break;case"sequence_isSequence":r.result=!0;break;case"sequence_updateConfig":throw new Error("sequence_updateConfig method is not allowed from a dapp");case"sequence_publishConfig":throw new Error("sequence_publishConfig method is not allowed from a dapp");case"sequence_gasRefundOptions":case"sequence_getNonce":case"sequence_relay":break;case"sequence_setDefaultNetwork":{const[t]=e.params;if(!t)throw new Error("invalid request, method argument defaultChainId cannot be empty");i.setDefaultChainId(t),r.result=await i.getNetworks(!0);break}default:{if(!h)throw new Error("Account provider doesn't support send method");const t=await h.send(e.method,e.params);r.result=t}}}catch(e){ke.error(e),r.result=null,r.error=a({},new Error(e),{code:4001})}s(void 0,r)},this.isSignedIn=async function(){return await i.signerReady(),!!i.account},this.getAccount=async function(){if(await i.signerReady(),void 0===i.account)throw new Error("signerReady failed resolve");return i.account},this.account=e,this.prompter=s,this.networks=n}defaultChainId(){var e,t;return null!=(e=null==(t=this.prompter)?void 0:t.getDefaultChainId())?e:this.networks[0].chainId}async signIn(e,t={}){this.setAccount(e);const{connect:s,defaultNetworkId:n}=t;if(s){const e=this._connectOptions;let t;var i;if(null!==this.prompter)t=await(null==(i=this.prompter)?void 0:i.promptSignInConnect(e));else t=await this.connect(e);this.notifyConnect(t),e&&!0===e.keepWalletOpened||this.notifyClose()}var r;n&&this.defaultChainId()!==n&&await(null==(r=this.prompter)?void 0:r.promptChangeNetwork(n))}signOut(){this.account&&this.notifyDisconnect(),this.setAccount(null)}signerReset(){this.account=void 0}signerReady(e=1e4){return new Promise(((t,s)=>{void 0!==this.account?t():(setTimeout((()=>{void 0===this.account&&(this.signerReadyCallbacks=[],s("signerReady timed out"))}),e),this.signerReadyCallbacks.push(t))}))}async connect(e){var s,n;if(!this.account)return{connected:!1,chainId:"0x0",error:"unable to connect without signed in account"};const i=Fe(null!=(s=null!=(n=null==e?void 0:e.networkId)?n:this.defaultChainId())?s:re.MAINNET).chainId,r={connected:!0,chainId:t.ethers.utils.hexValue(i)};if(e&&e.authorize){const t={app:e.app,origin:e.origin,expiry:e.expiry,nonce:e.authorizeNonce};try{r.proof=await Vi(this.account,i,t)}catch(t){return ke.warn(`connect, signAuthorization failed for options: ${JSON.stringify(e)}, due to: ${t.message}`),{connected:!1,chainId:"0x0",error:`signAuthorization failed: ${t.message}`}}}return r.session=this.walletSession(i),r}sendMessageRequest(e){return new Promise((t=>{this.sendAsync(e.data,((s,n)=>{const i=a({},e,{data:n});t(i)}),e.chainId)}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}async getAddress(){var e,t;return null!=(e=null==(t=this.account)?void 0:t.address)?e:""}get openIntent(){return this._openIntent}setOpenIntent(e){this._openIntent=e}get connectOptions(){return this._connectOptions}setConnectOptions(e){var t;this._connectOptions=e,null==(t=this.onConnectOptionsChange)||t.call(this,e)}async setDefaultChainId(e){var t;return await(null==(t=this.prompter)?void 0:t.promptChangeNetwork(e)),this.defaultChainId()}async getNetworks(e){return this.account?e?this.account.networks.map((e=>{const t=a({},e);return t.provider=void 0,t.relayer=void 0,t})):this.account.networks:(ke.warn("signer not set: getNetworks is returning an empty list"),[])}walletSession(e){if(!this.account)return;const t={walletContext:this.account.contexts,accountAddress:this.account.address,networks:this.account.networks.map((e=>a({},e,{provider:void 0,relayer:void 0})))};if(e){const n=ue(t.networks,e);var s;if(n)null==(s=t.networks)||s.forEach((e=>delete e.isDefaultChain)),n.isDefaultChain=!0}return t}notifyConnect(e,t){var s,n;(console.log("emit connect",e),this.events.emit("connect",e),null!=(s=e.session)&&s.accountAddress)&&this.events.emit("accountsChanged",[null==(n=e.session)?void 0:n.accountAddress],t)}notifyDisconnect(e){this.events.emit("accountsChanged",[],e),this.events.emit("disconnect",void 0,e)}notifyChainChanged(e,s){this.events.emit("chainChanged",t.ethers.utils.hexValue(e),s)}async notifyNetworks(e){const s=e||await this.getNetworks(!0);if(this.events.emit("networks",s),s.length>0){const e=s.find((e=>e.chainId===this.defaultChainId()));e&&this.events.emit("chainChanged",t.ethers.utils.hexValue(e.chainId))}else this.events.emit("chainChanged","0x0")}async notifyWalletContext(){if(!this.account)return void ke.warn("signer not set: skipping to notify wallet context");const e=this.account.contexts;this.events.emit("walletContext",e)}notifyClose(e){this.events.emit("close",e)}setAccount(e){if(this.account=e,void 0!==e){for(let e=0;e<this.signerReadyCallbacks.length;e++)this.signerReadyCallbacks[e]();this.signerReadyCallbacks=[]}}async handleConfirmWalletDeployPrompt(e,t,s,n){if(!n)return!0;const i=e=>e.canOnchainValidate||2===e.original.version&&s;if(i(await t.status(n)))return!0;if(await e.promptConfirmWalletDeploy(n,this.connectOptions)){return!!i(await t.status(n))||(ke.error("WalletRequestHandler: result for promptConfirmWalletDeploy is not correct"),!1)}return!1}},CHANNEL_ID:io,ExtensionMessageHandler:class extends Za{constructor(e,t){super(e),this.runtime=t,this.port=void 0,this._init=_a.OK}register(){this._registered=!0,this.port=this.runtime.connect({name:io})}sendMessage(e){ke.info("[ExtensionMessageHandler send]",e),this.port.postMessage(e)}},ExtensionMessageProvider:ro,BaseInjectedTransport:ao,UnrealMessageProvider:no,UnrealMessageHandler:class extends Za{constructor(e){super(e),this.onMessageFromUnreal=e=>{ke.debug("RECEIVED MESSAGE",e),this.handleMessage(e)},this.getUnrealTransportSession=e=>{const t=new Sa(e);return{sessionId:t.get("sid"),networkId:t.get("net"),intent:me(t.get("intent"))}},this._init=_a.NIL}async register(e){var t;if(void 0===(null==(t=window.ue)?void 0:t.sequencewallettransport))return;eo("wallet");const{search:s}=new URL(e||window.location.href);let n=this.getUnrealTransportSession(s);!!n.sessionId||(n=await this.getCachedTransportSession()),n?(window.ue.sequencewallettransport.onmessagefromsequencejs=this.onMessageFromUnreal,this._registered=!0,this.open(n).then((e=>{if(!e){var t;const e=`failed to open to network ${null==(t=n)?void 0:t.networkId}`;ke.error(e),this.notifyClose({message:e}),window.close()}})).catch((e=>{var t;const s=`failed to open to network ${null==(t=n)?void 0:t.networkId}, due to: ${e}`;ke.error(s),this.notifyClose({message:s}),window.close()}))):ke.error("unreal session is undefined")}unregister(){var e;(null==(e=window.ue)||null==(e=e.sequencewallettransport)?void 0:e.onmessagefromsequencejs)===this.onMessageFromUnreal&&delete window.ue.sequencewallettransport.onmessagefromsequencejs,this._registered=!1}sendMessage(e){var t;if(e.type!==ka.INIT&&this._init!==_a.OK)return void ke.error("impossible state, should not be calling postMessage until inited");const s=JSON.stringify(e);null==(t=window.ue)||null==(t=t.sequencewallettransport)||t.sendmessagetosequencejs(s)}},isProviderTransport:Ca,WindowSessionParams:Sa,EventType:ka,OpenState:Ta,InitState:_a,ProviderError:Oa,ErrSignedInRequired:Na,SequenceProvider:wo,SingleNetworkSequenceProvider:bo,messageToBytes:Ua,prefixEIP191Message:Ha,trimEIP191Prefix:e=>{if(JSON.stringify(e.slice(0,Ba.length))!==JSON.stringify(Ba))return e;const s=e.slice(Ba.length),n=String(s.length).length;let i,r;try{r=Number(t.ethers.utils.toUtf8String(s.slice(0,n)))}catch(e){r=Number(t.ethers.utils.hexlify(s.slice(0,n)))}i=r>s.length||!Number.isInteger(r)?n-1:n;return s.slice(i)},isValidSignature:ja,isValidMessageSignature:Wa,isValidTypedDataSignature:qa,isBrowserExtension:$a,isUnityPlugin:Fa,isWalletUpToDate:Ga,MemoryItemStore:Va,LocalStorage:Ka,useBestStore:Ja,resolveArrayProperties:za,SequenceClientSession:oc,DefaultChainIdTracker:cc,SequenceClient:hc,SequenceSigner:po,SingleNetworkSequenceSigner:mo,DefaultProviderConfig:lc,initWallet:uc,unregisterWallet:fc,getWallet:gc}),mc=Object.freeze({__proto__:null,RpcRelayerProto:si,isLocalRelayerOptions:function(e){return void 0!==e.signer&&t.Signer.isSigner(e.signer)},LocalRelayer:class extends Jn{constructor(e){if(super(t.Signer.isSigner(e)?{provider:e.provider}:a({},e,{provider:e.signer.provider})),this.signer=void 0,this.txnOptions=void 0,this.signer=t.Signer.isSigner(e)?e:e.signer,!this.signer.provider)throw new Error("Signer must have a provider")}async getFeeOptions(e,...t){return{options:[]}}async getFeeOptionsRaw(e,t,s){return{options:[]}}async gasRefundOptions(e,...t){const{options:s}=await this.getFeeOptions(e,...t);return s}setTransactionOptions(e){this.txnOptions=e}async relay(e,t,s=!0){void 0!==t&&ke.warn("LocalRelayer doesn't accept fee quotes");const n=vn(e),i=this.signer.sendTransaction(a({to:e.entrypoint,data:n},this.txnOptions,{gasLimit:9e6}));if(s){const e=await i;return e.receipt=await e.wait(),e}return i}},ProviderRelayerDefaults:Kn,isProviderRelayerOptions:function(e){return void 0!==e.provider&&t.providers.Provider.isProvider(e.provider)},ProviderRelayer:Jn,proto:si,isRpcRelayerOptions:function(e){return void 0!==e.url&&"string"==typeof e.url&&void 0!==e.provider&&t.ethers.providers.Provider.isProvider(e.provider)},RpcRelayer:ai,isRelayer:ci});const yc=Cn;var wc=Object.freeze({__proto__:null,transactions:yc}),vc=Object.freeze({__proto__:null,isValidSignature:ja,isValidMessageSignature:Wa,isValidTypedDataSignature:qa,isWalletUpToDate:Ga,base64Encode:e=>G(e,!0),base64EncodeObject:pe,base64Decode:e=>{if(null!=e)return V(e)},base64DecodeObject:me,isBigNumberish:ye,encodeMessageDigest:we,packMessageData:ve,subDigestOf:be,isNode:Ie,isBrowser:()=>!0,jwtDecodeClaims:Ee,Logger:Se,logger:ke,configureLogger:e=>ke.configure(e),getEthersConnectionInfo:Te,PromiseCache:class{constructor(){this.cache=void 0,this.cache=new Map}do(e,s,n,...i){e=`${e}:${t.ethers.utils.keccak256(t.ethers.utils.toUtf8Bytes(JSON.stringify(i,_e)))}`;let r=this.cache.get(e);if(r&&r.expiration&&new Date>=r.expiration&&(r=void 0,this.cache.delete(e)),!r){const t={promise:n(...i)};void 0!==s&&(t.promise=t.promise.then((e=>(t.expiration=new Date(Date.now()+s),e)))),r=t,this.cache.set(e,r)}return r.promise}},promisify:Oe,queryStringFromObject:function(e,t){return`${encodeURIComponent(e)}=${encodeURIComponent(JSON.stringify(t))}`},queryStringToObject:function(e){const t=e.split("&"),s={};for(const e of t){const t=e.split("=");s[decodeURIComponent(t[0])]=JSON.parse(decodeURIComponent(t[1]))}return s},getRandomInt:Ne,sanitizeNumberString:Ae,sanitizeAlphanumeric:xe,sanitizeHost:Pe,sleep:e=>new Promise((t=>{const s=setTimeout((()=>{clearTimeout(s),t()}),e)})),encodeTypedDataHash:Me,encodeTypedDataDigest:Re,defineReadOnly:Le,getStatic:De,resolveProperties:Be,checkProperties:Ue,shallowCopy:He,deepCopy:je,urlClean:e=>e.replace(/([^:]\/)\/+/g,"$1")}),bc=Object.freeze({__proto__:null,v1:Bt,v2:Ys,commons:xn,universal:Ln,allVersions:Dn}),Ic=Object.freeze({__proto__:null,SignerState:fi,isSignerStatusPending:gi,Orchestrator:pi,signers:ui}),Ec=Object.freeze({__proto__:null,tracker:zi,trackers:Gr}),Cc=Object.freeze({__proto__:null,version:Un,migration:Wn,migrator:$n,defaults:Gn}),Sc=Object.freeze({__proto__:null,Account:Ii,isAccount:function(e){return e instanceof Ii}}),kc=Object.freeze({__proto__:null,abi:r,api:p,auth:Zr,guard:da,indexer:ua,metadata:fa,multicall:ba,network:Ia,provider:pc,relayer:mc,transactions:wc,utils:vc,core:bc,signhub:Ic,sessions:Ec,migration:Cc,account:Sc,initWallet:uc,getWallet:gc,unregisterWallet:fc,SequenceProvider:wo,SequenceClient:hc,SequenceSigner:po});e.initWallet=uc,e.sequence=kc,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=0xsequence.umd.min.js.map
